---
title: 'GCP Authentication in Prowler'
---

Prowler for Google Cloud supports multiple authentication methods. To use a specific method, configure the appropriate credentials during execution:

- [**User Credentials** (Application Default Credentials)](#application-default-credentials-user-credentials)
- [**Service Account Key File**](#service-account-key-file)
- [**Access Token**](#access-token)
- [**Service Account Impersonation**](#service-account-impersonation)

## Required Permissions

Prowler for Google Cloud requires the following permissions:

### IAM Roles
- **Reader (`roles/reader`)** – Must be granted at the **project, folder, or organization** level to allow scanning of target projects.

### Project-Level Settings

At least one project must have the following configurations:

- **Identity and Access Management (IAM) API (`iam.googleapis.com`)** – Must be enabled via:

    - The [Google Cloud API UI](https://console.cloud.google.com/apis/api/iam.googleapis.com/metrics), or
    - The `gcloud` CLI:
    ```sh
    gcloud services enable iam.googleapis.com --project <your-project-id>
    ```

- **Service Usage Consumer (`roles/serviceusage.serviceUsageConsumer`)** IAM Role – Required for resource scanning.

- **Quota Project Setting** – Define a quota project using either:

    - The `gcloud` CLI:
    ```sh
    gcloud auth application-default set-quota-project <project-id>
    ```
    - Setting an environment variable:
    ```sh
    export GOOGLE_CLOUD_QUOTA_PROJECT=<project-id>
    ```

<Note>
Prowler will scan the GCP project associated with the credentials.


</Note>
## Application Default Credentials (User Credentials)

This method uses the Google Cloud CLI to authenticate and is suitable for development and testing environments.

### Setup Application Default Credentials

1. In the [GCP Console](https://console.cloud.google.com/), click on "Activate Cloud Shell"

    ![Activate Cloud Shell](/images/providers/access-console.png)

2. Click "Authorize Cloud Shell"

    ![Authorize Cloud Shell](/images/providers/authorize-cloud-shell.png)

3. Run the following command:

    ```bash
    gcloud auth application-default login
    ```

    - Type `Y` when prompted

    ![Run Gcloud Auth](/images/providers/run-gcloud-auth.png)

4. Open the authentication URL provided in a browser and select your Google account

    ![Choose the account](/images/providers/take-account-email.png)

5. Follow the steps to obtain the authentication code

    ![Copy auth code](/images/providers/copy-auth-code.png)

6. Paste the authentication code back in Cloud Shell

    ![Enter Auth Code](/images/providers/enter-auth-code.png)

7. Use `cat <file_name>` to view the temporary credentials file

    ![Get the FileName](/images/providers/get-temp-file-credentials.png)

8. Extract the following values for Prowler Cloud/App:

    - `client_id`
    - `client_secret`
    - `refresh_token`

    ![Get the values](/images/providers/get-needed-values-auth.png)

### Using with Prowler CLI

Once application default credentials are set up, run Prowler directly:

```console
prowler gcp --project-ids <project-id>
```

## Service Account Key File

This method uses a service account with a downloaded key file for authentication.

### Create Service Account and Key

1. Go to the [Service Accounts page](https://console.cloud.google.com/iam-admin/serviceaccounts) in the GCP Console.

   ![Service account list for the project](/user-guide/providers/gcp/img/service-accounts.png)

2. Click **Create Service Account**.

   ![Create service account form](/user-guide/providers/gcp/img/create-service-account.png)

3. Click **Done** to skip the optional steps for now.
4. Go to the service account page, look for the service account you just created and click on it.
5. Go to the **Keys** tab.

   ![Keys tab in the service account details](/user-guide/providers/gcp/img/service-account-keys.png)

6. Click **Add Key** > **Create new key**.
7. Select **JSON** and click **Create**.

   ![Choose JSON key type before downloading the key](/user-guide/providers/gcp/img/service-account-json.png)

8. Save the downloaded key file securely.

### Create and assign the needed Roles

Prowler need the following roles to be assigned to the service account:
- **Viewer (`roles/viewer`)**
- **Service Usage Consumer (`roles/serviceusage.serviceUsageConsumer`)**
- **ProwlerRole** (custom role to be created in the steps below)


#### Create the ProwlerRole

1. Open the Google Cloud Console and navigate to **IAM & Admin → Roles**.
   ![Roles overview for Lucky-Coast project](/user-guide/providers/gcp/img/roles-section.png)
2. Click **Create role**, then fill in:
   - **Title**: `ProwlerRole`
   - **ID**: `ProwlerRole`
   - **Description**: short reminder such as “Needed role to execute Prowler with Service Account authentication.”
   - **Role launch stage**: `Alpha` (or another stage approved by your org).
3. Select **Add permissions**, search for each permission listed above (filter by **Storage Admin** if that is faster), check the boxes, and click **Add**.
   ![Adding storage.buckets.getIamPolicy permission](/user-guide/providers/gcp/img/storage-buckets-getIamPolicy.png)
4. Click **Create** to publish the role.

#### Assign the roles to the service account

1. Go to **IAM & Admin → Service Accounts** and open the account used by Prowler.
2. On the **Permissions** tab choose **Manage access**.
3. Add the following roles to the service account:
   - **Viewer (`roles/viewer`)**
   - **Service Usage Consumer (`roles/serviceusage.serviceUsageConsumer`)**
   - **ProwlerRole (custom)**
4. Save the changes.
   ![Service account with Viewer, Service Usage Consumer, and ProwlerRole assigned](/user-guide/providers/gcp/img/final-permissions.png)

### Using with Prowler CLI

Set the `GOOGLE_APPLICATION_CREDENTIALS` environment variable:

```console
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account-key.json"
prowler gcp --project-ids <project-id>
```

## Access Token

For existing access tokens (e.g., generated with `gcloud auth print-access-token`), run Prowler with:

```bash
export CLOUDSDK_AUTH_ACCESS_TOKEN=$(gcloud auth print-access-token)
prowler gcp --project-ids <project-id>
```

<Note>
When using this method, also set the default project explicitly:
```bash
export GOOGLE_CLOUD_PROJECT=<project-id>
```

</Note>
## Service Account Impersonation

To impersonate a GCP service account, use the `--impersonate-service-account` argument followed by the service account email:

```console
prowler gcp --impersonate-service-account <service-account-email>
```

This command leverages the default credentials to impersonate the specified service account.

### Prerequisites for Impersonation

The identity running Prowler must have the following permission on the target service account:

- `roles/iam.serviceAccountTokenCreator`

Or the more specific permission:

- `iam.serviceAccounts.generateAccessToken`
