#!/bin/bash

# Prowler UI - Pre-Commit Hook
# Runs healthcheck (typecheck + lint) and build for UI changes
# AI code review is handled by gga in .pre-commit-config.yaml

set -e

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸš€ Prowler UI - Pre-Commit Hook"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Get git root and navigate to ui directory
GIT_ROOT=$(git rev-parse --show-toplevel)
cd "$GIT_ROOT/ui" || exit 1

# Run healthcheck (typecheck and lint check)
echo -e "${BLUE}ğŸ¥ Running healthcheck...${NC}"
echo ""

if pnpm run healthcheck; then
  echo ""
  echo -e "${GREEN}âœ… Healthcheck passed${NC}"
  echo ""
else
  echo ""
  echo -e "${RED}âŒ Healthcheck failed${NC}"
  echo -e "${RED}Fix type errors and linting issues before committing${NC}"
  echo ""
  exit 1
fi

# Run build
echo -e "${BLUE}ğŸ”¨ Running build...${NC}"
echo ""

if pnpm run build; then
  echo ""
  echo -e "${GREEN}âœ… Build passed${NC}"
  echo ""
else
  echo ""
  echo -e "${RED}âŒ Build failed${NC}"
  echo -e "${RED}Fix build errors before committing${NC}"
  echo ""
  exit 1
fi
