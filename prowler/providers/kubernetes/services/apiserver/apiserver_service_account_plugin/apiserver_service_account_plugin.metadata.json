{
  "Provider": "kubernetes",
  "CheckID": "apiserver_service_account_plugin",
  "CheckTitle": "Kubernetes API server pod has ServiceAccount admission control plugin enabled",
  "CheckType": [],
  "ServiceName": "apiserver",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "Pod",
  "Description": "**Kubernetes API server** includes the **ServiceAccount admission controller** (`ServiceAccount`)-enabled via `--enable-admission-plugins` and not listed in `--disable-admission-plugins`.\n\nIt applies service account-related defaults and policies to Pods, such as assigning a service account and governing secret references.",
  "Risk": "Without **ServiceAccount admission**, Pods may reference unintended secrets and run with unpredictable identities. This enables token misuse and unauthorized API access, facilitating lateral movement and privilege abuse, degrading **confidentiality** and **integrity** of cluster resources.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://stackoverflow.com/questions/74206876/getting-crashloopbackoff-error-for-apiserver-etcd-in-newly-joined-control-plan",
    "https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/",
    "https://seclists.org/oss-sec/2024/q2/126",
    "https://stackoverflow.com/questions/53882712/storing-the-configuration-used-in-configmap-kubeadm-config-in-the-kube-system",
    "https://www.openwall.com/lists/oss-security/2024/04/16/4",
    "https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#serviceaccount"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. SSH to each control plane node\n2. Edit the API server static pod manifest:\n   sudo vi /etc/kubernetes/manifests/kube-apiserver.yaml\n3. In the kube-apiserver container flags, add or update the line:\n   - --enable-admission-plugins=ServiceAccount  <!-- Critical: ensures ServiceAccount plugin is enabled -->\n4. If a --disable-admission-plugins flag exists, ensure ServiceAccount is NOT listed (remove it if present)  <!-- Critical: prevents disabling the plugin -->\n5. Save the file; the kubelet will restart the API server automatically",
      "Terraform": ""
    },
    "Recommendation": {
      "Text": "Enable and keep the `ServiceAccount` admission controller active to enforce identity and secret policies.\n- Apply **least privilege**: restrict secrets on each service account\n- Disable token automount where not needed (`automountServiceAccountToken=false`)\n- Isolate secrets by namespace and rotate tokens\n- Keep the API server patched",
      "Url": "https://hub.prowler.com/check/apiserver_service_account_plugin"
    }
  },
  "Categories": [
    "cluster-security",
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "ServiceAccount plugin is usually enabled by default, ensuring automated management of service accounts and their associated tokens."
}
