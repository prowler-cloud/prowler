{
  "Provider": "kubernetes",
  "CheckID": "apiserver_deny_service_external_ips",
  "CheckTitle": "Kubernetes API server pod has DenyServiceExternalIPs admission controller enabled",
  "CheckType": [],
  "ServiceName": "apiserver",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "Pod",
  "Description": "**Kubernetes API server** with **DenyServiceExternalIPs** rejects net-new use of `Service.spec.externalIPs` and additions to that field on existing Services; existing values can only be removed.",
  "Risk": "Without **DenyServiceExternalIPs**, users with Service create/patch rights can reroute traffic via arbitrary external IPs, enabling **man-in-the-middle**, traffic hijacking, and data exfiltration, degrading **confidentiality** and **integrity**. Attackers may also abuse `status.loadBalancer.ingress.ip` to similar effect.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://github.com/aquasecurity/kube-bench/issues/1606",
    "https://hub.armosec.io/docs/c-0283",
    "https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#denyserviceexternalips",
    "https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/",
    "https://docs.w3cub.com/kubernetes/reference/access-authn-authz/admission-controllers.html",
    "https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#how-do-i-turn-off-an-admission-controller",
    "https://kodekloud.com/community/t/admission-plugins-how-to-view-enabled-plugins/418410"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. SSH to the control plane node\n2. Edit /etc/kubernetes/manifests/kube-apiserver.yaml\n3. In the kube-apiserver command/args list, add: --disable-admission-plugins=DenyServiceExternalIPs\n4. Save the file; the kubelet will restart the API server automatically",
      "Terraform": ""
    },
    "Recommendation": {
      "Text": "Enable **DenyServiceExternalIPs** to block net-new `externalIPs` usage.\n\nApply **least privilege** RBAC on Services (including status updates), require change control for exposure, and favor controlled **Ingress/LoadBalancer** patterns. Use admission policies to tightly allow approved exceptions as **defense in depth**.",
      "Url": "https://hub.prowler.com/check/apiserver_deny_service_external_ips"
    }
  },
  "Categories": [
    "cluster-security",
    "trust-boundaries",
    "internet-exposed"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Consider the impact on existing services before enabling this admission controller, as it can restrict the usage of external IPs in the cluster."
}
