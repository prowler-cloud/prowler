{
  "Provider": "kubernetes",
  "CheckID": "apiserver_service_account_lookup_true",
  "CheckTitle": "API server pod has --service-account-lookup set to true",
  "CheckType": [],
  "ServiceName": "apiserver",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "Pod",
  "Description": "Kubernetes API server has **service account lookup** enabled via `--service-account-lookup=true`, validating presented service account tokens against currently existing ServiceAccounts during authentication.",
  "Risk": "Without **service account lookup**, tokens tied to deleted or renamed ServiceAccounts can still authenticate, enabling persistence with stale credentials, unauthorized API access, and lateral movement, degrading **confidentiality** and **integrity** of cluster resources.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://kubernetes.io/docs/reference/access-authn-authz/authentication/",
    "https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/",
    "https://kubernetes.io/docs/reference/access-authn-authz/authentication/#service-account-tokens"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. SSH to each control plane node with root privileges\n2. Edit the static Pod manifest: sudo vi /etc/kubernetes/manifests/kube-apiserver.yaml\n3. In the kube-apiserver container command list, add the flag:\n   ```\n   --service-account-lookup=true\n   ```\n4. Save the file; the kubelet will automatically restart the API server\n5. Verify the flag is active: ps aux | grep kube-apiserver | grep -- --service-account-lookup=true",
      "Terraform": ""
    },
    "Recommendation": {
      "Text": "Enable `--service-account-lookup=true` so token validity depends on the ServiceAccount's current state. Apply **least privilege** to ServiceAccounts, favor short-lived tokens, and promptly remove unused accounts and secrets. Combine with strict **RBAC** and auditing for **defense in depth**.",
      "Url": "https://hub.prowler.com/check/apiserver_service_account_lookup_true"
    }
  },
  "Categories": [
    "cluster-security",
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "By default, this argument is set to true. It's critical to maintain this setting for security."
}
