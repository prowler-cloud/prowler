{
  "Provider": "kubernetes",
  "CheckID": "apiserver_namespace_lifecycle_plugin",
  "CheckTitle": "Kubernetes API server pod has NamespaceLifecycle admission control plugin enabled",
  "CheckType": [],
  "ServiceName": "apiserver",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "Pod",
  "Description": "**Kubernetes API server** has the `NamespaceLifecycle` admission controller active and not disabled, enforcing namespace lifecycle rules by rejecting objects targeting **non-existent** or **terminating** namespaces and protecting system namespaces from deletion.",
  "Risk": "Without `NamespaceLifecycle`, resources can be created in namespaces being removed or that never existed, causing inconsistent state and controller errors.\n\nThis degrades **integrity** and **availability**, leaving orphaned objects, delaying cleanup, and potentially preserving access via leftover service accounts or policies.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.sysdig.com/learn-cloud-native/kubernetes-admission-controllers",
    "https://stackoverflow.com/questions/67362350/how-do-i-find-and-call-the-kube-apiserver-in-k3s-k3d-with-calico-and-without",
    "https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/",
    "https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#namespacelifecycle",
    "https://be-reliable-engineer.medium.com/k8s-admission-controller-4796b66435ad",
    "https://blog.codegrape.com/advantages-of-governance-within-kubernetes/",
    "https://notes.kodekloud.com/docs/Certified-Kubernetes-Application-Developer-CKAD/Security/Solution-Admission-Controllers",
    "https://blog.nashtechglobal.com/admission-controller-in-kubernetes/"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. SSH to the control plane node.\n2. Edit the API server manifest: /etc/kubernetes/manifests/kube-apiserver.yaml\n3. In spec.containers[0].command, ensure NamespaceLifecycle is enabled and not disabled:\n   ```yaml\n   # Critical: enable NamespaceLifecycle plugin\n   - --enable-admission-plugins=NamespaceLifecycle\n   # If this flag exists with a list, append ,NamespaceLifecycle to it\n   # Ensure NamespaceLifecycle is NOT present in:\n   # - --disable-admission-plugins=...\n   ```\n4. Save the file; the kubelet will restart the API server automatically.\n5. Verify the setting is present in the running pod spec:\n   ```\n   kubectl -n kube-system get pod -l component=kube-apiserver -o jsonpath='{.items[0].spec.containers[0].command}' | grep NamespaceLifecycle\n   ```",
      "Terraform": ""
    },
    "Recommendation": {
      "Text": "Ensure `NamespaceLifecycle` remains enabled to enforce namespace governance. Apply **least privilege** for namespace creation/deletion, and use **separation of duties** for approvals. Monitor deletions and remediate stuck finalizers so cleanup completes. Combine with RBAC and audit logs for **defense in depth**.",
      "Url": "https://hub.prowler.com/check/apiserver_namespace_lifecycle_plugin"
    }
  },
  "Categories": [
    "cluster-security"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "NamespaceLifecycle plugin is usually enabled by default, ensuring proper management of namespace creation and termination."
}
