{
  "Provider": "kubernetes",
  "CheckID": "apiserver_service_account_key_file_set",
  "CheckTitle": "Kubernetes API server pod has --service-account-key-file configured",
  "CheckType": [],
  "ServiceName": "apiserver",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "Pod",
  "Description": "**Kubernetes API server** uses `--service-account-key-file` to supply the public key(s) for validating **service account tokens**.\n\nDetection looks for API server containers that lack this flag.",
  "Risk": "Without a dedicated key file, token validation can fall back to the API server's TLS key, eroding **separation of duties**. Compromise or rotation of that key can enable **token forgery** (confidentiality/integrity) or invalidate tokens, disrupting workloads (**availability**).",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#serviceaccount-token-volume-projection",
    "https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. SSH to the control plane node.\n2. Edit the API server static pod manifest:\n   sudo vi /etc/kubernetes/manifests/kube-apiserver.yaml\n3. In spec.containers[0].command add this line:\n   ```\n   - --service-account-key-file=/etc/kubernetes/pki/sa.pub\n   ```\n4. Save the file; the kubelet will restart the API server automatically.",
      "Terraform": ""
    },
    "Recommendation": {
      "Text": "Use a dedicated key pair for **service accounts**:\n- Configure `--service-account-key-file` with public keys for validation\n- Keep signing and serving keys separate (*least privilege*)\n- Enforce scheduled key rotation and maintain multiple active keys for **defense in depth**",
      "Url": "https://hub.prowler.com/check/apiserver_service_account_key_file_set"
    }
  },
  "Categories": [
    "cluster-security",
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Ensure the public key used is securely managed and rotated in accordance with your organization's security policy."
}
