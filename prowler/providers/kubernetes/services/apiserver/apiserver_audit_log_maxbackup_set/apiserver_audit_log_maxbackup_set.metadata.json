{
  "Provider": "kubernetes",
  "CheckID": "apiserver_audit_log_maxbackup_set",
  "CheckTitle": "API server pod has --audit-log-maxbackup set to 10 or the configured value",
  "CheckType": [],
  "ServiceName": "apiserver",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "Pod",
  "Description": "**Kubernetes API server audit logging** uses `--audit-log-maxbackup` to set how many rotated audit log files are kept. This evaluates whether that value is explicitly configured as `10` or an approved organizational setting across API server containers.",
  "Risk": "Insufficient **audit log retention** reduces **accountability** and hampers **forensics**. Limited backups cause older events to be overwritten, letting attackers hide activity until rotation. This undermines the **confidentiality**, **integrity**, and **availability** of evidence needed for incident response.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://kubernetes.io/docs/concepts/cluster-administration/audit/",
    "https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/",
    "https://stackoverflow.com/questions/60371587/unable-to-start-kube-apiserver-service",
    "https://docs.kics.io/2.0.0/queries/kubernetes-queries/768aab52-2504-4a2f-a3e3-329d5a679848/",
    "https://openai.com/index/scaling-kubernetes-to-2500-nodes/"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. SSH to each control plane node\n2. Edit the static Pod manifest: /etc/kubernetes/manifests/kube-apiserver.yaml\n3. Under spec.containers[0].command, add or update this flag:\n   - --audit-log-maxbackup=10\n4. Save the file; the kubelet will restart the API server automatically",
      "Terraform": ""
    },
    "Recommendation": {
      "Text": "Establish explicit **audit log retention**. Set `--audit-log-maxbackup` to `10` or higher based on data sensitivity, and align with `--audit-log-maxsize` and `--audit-log-maxage`. Forward logs to centralized, immutable storage, restrict access, and monitor rotation. Apply **defense in depth** and **least privilege** to audit systems.",
      "Url": "https://hub.prowler.com/check/apiserver_audit_log_maxbackup_set"
    }
  },
  "Categories": [
    "logging"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Ensure the audit log backup retention period is set appropriately to balance between storage constraints and the need for historical data."
}
