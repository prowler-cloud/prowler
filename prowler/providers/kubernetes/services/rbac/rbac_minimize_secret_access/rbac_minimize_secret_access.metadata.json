{
  "Provider": "kubernetes",
  "CheckID": "rbac_minimize_secret_access",
  "CheckTitle": "Role or ClusterRole does not grant get, list, or watch access to Kubernetes Secrets",
  "CheckType": [],
  "ServiceName": "rbac",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "ClusterRole",
  "Description": "RBAC Roles and ClusterRoles granting read permissions to **Kubernetes Secrets** are identified. The evaluation looks for rules that allow `get`, `list`, or `watch` on `secrets`, either namespace-scoped or cluster-wide.",
  "Risk": "Excessive Secret read access compromises confidentiality of tokens, keys, and credentials. Attackers can harvest service account tokens to impersonate workloads, pivot across namespaces, and modify resources, threatening integrity and availability via lateral movement.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://kubernetes.io/docs/reference/access-authn-authz/rbac/",
    "https://kubernetes.io/docs/concepts/configuration/secret/"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. Identify the offending Role or ClusterRole name\n2. Edit it: run either `kubectl edit clusterrole <example_resource_name>` or `kubectl edit role <example_resource_name> <namespace>`\n3. In `rules`, remove any entry where `resources` contains `secrets` with verbs `get`, `list`, or `watch` (or delete those verbs/resources from the rule)\n4. Save and exit; the change applies immediately",
      "Terraform": "```hcl\n# Remove secret read permissions by ensuring no rule includes the \"secrets\" resource\nresource \"kubernetes_cluster_role\" \"<example_resource_name>\" {\n  metadata {\n    name = \"<example_resource_name>\"\n  }\n  rule {\n    api_groups = [\"\"]\n    resources  = [\"pods\"] # Critical: do NOT include \"secrets\" to avoid get/list/watch on Secrets\n    verbs      = [\"get\"]\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply **least privilege**: avoid granting `get`, `list`, or `watch` on `secrets` except to narrowly scoped subjects. Constrain by namespace and `resourceNames` where feasible, use dedicated service accounts, avoid wildcards, and enforce **separation of duties** with policy and reviews.",
      "Url": "https://hub.prowler.com/check/rbac_minimize_secret_access"
    }
  },
  "Categories": [
    "identity-access",
    "secrets",
    "cluster-security"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Care should be taken to avoid disrupting system components that require access to secrets for proper functioning."
}
