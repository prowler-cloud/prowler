{
  "Provider": "kubernetes",
  "CheckID": "kubelet_tls_cert_and_key",
  "CheckTitle": "Kubelet has TLS certificate and private key files configured",
  "CheckType": [],
  "ServiceName": "kubelet",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "ConfigMap",
  "Description": "**Kubelet** configuration includes a TLS serving certificate and private key defined by `tlsCertFile` and `tlsPrivateKeyFile` to secure its HTTPS endpoint.",
  "Risk": "Without a verifiable TLS serving cert/key, kubelet traffic may fall back to self-signed or skipped verification, enabling **MITM** and endpoint **spoofing**. Attackers could read logs or pod data, run **exec/attach**, and alter node interactions, compromising **confidentiality** and **integrity**, and risking **availability**.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://kubernetes.io/docs/reference/access-authn-authz/kubelet-tls-bootstrapping/",
    "https://kubernetes.io/docs/reference/access-authn-authz/kubelet-tls-bootstrapping/#client-and-serving-certificates"
  ],
  "Remediation": {
    "Code": {
      "CLI": "kubectl -n kube-system patch configmap <example_resource_name> --type merge -p '{\"data\":{\"kubelet\":\"tlsCertFile: /var/lib/kubelet/pki/kubelet.crt\\ntlsPrivateKeyFile: /var/lib/kubelet/pki/kubelet.key\\n\"}}'",
      "NativeIaC": "",
      "Other": "1. In your cluster, open the kubelet config ConfigMap: kubectl -n kube-system edit configmap kubelet-config-<version>\n2. Under the KubeletConfiguration root, add:\n   - tlsCertFile: /var/lib/kubelet/pki/kubelet.crt\n   - tlsPrivateKeyFile: /var/lib/kubelet/pki/kubelet.key\n3. Save and exit.\n4. On each node, restart kubelet to apply: sudo systemctl restart kubelet\n5. Verify the ConfigMap now contains both fields and the check passes.",
      "Terraform": "```hcl\nresource \"kubernetes_config_map\" \"<example_resource_name>\" {\n  metadata {\n    name      = \"<example_resource_name>\"\n    namespace = \"kube-system\"\n  }\n  data = {\n    kubelet = <<-YAML\n      tlsCertFile: /var/lib/kubelet/pki/kubelet.crt        # FIX: adds kubelet TLS cert path\n      tlsPrivateKeyFile: /var/lib/kubelet/pki/kubelet.key  # FIX: adds kubelet TLS key path\n    YAML\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Provision a **CA-signed, node-unique** serving certificate and private key for each kubelet and set `tlsCertFile` and `tlsPrivateKeyFile`. Prefer automated issuance and rotation. Ensure clients validate the certificate and limit kubelet API exposure with network controls and RBAC, applying **least privilege** and **defense in depth**.",
      "Url": "https://hub.prowler.com/check/kubelet_tls_cert_and_key"
    }
  },
  "Categories": [
    "encryption",
    "cluster-security"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Ensure each kubelet has a unique TLS certificate and key for enhanced security."
}
