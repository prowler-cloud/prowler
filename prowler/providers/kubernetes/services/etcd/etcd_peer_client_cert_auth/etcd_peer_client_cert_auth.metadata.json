{
  "Provider": "kubernetes",
  "CheckID": "etcd_peer_client_cert_auth",
  "CheckTitle": "Etcd pod has peer client certificate authentication enabled",
  "CheckType": [],
  "ServiceName": "etcd",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "Pod",
  "Description": "**etcd** requires **peer client certificate authentication** for inter-member traffic via `--peer-client-cert-auth=true` set in the etcd container command",
  "Risk": "Without peer authentication, a rogue host can impersonate a member, eavesdrop on or alter Raft traffic, inject state, and disrupt elections-compromising **confidentiality** (state leakage), **integrity** (malicious writes), and **availability** (cluster instability/outage).",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://etcd.io/docs/latest/op-guide/security/",
    "https://etcd.io/docs/v3.6/op-guide/configuration/",
    "https://avd.aquasec.com/compliance/kubernetes/cis-1.8/cis-1.8-etcd/2/",
    "https://docs.prowler.com/checks/kubernetes/kubernetes-policy-index/ensure-that-the-peer-client-cert-auth-argument-is-set-to-true/",
    "https://www.bookstack.cn/read/etcd-2-en/32a7e17d36afe10b.md",
    "https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#limiting-access-of-etcd-clusters",
    "https://github.com/lavenutagi/etcd-tutorials/blob/master/Documentation/configuration.md",
    "https://pcocc.readthedocs.io/en/latest/deps/etcd-production.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. SSH to the control-plane node\n2. Edit the etcd static Pod manifest: /etc/kubernetes/manifests/etcd.yaml\n3. In spec.containers[0].command, add this entry:\n   - --peer-client-cert-auth=true\n   (Critical: enables peer client certificate authentication)\n4. Save the file; the kubelet will automatically restart the etcd Pod\n5. Verify the Pod's container command includes --peer-client-cert-auth=true",
      "Terraform": "```hcl\nresource \"kubernetes_pod\" \"<example_resource_name>\" {\n  metadata {\n    name      = \"<example_resource_name>\"\n    namespace = \"kube-system\"\n  }\n  spec {\n    container {\n      name    = \"etcd\"\n      image   = \"registry.k8s.io/etcd:3.5.12-0\"\n      command = [\n        \"etcd\",\n        \"--peer-client-cert-auth=true\"  # Critical: enables peer client certificate authentication for peer traffic\n      ]\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enforce **mTLS** for etcd peers with client certificate auth. Use a dedicated CA, validate SANs, and apply **least privilege** to issued certs. Rotate and revoke certificates regularly, restrict network access to peer ports, and avoid auto-generated self-signed peer TLS to maintain strong identity assurance.",
      "Url": "https://hub.prowler.com/check/etcd_peer_client_cert_auth"
    }
  },
  "Categories": [
    "cluster-security",
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "This check is applicable only for etcd clusters. For single etcd server setups, this recommendation does not apply."
}
