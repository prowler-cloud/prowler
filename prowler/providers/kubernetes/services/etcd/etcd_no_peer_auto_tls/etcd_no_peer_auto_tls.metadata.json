{
  "Provider": "kubernetes",
  "CheckID": "etcd_no_peer_auto_tls",
  "CheckTitle": "Etcd pod does not use automatically generated self-signed certificates for peer TLS connections",
  "CheckType": [],
  "ServiceName": "etcd",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "Pod",
  "Description": "**etcd peer TLS** configuration is evaluated by checking etcd containers for the `--peer-auto-tls` flag. Presence of `--peer-auto-tls` indicates peers use automatically generated self-signed certificates for inter-peer connections.",
  "Risk": "With `--peer-auto-tls`, traffic is encrypted but peer identity isn't verified, enabling:\n- MITM on peer links\n- Rogue member joins to read/modify data\n- Quorum disruption\n\nThis degrades **confidentiality**, **integrity**, and **availability** of control-plane state replicated in etcd.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://documentation.ubuntu.com/canonical-kubernetes/latest/snap/howto/security/cis-assessment/",
    "https://docs.datadoghq.com/security/default_rules/cis-kubernetes-1.5.1-2.6/",
    "https://etcd.io/docs/latest/op-guide/security/",
    "https://etcd.io/docs/v3.4/op-guide/security/",
    "https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/",
    "https://orca.security/resources/cloud-risk-encyclopedia/k8s-etcd-is-using-peer-auto-tls-argument/",
    "https://docs.rke2.io/security/cis_self_assessment16"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. SSH to the control-plane node running etcd\n2. Open /etc/kubernetes/manifests/etcd.yaml\n3. In the etcd container args/command, remove any entry that starts with --peer-auto-tls\n4. Save the file; the kubelet will restart etcd automatically",
      "Terraform": ""
    },
    "Recommendation": {
      "Text": "Disable `--peer-auto-tls` and use **mTLS** with a trusted CA issuing unique per-member peer certificates. Enforce SAN validation and, *where supported*, peer certificate authentication. Apply **least privilege**, separate CAs for peers/clients, rotate keys, and monitor certificate expiry and peer membership.",
      "Url": "https://hub.prowler.com/check/etcd_no_peer_auto_tls"
    }
  },
  "Categories": [
    "encryption",
    "cluster-security"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "This check is applicable only for etcd clusters. For single etcd server setups, this recommendation does not apply."
}
