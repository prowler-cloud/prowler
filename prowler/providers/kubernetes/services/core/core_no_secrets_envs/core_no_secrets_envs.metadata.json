{
  "Provider": "kubernetes",
  "CheckID": "core_no_secrets_envs",
  "CheckTitle": "Pod does not contain secret environment variables",
  "CheckType": [],
  "ServiceName": "core",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "Pod",
  "Description": "**Pod containers** define environment variables sourced from **Secrets** via `secretKeyRef` instead of mounting them as files.",
  "Risk": "Secrets in env vars weaken **confidentiality**:\n- Leak via logs, dumps, `/proc/*/environ`, debug UIs, and pod metadata\n- Propagate to child processes; rotation is hard\nAttackers can steal credentials for unauthorized access and **lateral movement**, risking data integrity and service availability.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-files-over-environment-variables",
    "https://stackoverflow.com/questions/72952953/setting-secrets-as-environment-variables-in-deployment-file",
    "https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. Open Kubernetes Dashboard and go to Workloads > Deployments (or StatefulSets/Pods)\n2. Select <example_resource_name> and click Edit > Edit YAML\n3. For each container, remove any env entries that use valueFrom.secretKeyRef\n4. If the app still needs the secret, add a volume that references your Secret and mount it into the container (e.g., mountPath /etc/secret)\n5. Save the changes",
      "Terraform": "```hcl\n# Use a Secret as a volume (no secretKeyRef in env) to pass the check\nresource \"kubernetes_pod\" \"<example_resource_name>\" {\n  metadata { name = \"<example_resource_name>\" }\n  spec {\n    container {\n      name  = \"<example_resource_name>\"\n      image = \"busybox\"\n      volume_mount {\n        name       = \"<example_resource_name>-secret\"  # critical: mount Secret as files instead of env vars\n        mount_path = \"/etc/secret\"\n        read_only  = true\n      }\n    }\n    volume {\n      name = \"<example_resource_name>-secret\"\n      secret { secret_name = \"<example_resource_name>\" }  # critical: reference the Secret via a volume\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Use **Secrets as files** (read-only volumes) and load at runtime.\n- Apply **least privilege** RBAC to Secret access\n- Scope Secrets to required containers; avoid logging env\n- Prefer short-lived creds and regular rotation; set `immutable: true` when suitable\n- Layer **defense in depth** with network and runtime controls",
      "Url": "https://hub.prowler.com/check/core_no_secrets_envs"
    }
  },
  "Categories": [
    "secrets"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Mounting secrets as files allows for dynamic updates of secrets without needing to restart the pod."
}
