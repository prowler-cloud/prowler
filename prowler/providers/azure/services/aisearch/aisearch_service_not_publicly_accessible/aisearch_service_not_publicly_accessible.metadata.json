{
  "Provider": "azure",
  "CheckID": "aisearch_service_not_publicly_accessible",
  "CheckTitle": "AI Search service has public network access disabled",
  "CheckType": [],
  "ServiceName": "aisearch",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "microsoft.search/searchservices",
  "Description": "Azure AI Search service limits its data-plane endpoint by disabling **public network access**. This evaluation checks whether the service only permits connections via **private endpoints** or narrowly scoped, explicitly allowed sources.",
  "Risk": "Internet-reachable search endpoints impact CIA:\n- Confidentiality: unauthorized queries reveal indexed data/metadata\n- Integrity: stolen admin/query keys allow index changes or deletions\n- Availability: abuse and scanning drive throttling and outages",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://learn.microsoft.com/en-us/security/benchmark/azure/baselines/azure-cognitive-search-security-baseline",
    "https://www.azadvertizer.net/azpolicyadvertizer/9cee519f-d9c1-4fd9-9f79-24ec3449ed30.html",
    "https://learn.microsoft.com/en-us/azure/search/service-configure-firewall#configure-network-access-in-azure-portal",
    "https://readmedium.com/how-to-deploy-azure-ai-search-with-a-private-endpoint-using-terraform-3b63c8b84f41",
    "https://www.linkedin.com/pulse/identity-azure-ai-design-afterthought-igor-shvets-xdq4e"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az resource update --resource-group <resource_group_name> --resource-type Microsoft.Search/searchServices --name <service_name> --set properties.publicNetworkAccess=Disabled",
      "NativeIaC": "```bicep\n// Disable public network access for an Azure AI Search service\nresource search 'Microsoft.Search/searchServices@2023-11-01' = {\n  name: '<example_resource_name>'\n  location: '<location>'\n  sku: { name: 'basic' }\n  properties: {\n    publicNetworkAccess: 'Disabled' // CRITICAL: Disables public access so the service is not reachable from the internet\n  }\n}\n```",
      "Other": "1. In the Azure portal, open your AI Search service\n2. Go to Settings > Networking\n3. Under Public network access, select Disabled\n4. Click Save\n5. Wait a few minutes and re-run the check",
      "Terraform": "```hcl\n# Disable public network access for Azure AI Search\nresource \"azurerm_search_service\" \"<example_resource_name>\" {\n  name                = \"<example_resource_name>\"\n  resource_group_name = \"<example_resource_name>\"\n  location            = \"<location>\"\n  sku                 = \"basic\"\n\n  public_network_access_enabled = false  # CRITICAL: Disables public access to pass the check\n}\n```"
    },
    "Recommendation": {
      "Text": "Set `Public network access: Disabled`. Prefer **Private Link** and restrict any residual exposure to specific sources only. Use **least privilege** with Microsoft Entra ID RBAC instead of keys. Apply **defense in depth** with IP rules/trusted services, enable logs, and review access lists regularly.",
      "Url": "https://hub.prowler.com/check/aisearch_service_not_publicly_accessible"
    }
  },
  "Categories": [
    "internet-exposed"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
