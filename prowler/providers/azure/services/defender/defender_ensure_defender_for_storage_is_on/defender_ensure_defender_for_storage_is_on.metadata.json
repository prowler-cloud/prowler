{
  "Provider": "azure",
  "CheckID": "defender_ensure_defender_for_storage_is_on",
  "CheckTitle": "Azure subscription has Microsoft Defender for Storage Accounts pricing tier set to Standard",
  "CheckType": [],
  "ServiceName": "defender",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "microsoft.security/pricings",
  "Description": "Azure subscription's **Defender for Storage** plan is set to `Standard` for Storage Accounts.",
  "Risk": "Without **Defender for Storage**, suspicious access to blobs, files, and queues may go undetected. Compromised keys or `SAS` tokens can enable data exfiltration (**confidentiality**), object tampering (**integrity**), and mass deletion or ransomware-like encryption (**availability**).",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.prowler.com/checks/azure/azure-general-policies/ensure-that-azure-defender-is-set-to-on-for-storage#terraform",
    "https://www.cryptohowtoeasy.com/article/enable_azure_defender",
    "https://www.trendmicro.com/cloudoneconformity/knowledge-base/azure/SecurityCenter/defender-storage.html",
    "https://assets.ctfassets.net/lvkf21t5nlpz/3LVbJZW5rF3ZbDM4ygPLkk/21fc29e6c5c64d0909ba786d2011f5a5/CIS_Microsoft_Azure_Foundations_Benchmark_v1.3.0.pdf"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az security pricing create -n StorageAccounts --tier Standard",
      "NativeIaC": "```bicep\n// Enable Microsoft Defender for Storage at subscription level\nresource example_resource_name 'Microsoft.Security/pricings@2023-01-01' = {\n  name: 'StorageAccounts'\n  properties: {\n    pricingTier: 'Standard' // CRITICAL: sets the plan to Standard (ON) for Storage\n  }\n}\n```",
      "Other": "1. In Azure portal, open Microsoft Defender for Cloud\n2. Go to Environment settings > select <subscription>\n3. Open Defender plans\n4. Set Storage to On (Standard)\n5. Click Save",
      "Terraform": "```hcl\n# Enable Microsoft Defender for Storage at subscription level\nresource \"azurerm_security_center_subscription_pricing\" \"example_resource_name\" {\n  resource_type = \"StorageAccounts\"\n  tier          = \"Standard\" # CRITICAL: sets Storage plan to Standard (ON)\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **Defender for Storage** at the `Standard` tier for subscriptions with storage workloads. Apply **defense in depth**: restrict network exposure, enforce **least privilege** on keys and `SAS`, use short-lived tokens and rotation, and route alerts to centralized monitoring for rapid response.",
      "Url": "https://hub.prowler.com/check/defender_ensure_defender_for_storage_is_on"
    }
  },
  "Categories": [
    "forensics-ready"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
