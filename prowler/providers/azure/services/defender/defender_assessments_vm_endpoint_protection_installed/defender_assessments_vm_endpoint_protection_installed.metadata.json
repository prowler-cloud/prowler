{
  "Provider": "azure",
  "CheckID": "defender_assessments_vm_endpoint_protection_installed",
  "CheckTitle": "All virtual machines in the subscription have endpoint protection installed",
  "CheckType": [],
  "ServiceName": "defender",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "microsoft.security/assessments/governanceassignments",
  "ResourceGroup": "security",
  "Description": "**Azure virtual machines** are assessed for the presence of an **endpoint protection (antimalware)** solution and its reported health across the subscription",
  "Risk": "Absent or unhealthy **endpoint protection** lets malware execute on VMs, risking:\n- Data exfiltration (confidentiality)\n- Tampering and credential theft (integrity)\n- Ransomware, cryptomining, and outages (availability)\n\nIt also enables persistence and lateral movement to other cloud resources.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.trendmicro.com/cloudoneconformity/knowledge-base/azure/VirtualMachines/install-endpoint-protection.html#",
    "https://learn.microsoft.com/en-us/azure/security/fundamentals/antimalware"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```bicep\n// Install Microsoft Antimalware (endpoint protection) on a VM\nparam vmName string = '<example_resource_name>'\nparam location string = '<LOCATION>'\n\nresource antimalware 'Microsoft.Compute/virtualMachines/extensions@2022-11-01' = {\n  name: '${vmName}/IaaSAntimalware'\n  location: location\n  properties: {\n    publisher: 'Microsoft.Azure.Security'  // Critical: publisher for Antimalware extension\n    type: 'IaaSAntimalware'                // Critical: installs endpoint protection\n    typeHandlerVersion: '1.5'\n  }\n}\n```",
      "Other": "1. In Azure Portal, go to Microsoft Defender for Cloud\n2. Open Recommendations and search for \"Install endpoint protection solution on virtual machines\"\n3. Select the recommendation, click Fix\n4. Select all affected VMs and click Remediate (or Apply)\n5. Wait for remediation to complete and the recommendation status to turn Healthy",
      "Terraform": "```hcl\n# Install Microsoft Antimalware (endpoint protection) on a VM\nresource \"azurerm_virtual_machine_extension\" \"<example_resource_name>\" {\n  name                 = \"IaaSAntimalware\"\n  virtual_machine_id   = \"<example_resource_id>\"\n  publisher            = \"Microsoft.Azure.Security\"  # Critical: Antimalware extension publisher\n  type                 = \"IaaSAntimalware\"           # Critical: installs endpoint protection\n  type_handler_version = \"1.5\"\n}\n```"
    },
    "Recommendation": {
      "Text": "Enforce an **endpoint protection/EDR** baseline on every VM. Enable real-time protection, automatic updates, and alerting; use tamper protection and keep exclusions minimal. Apply **least privilege**, keep OS and agents patched, and continuously monitor coverage and health via Defender for Cloud.",
      "Url": "https://hub.prowler.com/check/defender_assessments_vm_endpoint_protection_installed"
    }
  },
  "Categories": [
    "vulnerabilities"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Endpoint protection will incur an additional cost to you."
}
