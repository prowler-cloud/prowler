{
  "Provider": "azure",
  "CheckID": "aks_clusters_public_access_disabled",
  "CheckTitle": "AKS cluster has a private endpoint and node public access is disabled",
  "CheckType": [],
  "ServiceName": "aks",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "microsoft.containerservice/managedclusters",
  "ResourceGroup": "container",
  "Description": "**AKS clusters** expose a **private control plane FQDN** and agent pools have `enable_node_public_ip=false`.\n\nThe evaluation focuses on the presence of a private FQDN and the absence of public IPs on nodes.",
  "Risk": "Exposed node IPs or a publicly reachable API increase attack surface, impacting **confidentiality** and **integrity**.\n- Internet scans reach kubelet, NodePort, or management agents\n- Exploits enable RCE and **lateral movement**\n- Metadata/secret theft leads to **credential compromise**\n\n**Availability** is at risk from DDoS on exposed endpoints.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://learn.microsoft.com/en-us/azure/aks/private-clusters?tabs=azure-portal",
    "https://learn.microsoft.com/en-us/azure/aks/access-private-cluster?tabs=azure-cli",
    "https://support.icompaas.com/support/solutions/articles/62000234657-ensure-clusters-are-created-with-private-endpoint-enabled-and-public-access-disabled",
    "https://docs.trendmicro.com/en-us/documentation/article/trend-vision-one-cis-aks17-542"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```bicep\n// AKS cluster with private endpoint and nodes without public IPs\nresource aks 'Microsoft.ContainerService/managedClusters@2023-11-01' = {\n  name: '<example_resource_name>'\n  location: '<location>'\n  identity: {\n    type: 'SystemAssigned'\n  }\n  properties: {\n    dnsPrefix: 'dns'\n    apiServerAccessProfile: {\n      enablePrivateCluster: true // Critical: enables private cluster (private endpoint/FQDN)\n    }\n    agentPoolProfiles: [\n      {\n        name: 'nodepool1'\n        count: 1\n        vmSize: 'Standard_DS2_v2'\n        enableNodePublicIP: false // Critical: disables public IPs on nodes\n      }\n    ]\n  }\n}\n```",
      "Other": "1. In the Azure portal, go to Azure Kubernetes Service and select your cluster\n2. Go to Networking > API server access\n3. Set Private cluster to Enabled and click Save\n4. Go to Node pools, open each pool, select Networking, set Public IP per node to Disabled, and Save\n5. Repeat step 4 for all node pools",
      "Terraform": "```hcl\n# AKS cluster with private endpoint and nodes without public IPs\nresource \"azurerm_kubernetes_cluster\" \"<example_resource_name>\" {\n  name                = \"<example_resource_name>\"\n  location            = \"<location>\"\n  resource_group_name = \"<example_resource_name>\"\n  dns_prefix          = \"dns\"\n\n  private_cluster_enabled = true # Critical: enables private cluster (private endpoint/FQDN)\n\n  default_node_pool {\n    name                  = \"nodepool1\"\n    node_count            = 1\n    vm_size               = \"Standard_DS2_v2\"\n    enable_node_public_ip = false # Critical: disables public IPs on nodes\n  }\n\n  identity {\n    type = \"SystemAssigned\"\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Adopt **private clusters** and eliminate node public IPs:\n- Set `enable_node_public_ip=false` on all pools\n- Use **Private Link** or peered VNets with VPN/ExpressRoute for admin access\n- If public API is unavoidable, restrict with IP ranges and strong auth\n- Enforce NSGs/firewalls and **least privilege** for layered defense",
      "Url": "https://hub.prowler.com/check/aks_clusters_public_access_disabled"
    }
  },
  "Categories": [
    "internet-exposed",
    "trust-boundaries",
    "cluster-security"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
