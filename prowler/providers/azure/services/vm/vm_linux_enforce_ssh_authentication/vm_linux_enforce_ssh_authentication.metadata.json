{
  "Provider": "azure",
  "CheckID": "vm_linux_enforce_ssh_authentication",
  "CheckTitle": "Linux Virtual Machine has password authentication disabled (SSH key authentication enforced)",
  "CheckType": [],
  "ServiceName": "vm",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "microsoft.compute/virtualmachines",
  "ResourceGroup": "compute",
  "Description": "**Azure Linux virtual machines** are assessed for SSH configuration where `disablePasswordAuthentication` is set to `true`, allowing only **public key authentication** and disallowing interactive passwords.",
  "Risk": "With **password-based SSH**, attackers can run brute-force or password-spray campaigns. A successful login grants remote shell, enabling command execution, data exfiltration, and lateral movement, degrading **confidentiality** and **integrity**.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/azure/VirtualMachines/ssh-authentication-type.html",
    "https://learn.microsoft.com/en-us/azure/virtual-machines/linux/create-ssh-keys-detailed"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```bicep\n// Bicep snippet to enforce SSH key authentication on a Linux VM\nresource linuxVm 'Microsoft.Compute/virtualMachines@2024-03-01' = {\n  name: '<example_resource_name>'\n  location: '<example_location>'\n  properties: {\n    osProfile: {\n      linuxConfiguration: {\n        disablePasswordAuthentication: true // CRITICAL: Disables password-based SSH; enforces SSH key authentication\n      }\n    }\n  }\n}\n```",
      "Other": "1. In Azure Portal, go to your Linux VM > Settings > Export template\n2. Click Edit template\n3. Find properties.osProfile.linuxConfiguration and set disablePasswordAuthentication to true\n4. Ensure an SSH public key is provided (adminPassword must be absent)\n5. Click Save, then Review + create to deploy the update",
      "Terraform": "```hcl\n# Minimal Terraform to enforce SSH key authentication on a Linux VM\nresource \"azurerm_linux_virtual_machine\" \"<example_resource_name>\" {\n  name                = \"<example_resource_name>\"\n  resource_group_name = \"<example_resource_name>\"\n  location            = \"<example_location>\"\n  size                = \"Standard_B1s\"\n  network_interface_ids = [\"<example_resource_id>\"]\n  admin_username        = \"azureuser\"\n\n  disable_password_authentication = true  # CRITICAL: Disables password-based SSH; enforces SSH key authentication\n\n  admin_ssh_key {                         # Required when password auth is disabled\n    username   = \"azureuser\"\n    public_key = \"<example_public_key>\"\n  }\n\n  os_disk {\n    caching              = \"ReadWrite\"\n    storage_account_type = \"Standard_LRS\"\n  }\n\n  source_image_reference {\n    publisher = \"Canonical\"\n    offer     = \"0001-com-ubuntu-server-focal\"\n    sku       = \"20_04-lts\"\n    version   = \"latest\"\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enforce **key-only SSH** by setting `disablePasswordAuthentication` to `true` and disallowing OS password logins. Use strong, passphrase-protected keys with rotation; restrict SSH via NSGs and private access or **Azure Bastion**; enable JIT; and apply **least privilege**.",
      "Url": "https://hub.prowler.com/check/vm_linux_enforce_ssh_authentication"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
