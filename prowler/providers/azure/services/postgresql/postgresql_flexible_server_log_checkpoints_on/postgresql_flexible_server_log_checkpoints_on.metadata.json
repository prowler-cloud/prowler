{
  "Provider": "azure",
  "CheckID": "postgresql_flexible_server_log_checkpoints_on",
  "CheckTitle": "PostgreSQL Flexible Server has checkpoint logging enabled",
  "CheckType": [],
  "ServiceName": "postgresql",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "low",
  "ResourceType": "microsoft.dbforpostgresql/flexibleservers",
  "ResourceGroup": "database",
  "Description": "**Azure PostgreSQL Flexible Server** has **checkpoint logging** enabled when `log_checkpoints=on`, recording each checkpoint in the server logs",
  "Risk": "Without **checkpoint logging**, visibility into write and recovery activity is reduced, hindering incident investigation and tamper detection. Unseen checkpoint storms or WAL pressure can degrade I/O and recovery, threatening **availability** and data **integrity**.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://support.icompaas.com/support/solutions/articles/62000234792-enable-log-checkpoints-parameter-on-azure-postgresql-servers-for-improved-monitoring-and-troubleshoot",
    "https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/azure/PostgreSQL/log-checkpoints.html#"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az postgres flexible-server parameter set --resource-group <resourceGroupName> --server-name <serverName> --name log_checkpoints --value ON",
      "NativeIaC": "```bicep\n// Set log_checkpoints to ON on an existing Flexible Server\nresource server 'Microsoft.DBforPostgreSQL/flexibleServers@2022-12-01' existing = {\n  name: '<example_resource_name>'\n}\n\nresource cfg 'Microsoft.DBforPostgreSQL/flexibleServers/configurations@2022-12-01' = {\n  name: 'log_checkpoints'\n  parent: server\n  properties: {\n    value: 'ON' // CRITICAL: enables checkpoint logging to pass the check\n  }\n}\n```",
      "Other": "1. In the Azure portal, open your Azure Database for PostgreSQL flexible server\n2. Go to Settings > Server parameters\n3. Search for \"log_checkpoints\"\n4. Set the value to ON\n5. Click Save",
      "Terraform": "```hcl\nresource \"azurerm_postgresql_flexible_server_configuration\" \"<example_resource_name>\" {\n  name      = \"log_checkpoints\"\n  server_id = \"<example_resource_id>\"\n  \n  value = \"ON\" # CRITICAL: enables checkpoint logging to pass the check\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable `log_checkpoints=on` and send logs to centralized, tamper-resistant storage. Monitor checkpoint frequency and failures with alerts. Apply **least privilege** to log access and set retention to support forensics as part of a **defense-in-depth** logging strategy.",
      "Url": "https://hub.prowler.com/check/postgresql_flexible_server_log_checkpoints_on"
    }
  },
  "Categories": [
    "logging"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
