{
  "Provider": "azure",
  "CheckID": "mysql_flexible_server_audit_log_connection_activated",
  "CheckTitle": "MySQL flexible server has audit_log_events including CONNECTION",
  "CheckType": [],
  "ServiceName": "mysql",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "microsoft.dbformysql/flexibleservers",
  "Description": "**Azure Database for MySQL Flexible Server** audit configuration includes the `CONNECTION` event in `audit_log_events`.",
  "Risk": "Without **CONNECTION auditing**, login attempts are invisible, weakening detection of **brute-force**, **credential stuffing**, and anomalous access. This enables unnoticed account takeover and lateral movement, impacting **confidentiality** and **integrity**, and hinders **forensics** and timely response.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-3-enable-logging-for-security-investigation",
    "https://docs.microsoft.com/en-us/azure/mysql/single-server/how-to-configure-audit-logs-portal",
    "https://www.trendmicro.com/cloudoneconformity/knowledge-base/azure/MySQL/configure-audit-log-events-for-mysql-flexible-servers.html",
    "https://www.tenable.com/audits/items/CIS_Microsoft_Azure_Foundations_v2.0.0_L2.audit:06ec721d4c0ea9169db2b0c6876c5f38",
    "https://orca.security/resources/cloud-risk-encyclopedia/audit_log_events-configuration-does-not-have-connection-set-for-mysql-database-server/",
    "https://video2.skills-academy.com/en-us/azure/mysql/flexible-server/scripts/sample-cli-audit-logs"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az mysql flexible-server parameter set --resource-group <RESOURCE_GROUP> --server-name <SERVER_NAME> --name audit_log_events --value CONNECTION",
      "NativeIaC": "```bicep\n// Set MySQL Flexible Server audit_log_events to include CONNECTION\nresource cfg 'Microsoft.DBforMySQL/flexibleServers/configurations@2021-05-01' = {\n  name: '<example_resource_name>/audit_log_events'\n  properties: {\n    value: 'CONNECTION' // Critical: ensures 'CONNECTION' is logged, making the check PASS\n  }\n}\n```",
      "Other": "1. In the Azure Portal, go to Azure Database for MySQL flexible server\n2. Select your server, then go to Server parameters\n3. Search for audit_log_events\n4. Set its value to CONNECTION\n5. Click Save",
      "Terraform": "```hcl\nresource \"azurerm_mysql_flexible_server_configuration\" \"<example_resource_name>\" {\n  name      = \"audit_log_events\"\n  server_id = \"<example_resource_id>\"\n  value     = \"CONNECTION\" # Critical: includes CONNECTION in audit logs to pass the check\n}\n```"
    },
    "Recommendation": {
      "Text": "Include `CONNECTION` in `audit_log_events` to capture login activity. Centralize and retain **audit logs**, restrict access by **least privilege**, and protect logs from tampering. Monitor for anomalous sign-in patterns and alert. Pair with **defense-in-depth** controls (MFA, network allow-listing) to reduce exposure.",
      "Url": "https://hub.prowler.com/check/mysql_flexible_server_audit_log_connection_activated"
    }
  },
  "Categories": [
    "logging"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "There are further costs incurred for storage of logs. For high traffic databases these logs will be significant. Determine your organization's needs before enabling."
}
