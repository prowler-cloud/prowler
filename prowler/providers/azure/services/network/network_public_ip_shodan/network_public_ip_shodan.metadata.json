{
  "Provider": "azure",
  "CheckID": "network_public_ip_shodan",
  "CheckTitle": "Azure public IP address is not listed in Shodan",
  "CheckType": [],
  "ServiceName": "network",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "microsoft.network/publicipaddresses",
  "ResourceGroup": "network",
  "Description": "**Azure Public IP addresses** are detected as **indexed by Shodan**, indicating Internet-visible services with open `ports` and service banner metadata.",
  "Risk": "Shodan-visible IPs are easy to discover and target, elevating risks to **confidentiality** and **integrity**. Adversaries can enumerate banners, probe open ports, brute-force access, and exploit known CVEs, enabling unauthorized entry, data exfiltration, and lateral movement.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.shodan.io/",
    "https://support.icompaas.com/support/solutions/articles/62000235334-ensure-any-public-addresses-are-listed-in-shodan-using-shodan-api-",
    "https://learn.microsoft.com/en-us/azure/virtual-network/ip-services/public-ip-addresses"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az network public-ip delete --resource-group <RESOURCE_GROUP> --name <PUBLIC_IP_NAME>",
      "NativeIaC": "```bicep\n// Remove public exposure by NOT associating a public IP\nresource subnet 'Microsoft.Network/virtualNetworks/subnets@2023-11-01' existing = {\n  name: '<example_vnet_name>/<example_subnet_name>'\n}\n\nresource nic 'Microsoft.Network/networkInterfaces@2023-11-01' = {\n  name: '<example_resource_name>'\n  location: resourceGroup().location\n  properties: {\n    ipConfigurations: [\n      {\n        name: 'ipconfig1'\n        properties: {\n          privateIPAllocationMethod: 'Dynamic'\n          subnet: { id: subnet.id }\n          // CRITICAL: No 'publicIPAddress' property -> NIC has no public IP, preventing Shodan listing\n        }\n      }\n    ]\n  }\n}\n```",
      "Other": "1. In the Azure portal, go to Public IP addresses and select the affected IP\n2. Click Dissociate and confirm to remove it from the attached resource\n3. Click Delete to remove the Public IP from your subscription",
      "Terraform": "```hcl\n# NIC without a public IP association\nresource \"azurerm_network_interface\" \"<example_resource_name>\" {\n  name                = \"<example_resource_name>\"\n  location            = \"<LOCATION>\"\n  resource_group_name = \"<RESOURCE_GROUP>\"\n\n  ip_configuration {\n    name                          = \"ipconfig1\"\n    subnet_id                     = \"<example_resource_id>\"\n    private_ip_address_allocation = \"Dynamic\"\n    # CRITICAL: Omit public_ip_address_id -> no public IP, preventing Shodan listing\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Minimize **public exposure**: prefer **private endpoints** or VPN/bastion, restrict ingress per least privilege (avoid `0.0.0.0/0`), close unused ports, patch and harden services, and apply defense-in-depth segmentation. Continuously inventory public IPs and rotate them if sensitive banners were exposed.",
      "Url": "https://hub.prowler.com/check/network_public_ip_shodan"
    }
  },
  "Categories": [
    "internet-exposed"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
