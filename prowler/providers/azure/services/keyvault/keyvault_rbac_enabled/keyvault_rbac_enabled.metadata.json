{
  "Provider": "azure",
  "CheckID": "keyvault_rbac_enabled",
  "CheckTitle": "Key Vault uses Azure RBAC for access control",
  "CheckType": [],
  "ServiceName": "keyvault",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "microsoft.keyvault/vaults",
  "ResourceGroup": "security",
  "Description": "**Azure Key Vault** uses the **Azure RBAC permission model** for data-plane access to keys, secrets, and certificates, rather than legacy access policies.\n\nEvaluates whether data access is managed through role assignments at the vault.",
  "Risk": "Without **Azure RBAC**, data access relies on coarse access policies. **Control-plane Contributors** can grant themselves data-plane rights, enabling secret or key exfiltration and unauthorized crypto operations.\n\nLack of JIT and least-privilege weakens **confidentiality** and **integrity** and hinders auditing.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://learn.microsoft.com/en-us/azure/key-vault/general/rbac-guide?tabs=azure-cli",
    "https://learn.microsoft.com/en-gb/azure/role-based-access-control/role-assignments-portal?tabs=current"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az keyvault update --name <KEY_VAULT_NAME> --resource-group <RESOURCE_GROUP_NAME> --enable-rbac-authorization true",
      "NativeIaC": "```bicep\n// Enable Azure RBAC on a Key Vault\nresource kv 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: '<example_resource_name>'\n  location: '<location>'\n  properties: {\n    tenantId: '<tenant_id>'\n    enableRbacAuthorization: true // Critical: switches permission model to Azure RBAC to pass the check\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n  }\n}\n```",
      "Other": "1. In Azure Portal, go to Key Vaults and open <KEY_VAULT_NAME>\n2. Under Settings, select Properties\n3. Set Permission model to Azure role-based access control\n4. Click Save",
      "Terraform": "```hcl\nresource \"azurerm_key_vault\" \"<example_resource_name>\" {\n  name                       = \"<example_resource_name>\"\n  location                   = \"<location>\"\n  resource_group_name        = \"<example_resource_name>\"\n  tenant_id                  = \"<tenant_id>\"\n  sku_name                   = \"standard\"\n  enable_rbac_authorization  = true // Critical: enables Azure RBAC to satisfy the control\n}\n```"
    },
    "Recommendation": {
      "Text": "Adopt **Azure RBAC** for Key Vault data access and design roles with **least privilege** at appropriate scopes (prefer vault-level per app/env). Use **Privileged Identity Management** for JIT, restrict control-plane Contributor rights, and monitor role assignments. *Role assignments aren't preserved after soft-delete recovery*.",
      "Url": "https://hub.prowler.com/check/keyvault_rbac_enabled"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Implementation needs to be properly designed from the ground up, as this is a fundamental change to the way key vaults are accessed/managed. Changing permissions to key vaults will result in loss of service as permissions are re-applied. For the least amount of downtime, map your current groups and users to their corresponding permission needs."
}
