{
  "Provider": "azure",
  "CheckID": "keyvault_rbac_secret_expiration_set",
  "CheckTitle": "RBAC-enabled Key Vault has expiration date set for all enabled secrets",
  "CheckType": [],
  "ServiceName": "keyvault",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "microsoft.keyvault/vaults",
  "ResourceGroup": "security",
  "Description": "**Azure Key Vault (RBAC)** secrets are assessed to confirm every **enabled secret** has an `exp` (expiration) date configured",
  "Risk": "Without an **expiration**, secrets become perpetual credentials. Leaked or abandoned values can grant persistent access, undermining **confidentiality** and **integrity**. Attackers can reuse old secrets to maintain footholds, perform unauthorized API calls, and exfiltrate data.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://learn.microsoft.com/en-us/azure/key-vault/general/basic-concepts",
    "https://learn.microsoft.com/en-us/azure/key-vault/general/about-keys-secrets-certificates#key-vault-secrets"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az keyvault secret set-attributes --vault-name <vaultName> --name <secretName> --expires <YYYY-MM-DDTHH:MM:SSZ>",
      "NativeIaC": "```bicep\n// Set expiration on a Key Vault secret\nresource secret 'Microsoft.KeyVault/vaults/secrets@2019-09-01' = {\n  name: '<example_resource_name>/<example_resource_name>'\n  properties: {\n    // CRITICAL: sets the secret expiration timestamp (Unix epoch seconds)\n    attributes: {\n      exp: 1735689600 // 2025-01-01T00:00:00Z\n    }\n    value: '<secret_value>'\n  }\n}\n```",
      "Other": "1. In Azure Portal, go to Key vaults and open your vault\n2. Select Secrets, choose the secret, then open its Current version\n3. Set Expiration date (UTC) and click Save",
      "Terraform": "```hcl\nresource \"azurerm_key_vault_secret\" \"<example_resource_name>\" {\n  name         = \"<example_resource_name>\"\n  value        = \"<secret_value>\"\n  key_vault_id = \"<example_resource_id>\"\n\n  # CRITICAL: sets the secret expiration timestamp\n  expiration_date = \"2025-01-01T00:00:00Z\"\n}\n```"
    },
    "Recommendation": {
      "Text": "Set an **expiration** on all enabled secrets and enforce a **regular rotation policy**.\n\nPrefer **short-lived, identity-based access** to reduce secret usage. Apply **least privilege** for secret access, alert on upcoming expirations, and automate rotation and version cleanup to minimize exposure.",
      "Url": "https://hub.prowler.com/check/keyvault_rbac_secret_expiration_set"
    }
  },
  "Categories": [
    "secrets"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Secrets cannot be used beyond their assigned expiry date respectively. Secrets need to be rotated periodically wherever they are used."
}
