{
  "Provider": "azure",
  "CheckID": "keyvault_key_rotation_enabled",
  "CheckTitle": "Key Vault key has automatic rotation enabled",
  "CheckType": [],
  "ServiceName": "keyvault",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "microsoft.keyvault/vaults",
  "ResourceGroup": "security",
  "Description": "**Azure Key Vault** keys configured with a **rotation policy** that includes a `Rotate` lifetime action.\n\nThe evaluation looks for lifetime actions that schedule automatic key version creation; keys without this policy are not configured for auto-rotation.",
  "Risk": "Without **auto-rotation**, keys may outlive policy, increasing exposure if material is leaked and weakening **confidentiality**.\n\nExpired keys without planned rollover can break decrypt/unwrap operations, impacting **availability**. Long-lived keys hinder incident response and enable prolonged misuse of stale versions.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://learn.microsoft.com/en-us/azure/storage/common/customer-managed-keys-overview#update-the-key-version",
    "https://learn.microsoft.com/en-us/azure/key-vault/keys/how-to-configure-key-rotation",
    "https://www.techtarget.com/searchcloudcomputing/tutorial/How-to-perform-and-automate-key-rotation-in-Azure-Key-Vault"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az keyvault key rotation-policy update --vault-name <VAULT_NAME> --name <KEY_NAME> --value '{\"lifetimeActions\":[{\"trigger\":{\"timeAfterCreate\":\"P18M\"},\"action\":{\"type\":\"Rotate\"}}]}'",
      "NativeIaC": "```bicep\nresource key 'Microsoft.KeyVault/vaults/keys@2023-02-01' = {\n  name: '<example_resource_name>/<example_resource_name>'\n  location: resourceGroup().location\n  properties: {\n    kty: 'RSA'\n    rotationPolicy: {\n      lifetimeActions: [\n        {\n          trigger: { timeAfterCreate: 'P18M' }\n          action: { type: 'Rotate' } // Critical: enables automatic rotation, satisfying the check\n        }\n      ]\n    }\n  }\n}\n```",
      "Other": "1. In Azure Portal, go to Key Vaults > <your key vault> > Keys\n2. Select the key <KEY_NAME>\n3. Click Rotation policy\n4. Enable auto-rotation and set a rotation interval (e.g., After creation: P18M)\n5. Click Save",
      "Terraform": "```hcl\nresource \"azurerm_key_vault_key\" \"key\" {\n  name         = \"<example_resource_name>\"\n  key_vault_id = \"<example_resource_id>\"\n  key_type     = \"RSA\"\n\n  rotation_policy {\n    automatic {\n      time_after_creation = \"P18M\" # Critical: creates a Rotate lifetime action to enable auto-rotation\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Define a per-key **rotation policy** to automatically `Rotate` on a fixed cadence (e.g., `P2Y`) and set an **expiry** to enforce lifecycle.\n\nUse versionless key URIs in dependent services, apply **least privilege** to rotation roles, enable near-expiry notifications, and monitor events for **defense in depth**.",
      "Url": "https://hub.prowler.com/check/keyvault_key_rotation_enabled"
    }
  },
  "Categories": [
    "encryption"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "There are an additional costs per operation in running the needed applications."
}
