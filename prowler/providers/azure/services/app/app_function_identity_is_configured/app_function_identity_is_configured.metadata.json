{
  "Provider": "azure",
  "CheckID": "app_function_identity_is_configured",
  "CheckTitle": "Function app has a system-assigned or user-assigned managed identity enabled",
  "CheckType": [],
  "ServiceName": "app",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "microsoft.web/sites",
  "ResourceGroup": "serverless",
  "Description": "**Azure Function Apps** are evaluated for an enabled **managed identity** (`SystemAssigned` or `UserAssigned`) configured on the app.\n\nThe finding indicates whether an identity is present to support token-based access to other Azure resources.",
  "Risk": "Without **managed identities**, apps rely on stored secrets/keys, risking:\n- Confidentiality loss from leaked credentials\n- Integrity tampering via unauthorized writes\n- Availability outages from secret expiry/rotation\n\nCompromised keys enable unauthorized access and lateral movement.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.trendmicro.com/cloudoneconformity/knowledge-base/azure/Functions/azure-function-system-assigned-identity.html",
    "https://learn.microsoft.com/en-us/azure/app-service/overview-managed-identity",
    "https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az functionapp identity assign --resource-group <resource_group> --name <function_name>",
      "NativeIaC": "```bicep\n// Enable managed identity on an existing Function App\nparam location string = resourceGroup().location\n\nresource functionApp 'Microsoft.Web/sites@2022-03-01' = {\n  name: '<example_resource_name>'\n  location: location\n  identity: {\n    type: 'SystemAssigned' // CRITICAL: Enables a system-assigned managed identity so the check passes\n  }\n}\n```",
      "Other": "1. In Azure Portal, go to your Function App\n2. Under Settings, select Identity\n3. On the System assigned tab, set Status to On\n4. Click Save",
      "Terraform": "```hcl\n# Enable managed identity on an existing Function App via PATCH\nresource \"azapi_update_resource\" \"<example_resource_name>\" {\n  type       = \"Microsoft.Web/sites@2022-03-01\"\n  resource_id = \"<example_resource_id>\"\n  body = jsonencode({\n    identity = {\n      type = \"SystemAssigned\" # CRITICAL: Enables a system-assigned managed identity so the check passes\n    }\n  })\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable a **managed identity** on each Function App (`SystemAssigned` per app, `UserAssigned` for shared/long-lived needs). Replace secrets with token-based access and grant only required RBAC roles (**least privilege**). Remove keys from settings, apply **separation of duties**, and monitor access as part of **defense in depth**.",
      "Url": "https://hub.prowler.com/check/app_function_identity_is_configured"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
