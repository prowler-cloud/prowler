{
  "Provider": "azure",
  "CheckID": "app_function_ftps_deployment_disabled",
  "CheckTitle": "Function app has FTP and FTPS deployments disabled",
  "CheckType": [],
  "ServiceName": "app",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "microsoft.web/sites",
  "ResourceGroup": "serverless",
  "Description": "**Azure Function apps** are evaluated for the `ftps_state` setting that controls **FTP/FTPS deployment endpoints**. Values `AllAllowed` or `FtpsOnly` indicate deployment over FTP/FTPS is enabled, while `Disabled` indicates both endpoints are turned off.",
  "Risk": "Enabled **FTP/FTPS deployment** undermines confidentiality and integrity. FTP exposes credentials in cleartext; FTPS still presents a public basic-auth endpoint susceptible to brute force and credential reuse. Compromise enables **unauthorized code pushes**, leading to RCE, data leakage, and service disruption.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://learn.microsoft.com/en-us/azure/azure-functions/functions-deployment-technologies?tabs=windows#trigger-syncing",
    "https://docs.microsoft.com/en-us/azure/app-service/deploy-ftp"
  ],
  "Remediation": {
    "Code": {
      "CLI": "az webapp config set --resource-group <resource-group> --name <app-name> --ftps-state Disabled",
      "NativeIaC": "```bicep\n// Disable FTP and FTPS on an existing Function App\nresource functionApp 'Microsoft.Web/sites@2022-09-01' existing = {\n  name: '<example_resource_name>'\n}\n\nresource webConfig 'Microsoft.Web/sites/config@2022-09-01' = {\n  name: 'web'\n  parent: functionApp\n  properties: {\n    ftpsState: 'Disabled' // CRITICAL: Disables both FTP and FTPS deployments\n  }\n}\n```",
      "Other": "1. In the Azure portal, go to your Function App\n2. Select Configuration > General settings\n3. Under Platform settings, set FTP state to Disabled\n4. Click Save",
      "Terraform": "```hcl\n# Disable FTP and FTPS on a Function App\nresource \"azurerm_linux_function_app\" \"<example_resource_name>\" {\n  name                       = \"<example_resource_name>\"\n  resource_group_name        = \"<example_resource_name>\"\n  location                   = \"<example_location>\"\n  service_plan_id            = \"<example_resource_id>\"\n  storage_account_name       = \"<example_resource_name>\"\n  storage_account_access_key = \"<example_secret_value>\"\n  functions_extension_version = \"~4\"\n\n  site_config {\n    ftps_state = \"Disabled\" # CRITICAL: Disables both FTP and FTPS deployments\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Disable **FTP and FTPS deployment** on Function apps (`ftps_state: Disabled`). Adopt **defense in depth**: deploy via **CI/CD** with packaged artifacts (zip or containers), enforce **least privilege** publishing access, and limit exposure of build and deployment endpoints. *If unavoidable, use FTPS-only with TLS 1.2 and rotate credentials promptly.*",
      "Url": "https://hub.prowler.com/check/app_function_ftps_deployment_disabled"
    }
  },
  "Categories": [
    "internet-exposed"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "This check ensures that Azure Functions are deployed securely, reducing the attack surface and protecting sensitive information."
}
