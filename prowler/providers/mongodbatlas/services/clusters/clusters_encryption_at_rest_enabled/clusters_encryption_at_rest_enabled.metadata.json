{
  "Provider": "mongodbatlas",
  "CheckID": "clusters_encryption_at_rest_enabled",
  "CheckTitle": "MongoDB Atlas cluster has encryption at rest enabled with a supported provider or EBS volume encryption",
  "CheckType": [],
  "ServiceName": "clusters",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "critical",
  "ResourceType": "",
  "Description": "MongoDB Atlas clusters are evaluated for **encryption at rest**. The check looks for a supported encryption provider configured (not `NONE`) or storage-level encryption enabled (e.g., `encryptEBSVolume=true`). Unsupported providers or explicit disablement are highlighted.",
  "Risk": "Absent or misconfigured at-rest encryption allows disks and snapshots to be read if storage, backups, or images are accessed by attackers or insiders. This exposes sensitive records, erodes **confidentiality**, and enables quiet **data exfiltration** after host or control-plane compromise.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.mongodb.com/docs/atlas/security-kms-encryption/",
    "https://library.tf/providers/timgchile/mongodbatlas/latest/docs/resources/encryption_at_rest",
    "https://codemax.app/snippet/advanced-data-encryption-strategies-for-mongodb-atlas/",
    "https://www.pulumi.com/registry/packages/mongodbatlas/api-docs/getencryptionatrest/",
    "https://www.prisma.io/dataguide/mongodb/mongodb-atlas-setup",
    "https://dinfratechsource.wordpress.com/2019/06/24/mongodb-in-the-cloud-with-atlas/",
    "https://stackoverflow.com/questions/44369296/how-to-enable-mongodb-atlas-data-encryption-at-rest"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. In Atlas, go to Security > Advanced\n2. Toggle \"Encryption at Rest using your Key Management\" to On and enter your provider details (AWS KMS/Azure Key Vault/GCP KMS)\n3. Save\n4. Go to Database > Clusters, open the menu for <example_resource_name> and click Edit Configuration\n5. Expand Additional Settings and set \"Manage your own encryption keys\" to Yes\n6. Review Changes > Apply Changes",
      "Terraform": "```hcl\n# Enable project-level KMS\nresource \"mongodbatlas_encryption_at_rest\" \"<example_resource_name>\" {\n  project_id = \"<example_resource_id>\"\n  aws_kms_config {\n    enabled                = true  # critical: turns on KMS for the project so clusters can use it\n    customer_master_key_id = \"<KMS_KEY_ID>\"\n    region                 = \"<AWS_REGION>\"\n    role_id                = \"<ATLAS_AWS_ROLE_ID>\"\n  }\n}\n\n# Set the cluster to use a supported encryption provider\nresource \"mongodbatlas_advanced_cluster\" \"<example_resource_name>\" {\n  project_id                  = \"<example_resource_id>\"\n  name                        = \"<example_resource_name>\"\n  cluster_type                = \"REPLICASET\"\n  encryption_at_rest_provider = \"AWS\"  # critical: enables encryption at rest with a supported provider\n\n  replication_specs {\n    region_configs {\n      provider_name = \"AWS\"\n      region_name   = \"<AWS_REGION>\"\n      electable_specs {\n        instance_size = \"M10\"\n        node_count    = 3\n      }\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **encryption at rest** with a supported provider and prefer **customer-managed keys** to control lifecycle and access. Apply least-privilege to key usage, restrict KMS connectivity, and monitor key health and rotation. If using AWS, also ensure volumes are encrypted. This enforces defense-in-depth and data confidentiality.",
      "Url": "https://hub.prowler.com/check/clusters_encryption_at_rest_enabled"
    }
  },
  "Categories": [
    "encryption"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
