{
  "Provider": "m365",
  "CheckID": "defender_malware_policy_common_attachments_filter_enabled",
  "CheckTitle": "Defender malware policy has Common Attachment Types Filter enabled",
  "CheckType": [],
  "ServiceName": "defender",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "",
  "Description": "**Defender for Office 365 anti-malware policies** use the **Common Attachment Types Filter** to block risky file formats regardless of extension. The evaluation checks whether this filter is enabled across default and custom policies and considers policy precedence that could override or bypass the protection.",
  "Risk": "Without consistent **attachment type blocking**, malicious `exe`, `js`, `iso`, or `zip` payloads can reach users, enabling code execution and phishing kits.\n- Confidentiality: data exfiltration\n- Integrity: credential theft/tampering\n- Availability: ransomware\n\nPolicy scope/priority gaps can leave specific users unprotected.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-rules/common-attachment-blocking-scenarios",
    "https://petri.com/microsoft-changelog/anti-malware-policy-common-attachment-filter-additional-file-types-block-by-default/",
    "https://www.quixtec.com/updated-antimalware-default-policy-common-attachment-filter-settings-updates/",
    "https://o365info.com/block-email-attachment-microsoft-365/",
    "https://learn.microsoft.com/en-us/powershell/module/exchange/set-malwarefilterpolicy?view=exchange-ps",
    "https://security.microsoft.com.",
    "https://learn.microsoft.com/en-us/defender-office-365/anti-malware-policies-configure?view=o365-worldwide",
    "https://blog.ciaops.com/2025/09/04/configuring-robust-anti-malware-policies-in-exchange-online-protection-eop-with-enhancements-from-microsoft-defender-for-office-365-mdo/",
    "https://activedirectorypro.com/block-dangerous-file-attachments-in-exchange-online/"
  ],
  "Remediation": {
    "Code": {
      "CLI": "Set-MalwareFilterPolicy -Identity <POLICY_NAME> -EnableFileFilter $true",
      "NativeIaC": "",
      "Other": "1. Sign in to Microsoft 365 Defender: https://security.microsoft.com\n2. Go to Email & collaboration > Policies & rules > Threat policies > Anti-malware\n3. Open the failing anti-malware policy (e.g., Default or the named custom policy)\n4. Click Edit protection settings\n5. Enable \"Enable the common attachments filter\"\n6. Click Save",
      "Terraform": ""
    },
    "Recommendation": {
      "Text": "Enable the **Common Attachment Types Filter** in all applicable anti-malware policies and choose a strict action (e.g., `Quarantine` or `Reject`).\n- Block high-risk formats; review the list regularly\n- Align policy precedence to cover every recipient\n- Use defense-in-depth: **Safe Attachments**, **Safe Links**, **ZAP**; apply **least privilege** to file types",
      "Url": "https://hub.prowler.com/check/defender_malware_policy_common_attachments_filter_enabled"
    }
  },
  "Categories": [
    "email-security",
    "e3"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
