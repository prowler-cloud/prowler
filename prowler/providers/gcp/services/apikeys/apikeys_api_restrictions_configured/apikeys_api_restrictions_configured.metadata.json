{
  "Provider": "gcp",
  "CheckID": "apikeys_api_restrictions_configured",
  "CheckTitle": "API key is restricted to specific Google APIs",
  "CheckType": [],
  "ServiceName": "apikeys",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "apikeys.googleapis.com/Key",
  "Description": "Google Cloud API keys have **API restrictions** limiting calls to specific services. The finding checks that keys are restricted to named Google APIs and do not include the broad `cloudapis.googleapis.com`, indicating keys are scoped only to intended use.",
  "Risk": "Unrestricted keys-or ones allowing `cloudapis.googleapis.com`-expand attack surface. A leaked key can call many APIs without identity, enabling data exposure, unintended changes on permissive endpoints, and **quota/billing exhaustion**, impacting confidentiality, integrity, and availability.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://cloud.google.com/docs/authentication/api-keys",
    "https://cloud.google.com/docs/authentication/api-keys-best-practices"
  ],
  "Remediation": {
    "Code": {
      "CLI": "gcloud services api-keys update <KEY_ID> --api-target=service=<SERVICE_NAME>",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to APIs & Services > Credentials\n2. Click the API key name to edit it\n3. In API restrictions, select \"Restrict key\"\n4. Choose only the specific API(s) needed (do not select \"All Google APIs\")\n5. Click Save",
      "Terraform": "```hcl\nresource \"google_apikeys_key\" \"key\" {\n  display_name = \"<example_resource_name>\"\n\n  restrictions {\n    api_targets {\n      service = \"<SERVICE_NAME>\" # Critical: restricts the key to a specific API, removing any \"All Google APIs\" (cloudapis.googleapis.com)\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply **least privilege**: restrict each API key to only the specific APIs it must access and never include `cloudapis.googleapis.com`. Add **application restrictions** (referrers, IPs, app IDs), rotate keys, and monitor usage. Prefer **service accounts** or short-lived tokens for production as part of **defense in depth**.",
      "Url": "https://hub.prowler.com/check/apikeys_api_restrictions_configured"
    }
  },
  "Categories": [
    "secrets",
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
