{
  "Provider": "gcp",
  "CheckID": "iam_role_kms_enforce_separation_of_duties",
  "CheckTitle": "Project members are not assigned both Cloud KMS Admin and CryptoKey Encrypter/Decrypter roles",
  "CheckType": [],
  "ServiceName": "iam",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "cloudresourcemanager.googleapis.com/Project",
  "Description": "Project IAM assignments are analyzed for **Cloud KMS** separation of duties: principals simultaneously granted `roles/cloudkms.admin` and any of `roles/cloudkms.cryptoKeyEncrypterDecrypter`, `roles/cloudkms.cryptoKeyEncrypter`, or `roles/cloudkms.cryptoKeyDecrypter`.",
  "Risk": "Combining key management and key usage undermines **confidentiality**, **integrity**, and **availability**:\n- Unauthorized decryption of sensitive data\n- Tampering with policies or rotation to conceal access\n- Disabling or destroying keys, causing outages\n\nThis concentration of power reduces oversight and auditability.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/gcp/CloudIAM/enforce-separation-of-duties-for-kms-related-roles.html",
    "https://cloud.google.com/kms/docs/separation-of-duties"
  ],
  "Remediation": {
    "Code": {
      "CLI": "gcloud projects remove-iam-policy-binding <PROJECT_ID> --member=<MEMBER> --role=roles/cloudkms.admin",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to IAM & Admin > IAM\n2. Locate the principal listed in the finding and click Edit principal\n3. Remove either \"Cloud KMS Admin\" or any of the \"Cloud KMS CryptoKey Encrypter/Decrypter\" roles from the project\n4. Click Save",
      "Terraform": "```hcl\nresource \"google_project_iam_binding\" \"<example_resource_name>\" {\n  project = \"<PROJECT_ID>\"\n  role    = \"roles/cloudkms.admin\" # Critical: ensure the offending principal is NOT bound as KMS Admin\n  members = [\n    \"user:<ALLOWED_MEMBER_EMAIL>\" # Critical: exclude any member who also has CryptoKey* roles to enforce separation of duties\n  ]\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply **least privilege** and **separation of duties**:\n- Never combine `roles/cloudkms.admin` with any `roles/cloudkms.cryptoKey*`\n- Isolate key management and usage in dedicated projects\n- Require approvals, log all key access, and monitor\n- Avoid broad `roles/owner` on key scopes",
      "Url": "https://hub.prowler.com/check/iam_role_kms_enforce_separation_of_duties"
    }
  },
  "Categories": [
    "identity-access",
    "encryption"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
