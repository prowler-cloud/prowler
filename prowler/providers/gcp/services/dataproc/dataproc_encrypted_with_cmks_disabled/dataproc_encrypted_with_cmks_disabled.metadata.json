{
  "Provider": "gcp",
  "CheckID": "dataproc_encrypted_with_cmks_disabled",
  "CheckTitle": "Dataproc cluster is encrypted with a customer-managed encryption key (CMEK)",
  "CheckType": [],
  "ServiceName": "dataproc",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "dataproc.googleapis.com/Cluster",
  "Description": "Dataproc clusters use **Customer-Managed Encryption Keys** (`CMEK`) for VM **persistent disk** encryption. The finding determines whether a customer KMS key is configured for disk data instead of the default Google-managed keys.",
  "Risk": "Without **CMEK** on Dataproc disks, keys remain provider-controlled, limiting **rotation**, **revocation**, and **location control**. This reduces containment if disks or snapshots are exposed and may block **data sovereignty** requirements, impacting **confidentiality** and incident response.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/gcp/Dataproc/enable-encryption-with-cmks-for-dataproc-clusters.html",
    "https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/customer-managed-encryption"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to Dataproc > Clusters\n2. Click Create cluster\n3. In Cluster configuration, open Security (or Encryption)\n4. For Disk encryption key, select Customer-managed key and choose your Cloud KMS key\n5. Click Create\n6. Migrate workloads to the new cluster and delete the old non-CMEK cluster",
      "Terraform": "```hcl\nresource \"google_dataproc_cluster\" \"<example_resource_name>\" {\n  name   = \"<example_resource_name>\"\n  region = \"<example_region>\"\n\n  cluster_config {\n    encryption_config {\n      gce_pd_kms_key_name = \"projects/<example_project_id>/locations/<example_region>/keyRings/<example_keyring_name>/cryptoKeys/<example_key_name>\" # FIX: Sets CMEK for persistent disks to pass the check\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **CMEK** for Dataproc disk, job-argument, and staging-bucket encryption.\n- Grant KMS access with **least privilege** to required service accounts\n- Enforce **regular rotation** and support **revocation/disable** procedures\n- Keep keys co-located with data and monitor KMS usage\n- Consider **Cloud EKM** for external key control",
      "Url": "https://hub.prowler.com/check/dataproc_encrypted_with_cmks_disabled"
    }
  },
  "Categories": [
    "encryption"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
