{
  "Provider": "gcp",
  "CheckID": "compute_instance_ip_forwarding_is_enabled",
  "CheckTitle": "Compute Engine VM instance has IP forwarding disabled",
  "CheckType": [],
  "ServiceName": "compute",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "compute.googleapis.com/Instance",
  "Description": "**Compute Engine VM instances** with `canIpForward` enabled are identified. This setting allows a VM to process packets not addressed to its own IP.\n\nInstances created by GKE (`gke-` prefix) are excluded from this evaluation.",
  "Risk": "With **IP forwarding** a VM can route traffic for other addresses. If compromised, it can:\n- Spoof or tamper flows (**integrity**)\n- Intercept/redirect internal traffic (**confidentiality**)\n- Mask egress for exfiltration and enable lateral movement, degrading **availability**",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.datadoghq.com/security/default_rules/def-000-tqp/",
    "https://stackoverflow.com/questions/45994148/google-cloud-vm-instance-how-to-turn-on-ip-forwarding",
    "https://docs.prowler.com/checks/gcp/google-cloud-networking-policies/bc_gcp_networking_12#terraform",
    "https://cloud.google.com/compute/docs/instances/create-start-instance",
    "https://docs.prowler.com/checks/gcp/google-cloud-networking-policies/bc_gcp_networking_12/",
    "https://serverfault.com/questions/887843/how-to-turn-on-ip-forwarding-for-interface-if-forwarding-rule-was-already-create",
    "https://docs.prowler.com/checks/gcp/google-cloud-networking-policies/bc_gcp_networking_12",
    "https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ComputeEngine/disable-ip-forwarding.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "gcloud compute instances update-from-file <example_resource_name> --zone <ZONE> --source=<PATH_TO_CONFIG_WITH_canIpForward_false> --most-disruptive-allowed-action=RESTART",
      "NativeIaC": "",
      "Other": "1. In Google Cloud console, go to Compute Engine > VM instances and select the VM (exclude names starting with gke-)\n2. Click Delete to remove the instance with IP forwarding enabled\n3. Click Create instance\n4. Expand Networking > Network interfaces > Edit and ensure IP forwarding is Off (default)\n5. Click Create",
      "Terraform": "```hcl\nresource \"google_compute_instance\" \"<example_resource_name>\" {\n  name         = \"<example_resource_name>\"\n  machine_type = \"e2-micro\"\n  zone         = \"<ZONE>\"\n\n  can_ip_forward = false  # Critical: disables IP forwarding to pass the check\n\n  boot_disk {\n    initialize_params {\n      image = \"debian-cloud/debian-12\"\n    }\n  }\n\n  network_interface {\n    network = \"default\"\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Disable **IP forwarding** on general-purpose VMs and allow it only for vetted **network appliances**, following **least privilege**.\n\nEnforce **network segmentation**, restrict routes, review exceptions regularly, and monitor egress to uphold **defense in depth**. *Exclude platform-managed nodes that require forwarding.*",
      "Url": "https://hub.prowler.com/check/compute_instance_ip_forwarding_is_enabled"
    }
  },
  "Categories": [
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
