{
  "Provider": "gcp",
  "CheckID": "compute_network_dns_logging_enabled",
  "CheckTitle": "VPC network has Cloud DNS logging enabled",
  "CheckType": [],
  "ServiceName": "compute",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "compute.googleapis.com/Network",
  "Description": "**VPC networks** are assessed for a **DNS policy** that enables **Cloud DNS query logging**. When present, resolvers record queries for the network from VMs, GKE, peering, and inbound forwarding, with entries written to Cloud Logging.",
  "Risk": "Without **DNS query logs**, suspicious lookups (C2, DGA, DNS exfiltration) go unseen, reducing **confidentiality** and hindering **incident response**. Visibility gaps also hide misconfigurations and elevated `NXDOMAIN` rates that can impact the **availability** of name resolution.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://cloud.google.com/dns/docs/monitoring",
    "https://docs.cloud.google.com/compute/docs/networking/monitor-dns-failures",
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/gcp/CloudVPC/dns-logging-for-vpcs.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. In the Google Cloud console, go to Cloud DNS > Policies\n2. If the VPC already has a policy: select the policy, click Edit, check Enable logging, click Save\n3. If there is no policy for the VPC: click Create policy, enter a name, check Enable logging, add the target VPC network, click Create",
      "Terraform": "```hcl\nresource \"google_dns_policy\" \"<example_resource_name>\" {\n  name           = \"<example_resource_name>\"\n  enable_logging = true  # CRITICAL: turns on DNS query logging for the policy\n\n  networks {\n    network_url = \"projects/<PROJECT_ID>/global/networks/<example_resource_name>\"  # Attach to the target VPC\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **Cloud DNS query logging** for all VPC networks via **DNS policies** and route logs to centralized analysis. Enforce **least privilege** on log access, set retention and sampling to manage cost, and add detections for malicious domains. Apply **defense in depth** with DNS response policies and egress controls.",
      "Url": "https://hub.prowler.com/check/compute_network_dns_logging_enabled"
    }
  },
  "Categories": [
    "logging",
    "forensics-ready"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
