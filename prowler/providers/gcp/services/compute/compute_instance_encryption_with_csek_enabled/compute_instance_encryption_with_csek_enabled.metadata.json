{
  "Provider": "gcp",
  "CheckID": "compute_instance_encryption_with_csek_enabled",
  "CheckTitle": "VM instance has all disks encrypted with Customer-Supplied Encryption Keys (CSEK)",
  "CheckType": [],
  "ServiceName": "compute",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "compute.googleapis.com/Instance",
  "Description": "Compute Engine VM disks use **Customer-Supplied Encryption Keys** (`CSEK`) rather than provider-managed keys. The finding flags instances where any attached disk is not protected with the customer-provided key.",
  "Risk": "Without **CSEK**, encryption depends on provider-managed keys, reducing control over key lifecycle and access. This weakens confidentiality, impedes separation of duties, and can delay key revocation, increasing exposure to unauthorized data access and regulatory gaps.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://cloud.google.com/storage/docs/encryption/using-customer-supplied-keys",
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/gcp/ComputeEngine/enable-encryption-with-csek.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to Compute Engine > VM instances\n2. Click Create instance (you must recreate VMs to use CSEK on boot disks)\n3. In Boot disk, click Change\n4. Expand Encryption and select Customer-supplied key\n5. Paste your base64-encoded 256-bit key and click Select\n6. If adding additional disks: in Additional disks, add a disk and set Encryption to Customer-supplied key with the same key\n7. Click Create to launch the VM with all disks encrypted using CSEK\n8. Migrate workload from the old VM and delete it when done",
      "Terraform": "```hcl\nresource \"google_compute_instance\" \"<example_resource_name>\" {\n  name         = \"<example_resource_name>\"\n  machine_type = \"e2-medium\"\n  zone         = \"<example_zone>\"\n\n  boot_disk {\n    initialize_params { image = \"debian-cloud/debian-12\" }\n    # Critical: enables Customer-Supplied Encryption Key (CSEK) for the boot disk\n    disk_encryption_key { raw_key = \"<BASE64_32BYTE_KEY>\" }  # base64-encoded AES-256 key\n  }\n\n  network_interface { network = \"default\" }\n}\n```"
    },
    "Recommendation": {
      "Text": "Use **CSEK** for VM disks that require full control over data-at-rest keys. Apply **least privilege** to key custodians, store keys in hardened vaults/HSMs, enforce rotation and rapid revocation, and document recovery procedures. Combine with **defense in depth** (network and IAM controls) to limit blast radius.",
      "Url": "https://hub.prowler.com/check/compute_instance_encryption_with_csek_enabled"
    }
  },
  "Categories": [
    "encryption"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
