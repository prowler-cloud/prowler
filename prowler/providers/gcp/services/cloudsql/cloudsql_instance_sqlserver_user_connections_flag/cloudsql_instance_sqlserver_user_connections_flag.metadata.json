{
  "Provider": "gcp",
  "CheckID": "cloudsql_instance_sqlserver_user_connections_flag",
  "CheckTitle": "Cloud SQL SQL Server instance has the 'user connections' database flag set to 0",
  "CheckType": [],
  "ServiceName": "cloudsql",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "sqladmin.googleapis.com/Instance",
  "Description": "**Cloud SQL for SQL Server** instances are evaluated to ensure the `user connections` database flag is set to `0` (unlimited), avoiding any artificial cap on concurrent user sessions",
  "Risk": "A capped `user connections` value can exhaust available sessions, causing login failures, aborted transactions, and timeouts. This reduces **availability**, can delay administrative access, and may lead to **integrity** issues from failed or inconsistent retries under load.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/gcp/CloudSQL/configure-user-connection-flag.html",
    "https://cloud.google.com/sql/docs/sqlserver/flags"
  ],
  "Remediation": {
    "Code": {
      "CLI": "gcloud sql instances patch <example_resource_name> --database-flags='\"user connections\"=0'",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to Cloud SQL > Instances\n2. Open the SQL Server instance <example_resource_name> and click Edit\n3. In Database flags, click Add item, select \"user connections\", set value to 0\n4. Click Save (the instance may restart)",
      "Terraform": "```hcl\nresource \"google_sql_database_instance\" \"<example_resource_name>\" {\n  name             = \"<example_resource_name>\"\n  region           = \"<region>\"\n  database_version = \"SQLSERVER_2019_STANDARD\"\n\n  settings {\n    tier = \"db-custom-1-3840\"\n\n    # Critical: ensure the 'user connections' flag is set to 0 to pass the check\n    database_flags {\n      name  = \"user connections\"  # Critical line: target flag\n      value = \"0\"                 # Critical line: set to 0\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Set `user connections` to `0` to prevent artificial limits. Preserve **availability** with **connection pooling**, controlled retries, and **capacity planning** based on peak usage. *If a cap is required*, size it with ample headroom, monitor connection counts, and review regularly.",
      "Url": "https://hub.prowler.com/check/cloudsql_instance_sqlserver_user_connections_flag"
    }
  },
  "Categories": [
    "resilience"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
