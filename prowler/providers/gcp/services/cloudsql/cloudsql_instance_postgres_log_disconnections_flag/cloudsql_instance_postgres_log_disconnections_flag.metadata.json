{
  "Provider": "gcp",
  "CheckID": "cloudsql_instance_postgres_log_disconnections_flag",
  "CheckTitle": "Cloud SQL PostgreSQL instance has log_disconnections flag set to on",
  "CheckType": [],
  "ServiceName": "cloudsql",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "sqladmin.googleapis.com/Instance",
  "Description": "**Cloud SQL for PostgreSQL** instances have the `log_disconnections` flag set to `on`, creating a record each time a client session ends, including its duration and status",
  "Risk": "Without **disconnection logs**, session lifecycles lack visibility, obscuring **credential misuse**, **session hijacking**, and short-lived data exfiltration.\n\nWeak audit trails hinder correlation and forensics, undermining confidentiality and integrity and slowing incident response.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/gcp/CloudSQL/enable-log-connections-flag.html",
    "https://cloud.google.com/sql/docs/postgres/flags"
  ],
  "Remediation": {
    "Code": {
      "CLI": "gcloud sql instances patch <example_resource_name> --database-flags=log_disconnections=on",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to Cloud SQL > Instances\n2. Click your PostgreSQL instance\n3. Click Edit\n4. In Database flags, click Add item\n5. Select log_disconnections and set value to on\n6. Click Save and confirm the restart",
      "Terraform": "```hcl\nresource \"google_sql_database_instance\" \"<example_resource_name>\" {\n  name             = \"<example_resource_name>\"\n  region           = \"<REGION>\"\n  database_version = \"POSTGRES_14\"\n\n  settings {\n    tier = \"<TIER>\"\n\n    # Critical: enable disconnect logging\n    database_flags {\n      name  = \"log_disconnections\"  # sets the required flag\n      value = \"on\"                   # ensures the check passes\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable `log_disconnections=on` to ensure complete session auditing.\n- Pair with `log_connections` and a consistent `log_line_prefix`\n- Centralize and retain logs; alert on anomalies\n- Apply **defense in depth** with routine review of access and audit events",
      "Url": "https://hub.prowler.com/check/cloudsql_instance_postgres_log_disconnections_flag"
    }
  },
  "Categories": [
    "logging"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
