{
  "Provider": "gcp",
  "CheckID": "cloudsql_instance_postgres_log_statement_flag",
  "CheckTitle": "Cloud SQL PostgreSQL instance has 'log_statement' flag set to 'ddl'",
  "CheckType": [],
  "ServiceName": "cloudsql",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "sqladmin.googleapis.com/Instance",
  "Description": "**Cloud SQL for PostgreSQL** instances have `log_statement` set to `ddl`, recording only data definition statements in server logs",
  "Risk": "Missing `ddl` logging leaves schema changes untracked, undermining **integrity** and hindering investigations.\n\nExcessive logging (e.g., `all`) can inflate volumes, impair **availability**, raise costs, and leak sensitive values, harming **confidentiality**.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://cloud.google.com/sql/docs/postgres/flags"
  ],
  "Remediation": {
    "Code": {
      "CLI": "gcloud sql instances patch <example_resource_name> --database-flags=log_statement=ddl",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to SQL > Instances and open <example_resource_name>\n2. Click Edit\n3. In Database flags, click Add item\n4. Select log_statement and set value to ddl\n5. Click Save",
      "Terraform": "```hcl\nresource \"google_sql_database_instance\" \"<example_resource_name>\" {\n  name             = \"<example_resource_name>\"\n  region           = \"<region>\"\n  database_version = \"POSTGRES_14\"\n\n  settings {\n    tier = \"db-custom-2-7680\"\n\n    # Critical: sets PostgreSQL 'log_statement' to 'ddl' to pass the check\n    database_flags {\n      name  = \"log_statement\"   # required flag name\n      value = \"ddl\"             # required value\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Configure `log_statement` to `ddl` to capture schema changes without excessive noise. Apply **defense in depth**: use targeted auditing for data access, restrict and monitor log access with **least privilege**, and enforce log retention and rotation to protect availability.",
      "Url": "https://hub.prowler.com/check/cloudsql_instance_postgres_log_statement_flag"
    }
  },
  "Categories": [
    "logging"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
