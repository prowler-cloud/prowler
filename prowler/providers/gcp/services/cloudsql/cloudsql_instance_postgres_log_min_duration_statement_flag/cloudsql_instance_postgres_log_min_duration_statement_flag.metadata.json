{
  "Provider": "gcp",
  "CheckID": "cloudsql_instance_postgres_log_min_duration_statement_flag",
  "CheckTitle": "Cloud SQL PostgreSQL instance has the log_min_duration_statement flag set to -1",
  "CheckType": [],
  "ServiceName": "cloudsql",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "sqladmin.googleapis.com/Instance",
  "Description": "**Cloud SQL for PostgreSQL** evaluates whether `log_min_duration_statement` is set to `-1`, disabling **statement duration logging**.",
  "Risk": "When duration-based statement logging is enabled, logs can capture full SQL with literals, exposing **confidential data** in log stores. Adversaries or over-privileged users could harvest secrets/PII, profile schemas, and support **lateral movement**. Heavy logging can also raise costs and impact availability under load.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/gcp/CloudSQL/configure-log-min-error-statement-flag.html",
    "https://cloud.google.com/sql/docs/postgres/flags"
  ],
  "Remediation": {
    "Code": {
      "CLI": "gcloud sql instances patch <example_resource_id> --database-flags=log_min_duration_statement=-1",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to SQL > Instances\n2. Select your PostgreSQL instance\n3. Click Edit\n4. In Database flags, add or edit log_min_duration_statement and set it to -1\n5. Click Save (the instance may restart)",
      "Terraform": "```hcl\nresource \"google_sql_database_instance\" \"<example_resource_name>\" {\n  name             = \"<example_resource_id>\"\n  region           = \"<region>\"\n  database_version = \"POSTGRES_14\"\n\n  settings {\n    tier = \"<tier>\"\n    # Critical: set to -1 to pass the check\n    database_flags {\n      name  = \"log_min_duration_statement\"  # Critical\n      value = \"-1\"                          # Critical\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Keep `log_min_duration_statement` at `-1` in production to avoid writing sensitive query text to logs. Apply **least privilege** to log access, enforce **data minimization** with redaction and short retention. *If troubleshooting is required*, enable narrowly and temporarily, prefer non-prod, and monitor access.",
      "Url": "https://hub.prowler.com/check/cloudsql_instance_postgres_log_min_duration_statement_flag"
    }
  },
  "Categories": [
    "logging"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
