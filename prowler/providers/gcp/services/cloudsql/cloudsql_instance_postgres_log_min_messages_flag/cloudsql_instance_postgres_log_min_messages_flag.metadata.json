{
  "Provider": "gcp",
  "CheckID": "cloudsql_instance_postgres_log_min_messages_flag",
  "CheckTitle": "Cloud SQL PostgreSQL instance has the log_min_messages flag set to WARNING or higher",
  "CheckType": [],
  "ServiceName": "cloudsql",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "sqladmin.googleapis.com/Instance",
  "Description": "**Cloud SQL for PostgreSQL** instances are evaluated for the `log_min_messages` flag being set to a sufficiently high severity. Instances with the flag missing or set below `ERROR` (e.g., `DEBUG*`, `INFO`, `NOTICE`) are identified.",
  "Risk": "Insufficient `log_min_messages` severity degrades **audit log integrity**, causing real failures to be treated as non-errors or lack context. This delays detection and impairs **forensics**, enabling unnoticed data tampering or repeated faulty operations, impacting the **integrity** and **availability** of the service.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://cloud.google.com/sql/docs/postgres/flags"
  ],
  "Remediation": {
    "Code": {
      "CLI": "gcloud sql instances patch <example_resource_name> --database-flags=log_min_messages=warning",
      "NativeIaC": "",
      "Other": "1. In Google Cloud Console, go to SQL and select your PostgreSQL instance\n2. Click Edit\n3. In Database flags, click Add item\n4. Choose log_min_messages and set value to warning\n5. Click Save and confirm the restart",
      "Terraform": "```hcl\nresource \"google_sql_database_instance\" \"<example_resource_name>\" {\n  name             = \"<example_resource_name>\"\n  region           = \"<example_region>\"\n  database_version = \"POSTGRES_14\"\n\n  settings {\n    tier = \"db-f1-micro\"\n\n    # Critical: sets the minimum PostgreSQL log level to WARNING (or higher) to pass the check\n    database_flags {\n      name  = \"log_min_messages\"  # sets the flag\n      value = \"warning\"            # acceptable level (WARNING or higher)\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Set `log_min_messages` to **ERROR or stricter** to ensure error statements are captured with context. Align with centralized logging, retention, and review processes. Prefer **defense in depth** by preserving actionable error telemetry, while balancing verbosity and cost per your logging policy.",
      "Url": "https://hub.prowler.com/check/cloudsql_instance_postgres_log_min_messages_flag"
    }
  },
  "Categories": [
    "logging"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
