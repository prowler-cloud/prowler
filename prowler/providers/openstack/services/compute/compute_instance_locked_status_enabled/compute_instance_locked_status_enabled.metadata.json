{
  "Provider": "openstack",
  "CheckID": "compute_instance_locked_status_enabled",
  "CheckTitle": "Compute instances have locked status enabled",
  "CheckType": [],
  "ServiceName": "compute",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "OpenStackInstance",
  "ResourceGroup": "compute",
  "Description": "**OpenStack compute instances** (VMs) are evaluated to verify that **locked status** is enabled. Locking an instance prevents unauthorized administrative operations (delete, resize, rebuild, etc.) without first unlocking it. This provides an additional layer of protection against accidental or malicious modifications.",
  "Risk": "Instances without locked status can be subjected to unauthorized operations (deletion, resize, rebuild) by compromised accounts without additional barriers. Attackers can manipulate unlocked instances to destroy forensic evidence or disrupt production workloads. Accidental termination by operators also poses risk due to lack of change control barriers.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/api-ref/compute/#lock-server-lock",
    "https://docs.openstack.org/security-guide/compute.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "openstack server lock <instance_id> --reason \"Production instance - requires approval\"\nopenstack server show <instance_id>",
      "NativeIaC": "",
      "Other": "1. Navigate to **Compute > Instances**\n2. Select the instance to protect\n3. Use CLI or API to lock the instance\n4. Verify locked status is enabled",
      "Terraform": "```hcl\n# Note: Terraform openstack_compute_instance_v2 does not support locked status natively\n# Use null_resource with local-exec provisioner as workaround\n\nresource \"openstack_compute_instance_v2\" \"instance\" {\n  name            = \"production-instance\"\n  image_id        = var.image_id\n  flavor_id       = var.flavor_id\n  key_pair        = var.key_pair_name\n  security_groups = [\"default\"]\n\n  network {\n    name = var.network_name\n  }\n}\n\nresource \"null_resource\" \"lock_instance\" {\n  depends_on = [openstack_compute_instance_v2.instance]\n\n  provisioner \"local-exec\" {\n    command = \"openstack server lock ${openstack_compute_instance_v2.instance.id}\"\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Lock production instances to prevent accidental or unauthorized modifications. Use --reason parameter to document lock purpose. Implement approval workflows requiring consent before unlocking. Apply locks to critical infrastructure (databases, authentication, logging). Use RBAC policies to restrict who can lock/unlock. Audit lock/unlock operations via OpenStack logs.",
      "Url": "https://hub.prowler.com/check/compute_instance_locked_status_enabled"
    }
  },
  "Categories": [
    "resilience"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Locked status prevents administrative operations like delete, resize, rebuild, and shelve. It does not prevent start/stop/reboot operations or guest OS-level changes. Lock operations require specific Nova API permissions."
}
