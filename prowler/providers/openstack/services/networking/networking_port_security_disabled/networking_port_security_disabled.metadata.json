{
  "Provider": "openstack",
  "CheckID": "networking_port_security_disabled",
  "CheckTitle": "Port security is enabled on networks and ports",
  "CheckType": [],
  "ServiceName": "networking",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "OS::Neutron::Net",
  "ResourceGroup": "network",
  "Description": "**OpenStack networks and ports** are evaluated to verify that **port security is enabled** (port_security_enabled=True). Port security prevents MAC and IP spoofing by enforcing anti-spoofing rules. When disabled, instances can forge source addresses, bypass network isolation, and enable man-in-the-middle attacks. Disabling is sometimes required for NFV/SR-IOV use cases.",
  "Risk": "Disabled port security allows MAC/IP spoofing attacks, bypassing network isolation. Attackers can intercept traffic via ARP poisoning (MITM attacks), bypass security group rules by forging source IPs, and attack other tenants in multi-tenant environments (cross-tenant data exfiltration). Security groups cannot be enforced properly. Violates compliance requirements (PCI-DSS, HIPAA, SOC 2).",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/neutron/latest/admin/intro-os-networking.html",
    "https://docs.openstack.org/neutron/latest/admin/config-ipam.html",
    "https://docs.openstack.org/security-guide/networking/architecture.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. Navigate to Project > Network > Networks\n2. For each network, click Edit Network\n3. Ensure the Port Security checkbox is checked\n4. Click Save\n5. Navigate to Project > Network > Networks > Ports\n6. For each port, click Edit Port\n7. Ensure the Port Security checkbox is checked\n8. Click Save",
      "Terraform": "```hcl\n# Terraform: ensure port security is enabled on networks and ports\n\n# GOOD: Network with port security enabled (default)\nresource \"openstack_networking_network_v2\" \"secure_network\" {\n  name           = \"prod-app-network\"\n  admin_state_up = true\n  # port_security_enabled defaults to true - explicitly set for clarity\n  # No need to specify if keeping default\n}\n\n# GOOD: Explicitly enable port security\nresource \"openstack_networking_network_v2\" \"explicit_security\" {\n  name           = \"prod-web-network\"\n  admin_state_up = true\n  # Explicitly enable port security\n  # Note: Check if your OpenStack provider version supports this attribute\n}\n\n# GOOD: Port with port security enabled\nresource \"openstack_networking_port_v2\" \"secure_port\" {\n  name           = \"instance-port-01\"\n  network_id     = openstack_networking_network_v2.secure_network.id\n  admin_state_up = true\n  \n  # Port security enabled by default\n  # Apply security groups\n  security_group_ids = [\n    openstack_networking_secgroup_v2.web_sg.id,\n  ]\n  \n  fixed_ip {\n    subnet_id = openstack_networking_subnet_v2.subnet.id\n  }\n}\n\n# BAD: Port with port security disabled (security risk)\n# resource \"openstack_networking_port_v2\" \"insecure_port\" {\n#   name           = \"nfv-port-01\"\n#   network_id     = openstack_networking_network_v2.network.id\n#   admin_state_up = true\n#   \n#   # DANGEROUS: Disabling port security allows MAC/IP spoofing\n#   port_security_enabled = false\n#   \n#   # Security groups cannot be enforced without port security\n#   # security_group_ids = []  # Must be empty when port_security_enabled = false\n# }\n\n# ACCEPTABLE: Disabled port security for legitimate NFV use case with documentation\nresource \"openstack_networking_port_v2\" \"nfv_port\" {\n  name           = \"nfv-vrouter-port\"\n  network_id     = openstack_networking_network_v2.nfv_network.id\n  admin_state_up = true\n  \n  # Port security disabled for NFV virtual router\n  # JUSTIFICATION: SR-IOV network function requires promiscuous mode\n  # COMPENSATING CONTROLS: \n  #   - Isolated network (no shared tenants)\n  #   - Network-level ACLs via provider firewall\n  #   - Monitoring for anomalous traffic patterns\n  port_security_enabled = false\n  \n  # Cannot use security groups with disabled port security\n  security_group_ids = []\n}\n\n# Create dedicated isolated network for resources requiring disabled port security\nresource \"openstack_networking_network_v2\" \"nfv_network\" {\n  name           = \"nfv-isolated-network\"\n  admin_state_up = true\n  # Isolated network - not shared with other projects\n  shared = false\n}\n\n# Validation: Check port security is enabled\nresource \"null_resource\" \"validate_port_security\" {\n  depends_on = [openstack_networking_port_v2.secure_port]\n  \n  provisioner \"local-exec\" {\n    command = <<-EOF\n      # Verify port security is enabled\n      PORT_SECURITY=$(openstack port show ${openstack_networking_port_v2.secure_port.id} -f json | jq -r '.port_security_enabled')\n      if [ \"$PORT_SECURITY\" != \"true\" ]; then\n        echo \"ERROR: Port security is disabled on ${openstack_networking_port_v2.secure_port.id}\"\n        exit 1\n      fi\n      echo \"âœ“ Port security validation passed\"\n    EOF\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable port security on all networks and ports to prevent MAC and IP spoofing attacks. For legitimate NFV or SR-IOV use cases requiring disabled port security, deploy on isolated networks with compensating controls like network-level ACLs and monitoring. Use allowed-address-pairs instead of disabling port security when additional IPs are needed.",
      "Url": "https://hub.prowler.com/check/networking_port_security_disabled"
    }
  },
  "Categories": [
    "trust-boundaries",
    "vulnerabilities"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "This check flags both networks and ports where `port_security_enabled == False`. Port security prevents MAC address spoofing and IP address spoofing by enforcing anti-spoofing rules. Legitimate use cases for disabled port security include: (1) Network Functions Virtualization (NFV) requiring promiscuous mode, (2) SR-IOV (Single Root I/O Virtualization) ports, (3) VLAN trunking ports, or (4) Load balancer VIP ports using VRRP. If your deployment has resources with disabled port security, verify they are documented exceptions with compensating security controls. Port security is enabled by default in OpenStack Neutron unless explicitly disabled."
}
