{
  "Provider": "openstack",
  "CheckID": "network_security_group_allows_ssh_from_internet",
  "CheckTitle": "Security groups do not allow SSH from the Internet",
  "CheckType": [],
  "ServiceName": "network",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "OpenStackSecurityGroup",
  "ResourceGroup": "network",
  "Description": "**OpenStack security groups** are evaluated to verify that SSH (port 22) is **not exposed to the Internet** (0.0.0.0/0 or ::/0). Security groups act as virtual firewalls controlling instance traffic. Unrestricted SSH access violates least privilege and creates significant attack surface. Best practices recommend restricting SSH to **known IP ranges**, **bastion hosts**, or **VPN gateways**.",
  "Risk": "Unrestricted SSH exposes instances to brute-force attacks, password testing, and SSH vulnerability exploitation (CVE-2023-38408, CVE-2021-41617) for initial access. Compromised instances enable persistence, privilege escalation, lateral movement, crypto mining, DDoS botnets, data exfiltration, and ransomware deployment. SSH exposure bypasses defense-in-depth and enables direct production access.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/neutron/latest/admin/intro-os-networking.html",
    "https://docs.openstack.org/security-guide/networking/architecture.html",
    "https://docs.openstack.org/api-ref/network/v2/",
    "https://docs.openstack.org/neutron/latest/admin/config-rbac.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. Navigate to Network > Security Groups\n2. Locate the security group with unrestricted SSH access\n3. Click Manage Rules\n4. Delete SSH rules with Remote 0.0.0.0/0 or ::/0\n5. Click Add Rule and create a new SSH rule\n6. Set Remote to CIDR with your trusted IP (e.g., 203.0.113.50/32)\n7. Save changes and verify connectivity",
      "Terraform": "```hcl\n# Terraform: restrict SSH to known IP ranges, never 0.0.0.0/0\n\nresource \"openstack_networking_secgroup_v2\" \"app_servers\" {\n  name        = \"app-servers-sg\"\n  description = \"Security group for application servers\"\n}\n\n# GOOD: SSH restricted to corporate office IP\nresource \"openstack_networking_secgroup_rule_v2\" \"ssh_from_office\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 22\n  port_range_max    = 22\n  remote_ip_prefix  = \"203.0.113.0/24\"  # Corporate office network\n  security_group_id = openstack_networking_secgroup_v2.app_servers.id\n}\n\n# GOOD: SSH from bastion security group (reference-based rule)\nresource \"openstack_networking_secgroup_rule_v2\" \"ssh_from_bastion\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 22\n  port_range_max    = 22\n  remote_group_id   = openstack_networking_secgroup_v2.bastion.id  # Reference, not CIDR\n  security_group_id = openstack_networking_secgroup_v2.app_servers.id\n}\n\n# Bastion security group (least privilege)\nresource \"openstack_networking_secgroup_v2\" \"bastion\" {\n  name        = \"bastion-sg\"\n  description = \"Security group for bastion host - only entry point for SSH\"\n}\n\nresource \"openstack_networking_secgroup_rule_v2\" \"bastion_ssh\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 22\n  port_range_max    = 22\n  remote_ip_prefix  = var.corporate_cidr  # e.g., 203.0.113.0/24\n  security_group_id = openstack_networking_secgroup_v2.bastion.id\n}\n\n# BAD: Never do this - SSH from anywhere (0.0.0.0/0)\n# resource \"openstack_networking_secgroup_rule_v2\" \"ssh_from_anywhere\" {\n#   direction         = \"ingress\"\n#   ethertype         = \"IPv4\"\n#   protocol          = \"tcp\"\n#   port_range_min    = 22\n#   port_range_max    = 22\n#   remote_ip_prefix  = \"0.0.0.0/0\"  # DANGEROUS - DO NOT USE\n#   security_group_id = openstack_networking_secgroup_v2.app_servers.id\n# }\n```"
    },
    "Recommendation": {
      "Text": "Restrict SSH access to known IP ranges using bastion hosts or VPN gateways instead of allowing 0.0.0.0/0. Implement multi-factor authentication, disable password authentication, and use SSH certificates for centralized key management. Monitor SSH logs for failed login attempts and enforce fail2ban or similar IP blocking mechanisms.",
      "Url": "https://hub.prowler.com/check/network_security_group_allows_ssh_from_internet"
    }
  },
  "Categories": [
    "internet-exposed",
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [
    "network_security_group_allows_rdp_from_internet"
  ],
  "Notes": "This check flags security groups with SSH (port 22) ingress rules allowing 0.0.0.0/0 or ::/0. Some architectures legitimately require public SSH access (bastion hosts, CI/CD runners with dynamic IPs). Review findings in context of your security architecture. Rules allowing SSH from specific IPs (e.g., 203.0.113.0/24) or from other security groups (remote_group_id) are not flagged. IPv6 rules (::/0) are also checked. Port ranges that include port 22 (e.g., 20-25) will trigger this check."
}
