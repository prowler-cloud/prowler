{
  "Provider": "openstack",
  "CheckID": "network_security_group_allows_ssh_from_internet",
  "CheckTitle": "Security groups do not allow SSH from the Internet",
  "CheckType": [],
  "ServiceName": "network",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "OpenStackSecurityGroup",
  "ResourceGroup": "network",
  "Description": "**OpenStack security groups** are evaluated to verify that SSH (port 22) is **not exposed to the Internet** (0.0.0.0/0 or ::/0). Security groups act as virtual firewalls controlling network traffic to instances. Unrestricted SSH access violates the principle of least privilege and creates a significant attack surface. Best practices recommend restricting SSH access to **known IP ranges**, **bastion hosts**, or **VPN gateways** instead of allowing access from any Internet address.",
  "Risk": "Security groups allowing SSH from 0.0.0.0/0 or ::/0 expose instances to continuous brute-force attacks from automated scanners and botnets. Attackers can enumerate usernames, test weak passwords, and exploit SSH vulnerabilities (CVE-2023-38408, CVE-2021-41617) to gain initial access. Once compromised, attackers can establish persistence with backdoors, escalate privileges, steal credentials from memory, and pivot laterally to other instances. Exposed SSH ports are constantly targeted by Internet-wide scanning tools (Shodan, Censys) and credential stuffing campaigns. Compromised instances become launchpads for crypto mining, DDoS botnets, data exfiltration, and ransomware deployment. SSH exposure bypasses defense-in-depth controls and enables direct access to production workloads without additional authentication layers.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/neutron/latest/admin/intro-os-networking.html",
    "https://docs.openstack.org/security-guide/networking/architecture.html",
    "https://docs.openstack.org/api-ref/network/v2/",
    "https://docs.openstack.org/neutron/latest/admin/config-rbac.html",
    "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-215a"
  ],
  "Remediation": {
    "Code": {
      "CLI": "# List security group rules to find SSH rules from 0.0.0.0/0\nopenstack security group rule list <security_group_id> --ingress --protocol tcp --port 22\n\n# Delete the overly permissive rule\nopenstack security group rule delete <rule_id>\n\n# Add a restricted rule allowing SSH only from your IP or bastion\nopenstack security group rule create \\\n  --protocol tcp \\\n  --dst-port 22 \\\n  --remote-ip <your_ip>/32 \\\n  <security_group_id>\n\n# OR allow SSH only from a bastion security group\nopenstack security group rule create \\\n  --protocol tcp \\\n  --dst-port 22 \\\n  --remote-group <bastion_sg_id> \\\n  <security_group_id>",
      "NativeIaC": "",
      "Other": "**Option 1: Restrict SSH to specific IPs (Horizon Dashboard)**\n1. Navigate to **Network > Security Groups**\n2. Locate the security group with unrestricted SSH access\n3. Click **Manage Rules** for the security group\n4. Identify and delete rules with:\n   - Direction: Ingress\n   - Protocol: TCP\n   - Port: 22\n   - Remote: 0.0.0.0/0 or ::/0 (CIDR)\n5. Click **+ Add Rule** to create a new SSH rule:\n   - Rule: SSH (or Custom TCP Rule)\n   - Direction: Ingress\n   - Port: 22\n   - Remote: CIDR\n   - CIDR: <your_trusted_ip>/32 (e.g., 203.0.113.50/32)\n6. Repeat step 5 for each trusted IP range (office IPs, VPN endpoint, etc.)\n7. Save changes and verify SSH connectivity from trusted IPs\n\n**Option 2: Implement bastion host architecture**\n1. Create a **dedicated bastion host** in a DMZ network segment\n2. Apply a **bastion security group** allowing SSH only from corporate IPs:\n   - SSH (port 22) from 203.0.113.0/24 (corporate network)\n3. Create an **application security group** for backend instances:\n   - SSH (port 22) from <bastion_security_group> (reference, not CIDR)\n   - Application ports (80/443) as needed\n4. Remove all SSH rules with 0.0.0.0/0 or ::/0 from application security groups\n5. Harden bastion host:\n   - Disable password authentication (`PasswordAuthentication no` in sshd_config)\n   - Enable SSH key-only authentication\n   - Install fail2ban to block brute-force attempts\n   - Enable auditd for session logging\n   - Implement port knocking or VPN for additional security\n6. Document SSH access procedures: `ssh -J bastion-user@bastion-ip instance-user@<private_ip>`\n\n**Option 3: Use VPN for administrative access**\n1. Deploy OpenVPN, WireGuard, or IPsec VPN gateway\n2. Configure VPN to assign IPs from a known range (e.g., 10.8.0.0/24)\n3. Update security group SSH rules to allow only VPN range:\n   - Remote CIDR: 10.8.0.0/24\n4. Remove all public SSH access rules (0.0.0.0/0, ::/0)\n5. Require operators to connect via VPN before accessing instances",
      "Terraform": "```hcl\n# Terraform: restrict SSH to known IP ranges, never 0.0.0.0/0\n\nresource \"openstack_networking_secgroup_v2\" \"app_servers\" {\n  name        = \"app-servers-sg\"\n  description = \"Security group for application servers\"\n}\n\n# GOOD: SSH restricted to corporate office IP\nresource \"openstack_networking_secgroup_rule_v2\" \"ssh_from_office\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 22\n  port_range_max    = 22\n  remote_ip_prefix  = \"203.0.113.0/24\"  # Corporate office network\n  security_group_id = openstack_networking_secgroup_v2.app_servers.id\n}\n\n# GOOD: SSH from bastion security group (reference-based rule)\nresource \"openstack_networking_secgroup_rule_v2\" \"ssh_from_bastion\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 22\n  port_range_max    = 22\n  remote_group_id   = openstack_networking_secgroup_v2.bastion.id  # Reference, not CIDR\n  security_group_id = openstack_networking_secgroup_v2.app_servers.id\n}\n\n# Bastion security group (least privilege)\nresource \"openstack_networking_secgroup_v2\" \"bastion\" {\n  name        = \"bastion-sg\"\n  description = \"Security group for bastion host - only entry point for SSH\"\n}\n\nresource \"openstack_networking_secgroup_rule_v2\" \"bastion_ssh\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 22\n  port_range_max    = 22\n  remote_ip_prefix  = var.corporate_cidr  # e.g., 203.0.113.0/24\n  security_group_id = openstack_networking_secgroup_v2.bastion.id\n}\n\n# BAD: Never do this - SSH from anywhere (0.0.0.0/0)\n# resource \"openstack_networking_secgroup_rule_v2\" \"ssh_from_anywhere\" {\n#   direction         = \"ingress\"\n#   ethertype         = \"IPv4\"\n#   protocol          = \"tcp\"\n#   port_range_min    = 22\n#   port_range_max    = 22\n#   remote_ip_prefix  = \"0.0.0.0/0\"  # DANGEROUS - DO NOT USE\n#   security_group_id = openstack_networking_secgroup_v2.app_servers.id\n# }\n```"
    },
    "Recommendation": {
      "Text": "Implement **defense-in-depth** for SSH access control:\n- **Restrict SSH to known IP ranges**: allow only corporate offices, VPN gateways, or specific operator IPs\n- **Deploy bastion hosts** (jump servers) as the single point of SSH entry with enhanced logging and monitoring\n- **Use VPN gateways** (OpenVPN, WireGuard, IPsec) for administrative access instead of direct public exposure\n- **Implement multi-factor authentication (MFA)** for SSH sessions (Google Authenticator, YubiKey, Duo)\n- **Disable password authentication**: enforce SSH key-only authentication in sshd_config\n- **Use non-standard SSH ports** with port knocking for additional obscurity (security through obscurity is not a replacement for proper controls)\n- **Enable fail2ban or similar tools** to automatically block IP addresses after repeated failed login attempts\n- **Implement SSH certificate authorities** for centralized key management and short-lived credentials\n- **Monitor SSH logs** for suspicious activity (failed logins, unusual source IPs, off-hours access)\n- **Use security group references** instead of CIDR blocks when possible (e.g., allow SSH from bastion security group)\n- **Regularly audit security group rules** to identify and remove stale or overly permissive entries\n- **Enable network flow logs** to detect unauthorized SSH connection attempts from unexpected sources\n- **Consider session recording** tools (tlog, asciinema) for compliance and forensic analysis\n- **Document SSH access procedures** with runbooks for operators and emergency break-glass scenarios\n- **Test SSH access restrictions** regularly to ensure rules are functioning as intended",
      "Url": "https://hub.prowler.com/check/network_security_group_allows_ssh_from_internet"
    }
  },
  "Categories": [
    "internet-exposed",
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [
    "network_security_group_allows_rdp_from_internet",
    "network_security_group_allows_all_ports_from_internet"
  ],
  "Notes": "This check flags security groups with SSH (port 22) ingress rules allowing 0.0.0.0/0 or ::/0. Some architectures legitimately require public SSH access (bastion hosts, CI/CD runners with dynamic IPs). Review findings in context of your security architecture. Rules allowing SSH from specific IPs (e.g., 203.0.113.0/24) or from other security groups (remote_group_id) are not flagged. IPv6 rules (::/0) are also checked. Port ranges that include port 22 (e.g., 20-25) will trigger this check."
}
