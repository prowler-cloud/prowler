{
  "Provider": "openstack",
  "CheckID": "network_security_group_default_restricts_traffic",
  "CheckTitle": "Default security groups have not been modified",
  "CheckType": [],
  "ServiceName": "network",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "OpenStackSecurityGroup",
  "ResourceGroup": "network",
  "Description": "**Default OpenStack security groups** are evaluated to ensure they have not been modified with custom rules beyond their baseline configuration. Default security groups are automatically created for each project and should remain in their baseline state (typically 4 rules: 2 egress allowing all outbound, 2 ingress allowing traffic from the same security group). Modifying default security groups creates inconsistent security postures across projects and violates infrastructure-as-code principles. Best practices recommend creating **custom security groups** with explicit names and documented purposes instead of modifying defaults.",
  "Risk": "Modified default security groups create security configuration drift and complicate governance. When defaults are modified, all instances without explicit security group assignments automatically inherit the changed rules, potentially exposing workloads unintentionally. This creates hidden security dependencies where infrastructure changes to defaults impact multiple instances simultaneously. Modified defaults undermine security auditing and compliance validation, as baseline expectations no longer hold. Organizations lose the ability to maintain predictable security configurations when defaults become mutable state. Custom rules in defaults bypass infrastructure-as-code review processes and may grant excessive permissions (0.0.0.0/0 access) without proper justification. Default security group modifications often accumulate over time through ad-hoc changes, creating technical debt and undocumented firewall rules. Incident response and troubleshooting become more complex when default security groups contain undocumented custom rules.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/neutron/latest/admin/intro-os-networking.html",
    "https://docs.openstack.org/security-guide/networking/architecture.html",
    "https://docs.openstack.org/api-ref/network/v2/",
    "https://docs.openstack.org/neutron/latest/admin/config-rbac.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "# List all rules in the default security group\nopenstack security group rule list default\n\n# Identify custom rules (beyond the 4 default rules)\n# Delete custom rules one by one\nopenstack security group rule delete <custom_rule_id>\n\n# Create a custom security group for your workload instead\nopenstack security group create my-app-sg --description \"Application servers security group\"\n\n# Add appropriate rules to the custom security group\nopenstack security group rule create --protocol tcp --dst-port 80 my-app-sg\nopenstack security group rule create --protocol tcp --dst-port 443 my-app-sg\n\n# Attach custom security group to instances\nopenstack server add security group <instance_id> my-app-sg\nopenstack server remove security group <instance_id> default",
      "NativeIaC": "",
      "Other": "1. Navigate to Network > Security Groups\n2. Locate the default security group\n3. Click Manage Rules\n4. Identify the 4 baseline rules (2 egress, 2 ingress from same group)\n5. Delete any additional custom rules beyond these 4\n6. Create custom security groups for specific workloads instead\n7. Navigate to Compute > Instances\n8. Edit Security Groups and remove default, add custom groups",
      "Terraform": "```hcl\n# Terraform: create custom security groups, never modify defaults\n\n# GOOD: Custom security group with explicit name and purpose\nresource \"openstack_networking_secgroup_v2\" \"web_servers\" {\n  name        = \"prod-web-servers-sg\"\n  description = \"Production web servers - allows HTTP/HTTPS from LB\"\n  # Do NOT modify the default security group\n}\n\nresource \"openstack_networking_secgroup_rule_v2\" \"web_http\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 80\n  port_range_max    = 80\n  remote_ip_prefix  = \"10.0.1.0/24\"  # Load balancer subnet\n  security_group_id = openstack_networking_secgroup_v2.web_servers.id\n}\n\nresource \"openstack_networking_secgroup_rule_v2\" \"web_https\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 443\n  port_range_max    = 443\n  remote_ip_prefix  = \"10.0.1.0/24\"  # Load balancer subnet\n  security_group_id = openstack_networking_secgroup_v2.web_servers.id\n}\n\n# Custom security group for database tier\nresource \"openstack_networking_secgroup_v2\" \"database\" {\n  name        = \"prod-database-sg\"\n  description = \"Production databases - allows MySQL from app tier only\"\n}\n\nresource \"openstack_networking_secgroup_rule_v2\" \"db_mysql\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 3306\n  port_range_max    = 3306\n  remote_group_id   = openstack_networking_secgroup_v2.web_servers.id  # Reference app tier\n  security_group_id = openstack_networking_secgroup_v2.database.id\n}\n\n# Attach custom security groups to instances\nresource \"openstack_compute_instance_v2\" \"web\" {\n  name            = \"web-server-01\"\n  image_id        = var.image_id\n  flavor_id       = var.flavor_id\n  # Use custom security groups, not default\n  security_groups = [\n    openstack_networking_secgroup_v2.web_servers.name,\n    # Do NOT include \"default\" security group\n  ]\n\n  network {\n    name = \"private-network\"\n  }\n}\n\n# BAD: Never modify the default security group\n# data \"openstack_networking_secgroup_v2\" \"default\" {\n#   name = \"default\"\n# }\n# resource \"openstack_networking_secgroup_rule_v2\" \"default_custom\" {\n#   security_group_id = data.openstack_networking_secgroup_v2.default.id\n#   # DO NOT ADD CUSTOM RULES TO DEFAULT\n# }\n```"
    },
    "Recommendation": {
      "Text": "Implement **security group governance** best practices:\n- **Never modify default security groups**: create custom groups for each workload type with explicit names\n- **Use naming conventions**: `${environment}-${tier}-${purpose}-sg` (e.g., `prod-web-servers-sg`, `dev-database-sg`)\n- **Document security group purpose**: add meaningful descriptions explaining the workload and allowed traffic\n- **Implement infrastructure-as-code (IaC)**: manage security groups via Terraform, Ansible, or Heat templates\n- **Apply least privilege**: create specific security groups per application tier (web, app, database)\n- **Use security group references**: allow traffic between tiers using remote_group_id instead of CIDR blocks\n- **Implement tagging policies**: tag security groups with owner, application, environment, cost-center\n- **Enable audit logging**: monitor security group modifications with CloudTrail-equivalent logging\n- **Conduct periodic reviews**: audit security groups quarterly to identify unused or overly permissive rules\n- **Use policy-as-code**: implement OPA, Sentinel, or Cloud Custodian rules to prevent default modifications\n- **Establish change management**: require approval workflows for security group modifications\n- **Separate duties**: restrict who can modify security groups using RBAC policies\n- **Test security group changes**: validate connectivity in dev/staging before applying to production\n- **Document exceptions**: maintain a register of legitimate custom rules with business justification",
      "Url": "https://hub.prowler.com/check/network_security_group_default_restricts_traffic"
    }
  },
  "Categories": [
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Default security groups in OpenStack typically contain 4 rules: 2 egress rules (IPv4/IPv6 allowing all outbound to 0.0.0.0/0 and ::/0) and 2 ingress rules (allowing traffic from the same security group for IPv4 and IPv6). This check flags security groups named 'default' with more than 4 rules as modified. Some OpenStack deployments may have different default rule counts depending on configuration. Review your OpenStack deployment's default security group baseline if this check produces unexpected results."
}
