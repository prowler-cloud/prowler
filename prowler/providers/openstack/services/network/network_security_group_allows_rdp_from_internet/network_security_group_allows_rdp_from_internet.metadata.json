{
  "Provider": "openstack",
  "CheckID": "network_security_group_allows_rdp_from_internet",
  "CheckTitle": "Security groups do not allow RDP from the Internet",
  "CheckType": [],
  "ServiceName": "network",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "OpenStackSecurityGroup",
  "ResourceGroup": "network",
  "Description": "**OpenStack security groups** are evaluated to verify that RDP (port 3389) is **not exposed to the Internet** (0.0.0.0/0 or ::/0). Security groups act as virtual firewalls controlling network traffic to Windows instances. Unrestricted RDP access violates the principle of least privilege and creates a significant attack surface for Windows-based workloads. Best practices recommend restricting RDP access to **known IP ranges**, **bastion hosts**, or **VPN gateways** instead of allowing access from any Internet address.",
  "Risk": "Security groups allowing RDP from 0.0.0.0/0 or ::/0 expose Windows instances to continuous brute-force attacks, password spraying, and exploitation of RDP vulnerabilities. Attackers actively scan for open RDP ports and exploit weaknesses like BlueKeep (CVE-2019-0708), DejaBlue (CVE-2019-1181, CVE-2019-1182), and other Remote Code Execution vulnerabilities. Compromised RDP sessions enable attackers to deploy ransomware (REvil, Conti, LockBit), steal credentials, escalate privileges, and move laterally across networks. RDP attacks are frequently used for initial access in targeted campaigns against healthcare, financial services, and government sectors. Exposed RDP ports are continuously targeted by automated tools (Masscan, ZMap) and credential databases from previous breaches. Successful RDP compromise often leads to domain controller access, Active Directory enumeration, and organization-wide data exfiltration. RDP exposure bypasses network segmentation and enables direct administrative access to Windows workloads without multi-factor authentication or VPN controls.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/neutron/latest/admin/intro-os-networking.html",
    "https://docs.openstack.org/security-guide/networking/architecture.html",
    "https://docs.openstack.org/api-ref/network/v2/",
    "https://www.cisa.gov/news-events/alerts/2019/05/14/microsoft-releases-advisory-rdp-vulnerability-cve-2019-0708",
    "https://www.ncsc.gov.uk/guidance/preventing-lateral-movement"
  ],
  "Remediation": {
    "Code": {
      "CLI": "# List security group rules to find RDP rules from 0.0.0.0/0\nopenstack security group rule list <security_group_id> --ingress --protocol tcp --port 3389\n\n# Delete the overly permissive rule\nopenstack security group rule delete <rule_id>\n\n# Add a restricted rule allowing RDP only from your IP or bastion\nopenstack security group rule create \\\n  --protocol tcp \\\n  --dst-port 3389 \\\n  --remote-ip <your_ip>/32 \\\n  <security_group_id>\n\n# OR allow RDP only from a bastion/RD Gateway security group\nopenstack security group rule create \\\n  --protocol tcp \\\n  --dst-port 3389 \\\n  --remote-group <bastion_sg_id> \\\n  <security_group_id>",
      "NativeIaC": "",
      "Other": "**Option 1: Restrict RDP to specific IPs (Horizon Dashboard)**\n1. Navigate to **Network > Security Groups**\n2. Locate the security group with unrestricted RDP access\n3. Click **Manage Rules** for the security group\n4. Identify and delete rules with:\n   - Direction: Ingress\n   - Protocol: TCP\n   - Port: 3389\n   - Remote: 0.0.0.0/0 or ::/0 (CIDR)\n5. Click **+ Add Rule** to create a new RDP rule:\n   - Rule: RDP (or Custom TCP Rule)\n   - Direction: Ingress\n   - Port: 3389\n   - Remote: CIDR\n   - CIDR: <your_trusted_ip>/32 (e.g., 198.51.100.50/32)\n6. Repeat step 5 for each trusted IP range (office IPs, VPN endpoint, RD Gateway)\n7. Save changes and verify RDP connectivity from trusted IPs\n\n**Option 2: Implement Remote Desktop Gateway (RD Gateway)**\n1. Deploy a **dedicated RD Gateway** Windows Server instance in a DMZ network\n2. Apply an **RD Gateway security group** allowing RDP only from corporate IPs:\n   - RDP (port 3389) from 198.51.100.0/24 (corporate network)\n   - HTTPS (port 443) for RD Gateway external clients\n3. Create a **backend Windows security group** for application servers:\n   - RDP (port 3389) from <rd_gateway_security_group> (reference)\n   - Application ports as needed\n4. Remove all RDP rules with 0.0.0.0/0 or ::/0 from backend security groups\n5. Configure RD Gateway:\n   - Enable Network Level Authentication (NLA)\n   - Require smart card or MFA authentication\n   - Enable connection authorization policies\n   - Enable session logging and auditing\n6. Configure RDP clients to connect through RD Gateway\n\n**Option 3: Use Azure Bastion-style architecture**\n1. Deploy a Windows Server bastion host with hardened configuration\n2. Enable **Restricted Admin mode** to prevent credential delegation\n3. Configure security group to allow RDP only from VPN gateway IP range\n4. Implement **MFA for RDP sessions** using Duo, Microsoft Authenticator, or YubiKey\n5. Enable **Windows Firewall** with strict ingress rules\n6. Install **LAPS (Local Administrator Password Solution)** for password rotation\n7. Enable **Windows Event Forwarding** for centralized logging\n8. Document RDP access procedures with jump-through-bastion workflow",
      "Terraform": "```hcl\n# Terraform: restrict RDP to known IP ranges, never 0.0.0.0/0\n\nresource \"openstack_networking_secgroup_v2\" \"windows_servers\" {\n  name        = \"windows-servers-sg\"\n  description = \"Security group for Windows application servers\"\n}\n\n# GOOD: RDP restricted to corporate VPN IP range\nresource \"openstack_networking_secgroup_rule_v2\" \"rdp_from_vpn\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 3389\n  port_range_max    = 3389\n  remote_ip_prefix  = \"10.8.0.0/24\"  # VPN gateway range\n  security_group_id = openstack_networking_secgroup_v2.windows_servers.id\n}\n\n# GOOD: RDP from RD Gateway security group (reference-based rule)\nresource \"openstack_networking_secgroup_rule_v2\" \"rdp_from_rd_gateway\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 3389\n  port_range_max    = 3389\n  remote_group_id   = openstack_networking_secgroup_v2.rd_gateway.id  # Reference\n  security_group_id = openstack_networking_secgroup_v2.windows_servers.id\n}\n\n# Remote Desktop Gateway security group (least privilege)\nresource \"openstack_networking_secgroup_v2\" \"rd_gateway\" {\n  name        = \"rd-gateway-sg\"\n  description = \"Security group for Remote Desktop Gateway\"\n}\n\n# RD Gateway accepts RDP from corporate network only\nresource \"openstack_networking_secgroup_rule_v2\" \"rd_gateway_rdp\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 3389\n  port_range_max    = 3389\n  remote_ip_prefix  = var.corporate_cidr  # e.g., 198.51.100.0/24\n  security_group_id = openstack_networking_secgroup_v2.rd_gateway.id\n}\n\n# RD Gateway also needs HTTPS for external RDG clients\nresource \"openstack_networking_secgroup_rule_v2\" \"rd_gateway_https\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 443\n  port_range_max    = 443\n  remote_ip_prefix  = var.corporate_cidr  # Restrict to corporate IPs\n  security_group_id = openstack_networking_secgroup_v2.rd_gateway.id\n}\n\n# BAD: Never do this - RDP from anywhere (0.0.0.0/0)\n# resource \"openstack_networking_secgroup_rule_v2\" \"rdp_from_anywhere\" {\n#   direction         = \"ingress\"\n#   ethertype         = \"IPv4\"\n#   protocol          = \"tcp\"\n#   port_range_min    = 3389\n#   port_range_max    = 3389\n#   remote_ip_prefix  = \"0.0.0.0/0\"  # DANGEROUS - DO NOT USE\n#   security_group_id = openstack_networking_secgroup_v2.windows_servers.id\n# }\n```"
    },
    "Recommendation": {
      "Text": "Implement **defense-in-depth** for RDP access control:\n- **Restrict RDP to known IP ranges**: allow only corporate offices, VPN gateways, or RD Gateway IPs\n- **Deploy Remote Desktop Gateway (RD Gateway)** as the single point of RDP entry with connection authorization policies\n- **Use VPN gateways** for administrative access instead of direct public RDP exposure\n- **Enable Network Level Authentication (NLA)**: require authentication before session establishment to prevent pre-auth exploits\n- **Implement multi-factor authentication (MFA)**: use smart cards, Windows Hello, FIDO2, or third-party MFA (Duo, Azure MFA)\n- **Use strong passwords and LAPS**: deploy Local Administrator Password Solution for unique, rotating local admin passwords\n- **Enable Restricted Admin mode**: prevent credential delegation to protect against pass-the-hash attacks\n- **Patch Windows instances regularly**: apply security updates for RDP vulnerabilities (BlueKeep, DejaBlue, etc.)\n- **Use non-standard RDP ports** with port knocking for additional obscurity (not a replacement for proper access controls)\n- **Monitor RDP logs (Event ID 4624, 4625, 4778, 4779)**: detect failed logins, unusual source IPs, and off-hours access\n- **Implement account lockout policies**: automatically disable accounts after repeated failed login attempts\n- **Enable Windows Firewall**: apply strict ingress rules even with security groups in place\n- **Use security group references** instead of CIDR blocks when possible (e.g., allow RDP from RD Gateway security group)\n- **Consider Just-In-Time (JIT) access**: grant temporary RDP access for specific durations instead of permanent rules\n- **Enable session recording**: use tools like Remote Desktop Session Host session recording for compliance and forensics\n- **Audit security group rules regularly**: identify and remove stale or overly permissive RDP entries\n- **Document RDP access procedures**: create runbooks for operators with approved connection workflows",
      "Url": "https://hub.prowler.com/check/network_security_group_allows_rdp_from_internet"
    }
  },
  "Categories": [
    "internet-exposed",
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [
    "network_security_group_allows_ssh_from_internet"
  ],
  "Notes": "This check flags security groups with RDP (port 3389) ingress rules allowing 0.0.0.0/0 or ::/0. Some architectures legitimately require public RDP access (bastion hosts, RD Gateway, jump servers). Review findings in context of your Windows infrastructure. Rules allowing RDP from specific IPs (e.g., 198.51.100.0/24) or from other security groups (remote_group_id) are not flagged. IPv6 rules (::/0) are also checked. Port ranges that include port 3389 (e.g., 3000-4000) will trigger this check."
}
