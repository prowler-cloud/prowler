{
  "Provider": "openstack",
  "CheckID": "network_security_group_allows_rdp_from_internet",
  "CheckTitle": "Security groups do not allow RDP from the Internet",
  "CheckType": [],
  "ServiceName": "network",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "OpenStackSecurityGroup",
  "ResourceGroup": "network",
  "Description": "**OpenStack security groups** are evaluated to verify that RDP (port 3389) is **not exposed to the Internet** (0.0.0.0/0 or ::/0). Security groups act as virtual firewalls controlling Windows instance traffic. Unrestricted RDP access violates least privilege and creates significant attack surface. Best practices recommend restricting RDP to **known IP ranges**, **RD Gateway**, or **VPN**.",
  "Risk": "Unrestricted RDP exposes Windows instances to brute-force attacks, password spraying, and RDP vulnerabilities (BlueKeep, DejaBlue). Compromised sessions enable ransomware deployment, credential theft, privilege escalation, and lateral movement. Successful compromise leads to domain controller access, Active Directory enumeration, and organization-wide data exfiltration.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/neutron/latest/admin/intro-os-networking.html",
    "https://docs.openstack.org/security-guide/networking/architecture.html",
    "https://docs.openstack.org/api-ref/network/v2/",
    "https://www.cisa.gov/news-events/cybersecurity-advisories/aa19-168a",
    "https://www.ncsc.gov.uk/guidance/preventing-lateral-movement"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "",
      "Other": "1. Navigate to Network > Security Groups\n2. Locate the security group with unrestricted RDP access\n3. Click Manage Rules\n4. Delete RDP rules with Remote 0.0.0.0/0 or ::/0\n5. Click Add Rule and create a new RDP rule\n6. Set Remote to CIDR with your trusted IP (e.g., 198.51.100.50/32)\n7. Save changes and verify connectivity",
      "Terraform": "```hcl\n# Terraform: restrict RDP to known IP ranges, never 0.0.0.0/0\n\nresource \"openstack_networking_secgroup_v2\" \"windows_servers\" {\n  name        = \"windows-servers-sg\"\n  description = \"Security group for Windows application servers\"\n}\n\n# GOOD: RDP restricted to corporate VPN IP range\nresource \"openstack_networking_secgroup_rule_v2\" \"rdp_from_vpn\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 3389\n  port_range_max    = 3389\n  remote_ip_prefix  = \"10.8.0.0/24\"  # VPN gateway range\n  security_group_id = openstack_networking_secgroup_v2.windows_servers.id\n}\n\n# GOOD: RDP from RD Gateway security group (reference-based rule)\nresource \"openstack_networking_secgroup_rule_v2\" \"rdp_from_rd_gateway\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 3389\n  port_range_max    = 3389\n  remote_group_id   = openstack_networking_secgroup_v2.rd_gateway.id  # Reference\n  security_group_id = openstack_networking_secgroup_v2.windows_servers.id\n}\n\n# Remote Desktop Gateway security group (least privilege)\nresource \"openstack_networking_secgroup_v2\" \"rd_gateway\" {\n  name        = \"rd-gateway-sg\"\n  description = \"Security group for Remote Desktop Gateway\"\n}\n\n# RD Gateway accepts RDP from corporate network only\nresource \"openstack_networking_secgroup_rule_v2\" \"rd_gateway_rdp\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 3389\n  port_range_max    = 3389\n  remote_ip_prefix  = var.corporate_cidr  # e.g., 198.51.100.0/24\n  security_group_id = openstack_networking_secgroup_v2.rd_gateway.id\n}\n\n# RD Gateway also needs HTTPS for external RDG clients\nresource \"openstack_networking_secgroup_rule_v2\" \"rd_gateway_https\" {\n  direction         = \"ingress\"\n  ethertype         = \"IPv4\"\n  protocol          = \"tcp\"\n  port_range_min    = 443\n  port_range_max    = 443\n  remote_ip_prefix  = var.corporate_cidr  # Restrict to corporate IPs\n  security_group_id = openstack_networking_secgroup_v2.rd_gateway.id\n}\n\n# BAD: Never do this - RDP from anywhere (0.0.0.0/0)\n# resource \"openstack_networking_secgroup_rule_v2\" \"rdp_from_anywhere\" {\n#   direction         = \"ingress\"\n#   ethertype         = \"IPv4\"\n#   protocol          = \"tcp\"\n#   port_range_min    = 3389\n#   port_range_max    = 3389\n#   remote_ip_prefix  = \"0.0.0.0/0\"  # DANGEROUS - DO NOT USE\n#   security_group_id = openstack_networking_secgroup_v2.windows_servers.id\n# }\n```"
    },
    "Recommendation": {
      "Text": "Restrict RDP access to known IP ranges using Remote Desktop Gateway or VPN instead of allowing 0.0.0.0/0. Enable Network Level Authentication (NLA) and implement multi-factor authentication for all RDP sessions. Deploy LAPS for unique local administrator passwords and patch Windows systems regularly to address RDP vulnerabilities.",
      "Url": "https://hub.prowler.com/check/network_security_group_allows_rdp_from_internet"
    }
  },
  "Categories": [
    "internet-exposed",
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [
    "network_security_group_allows_ssh_from_internet"
  ],
  "Notes": "This check flags security groups with RDP (port 3389) ingress rules allowing 0.0.0.0/0 or ::/0. Some architectures legitimately require public RDP access (bastion hosts, RD Gateway, jump servers). Review findings in context of your Windows infrastructure. Rules allowing RDP from specific IPs (e.g., 198.51.100.0/24) or from other security groups (remote_group_id) are not flagged. IPv6 rules (::/0) are also checked. Port ranges that include port 3389 (e.g., 3000-4000) will trigger this check."
}
