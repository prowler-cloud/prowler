{
  "Provider": "openstack",
  "CheckID": "network_port_security_disabled",
  "CheckTitle": "Port security is enabled on networks and ports",
  "CheckType": [],
  "ServiceName": "network",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "OpenStackNetwork",
  "ResourceGroup": "network",
  "Description": "**OpenStack networks and ports** are evaluated to verify that **port security is enabled** (port_security_enabled=True). Port security prevents MAC address spoofing and IP address spoofing by enforcing anti-spoofing rules at the virtual switch level. When port security is disabled, instances can forge arbitrary source MAC addresses and IP addresses, bypassing network isolation and enabling man-in-the-middle (MITM) attacks, ARP spoofing, and unauthorized access to other tenants' networks. Port security enforcement includes MAC/IP filtering, DHCP snooping, and security group application. Disabling port security is sometimes required for specific use cases like NFV (Network Functions Virtualization) or SR-IOV (Single Root I/O Virtualization), but creates significant security risks when used on general-purpose instance ports or networks.",
  "Risk": "Networks and ports with disabled port security allow instances to perform MAC and IP spoofing attacks, completely bypassing OpenStack network isolation. Attackers controlling a compromised instance can spoof the MAC addresses of other instances to intercept their network traffic via ARP poisoning, enabling passive eavesdropping and active MITM attacks. IP address spoofing allows attackers to bypass security group rules by forging source IPs that match allowed CIDR blocks, circumventing firewall policies and accessing restricted services. Spoofed IP addresses can be used to attack other tenants in multi-tenant environments, violating cloud isolation boundaries and enabling cross-tenant data exfiltration. Disabled port security prevents security groups from being enforced properly, as anti-spoofing rules cannot validate that traffic actually originates from assigned IP addresses. ARP spoofing attacks can redirect traffic destined for legitimate instances (like database servers or API endpoints) to attacker-controlled instances, capturing credentials and sensitive data. MAC spoofing enables attackers to impersonate network infrastructure components like routers or DHCP servers, poisoning routing tables and distributing malicious network configuration. Compliance frameworks (PCI-DSS, HIPAA, SOC 2) require network isolation controls, and disabled port security violates these requirements by removing foundational anti-spoofing protections. Incident response and forensics become impossible when source IP/MAC addresses cannot be trusted, as attackers can forge identities to evade detection and attribution. Shared networks with disabled port security allow any tenant to attack other tenants on the same broadcast domain, creating liability for cloud providers and violating SLAs.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/neutron/latest/admin/intro-os-networking.html",
    "https://docs.openstack.org/neutron/latest/admin/config-ipam.html",
    "https://docs.openstack.org/security-guide/networking/architecture.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "# List networks with port security disabled\nopenstack network list --long | grep -i \"port_security_enabled.*false\"\n\n# Enable port security on a specific network\nopenstack network set --enable-port-security <network_id>\n\n# Verify port security is enabled\nopenstack network show <network_id> -f json | jq -r '.port_security_enabled'\n\n# List ports with port security disabled\nopenstack port list --long | grep -i \"port_security_enabled.*false\"\n\n# Enable port security on a specific port\nopenstack port set --enable-port-security <port_id>\n\n# For ports that legitimately need port security disabled (NFV, SR-IOV):\n# 1. Document the business justification\n# 2. Apply additional security controls (isolated networks, monitoring)\n# 3. Use network policies to limit blast radius",
      "NativeIaC": "",
      "Other": "**Option 1: Enable port security via Horizon Dashboard**\n1. Navigate to **Project > Network > Networks**\n2. For each network, click **Edit Network**\n3. In the **Edit Network** dialog:\n   - Locate the **Port Security** checkbox\n   - Ensure it is **checked** (enabled)\n   - Click **Save**\n4. Navigate to **Project > Network > Networks > Ports**\n5. For each port, click **Edit Port**\n6. In the **Edit Port** dialog:\n   - Locate the **Port Security** checkbox\n   - Ensure it is **checked** (enabled)\n   - Click **Save**\n7. Verify changes:\n   ```bash\n   openstack network show <network_id> | grep port_security_enabled\n   openstack port show <port_id> | grep port_security_enabled\n   ```\n\n**Option 2: Enable port security globally (New Networks)**\n1. **Edit Neutron configuration** on controller nodes:\n   ```bash\n   sudo vim /etc/neutron/plugins/ml2/ml2_conf.ini\n   ```\n2. **Set default port security** in `[ml2]` section:\n   ```ini\n   [ml2]\n   extension_drivers = port_security\n   enable_security_group = true\n   ```\n3. **Restart Neutron services**:\n   ```bash\n   sudo systemctl restart neutron-server\n   sudo systemctl restart neutron-openvswitch-agent\n   ```\n4. **Verify new networks have port security enabled by default**:\n   ```bash\n   openstack network create test-network\n   openstack network show test-network | grep port_security_enabled\n   # Should show: port_security_enabled=True\n   ```\n5. **Clean up test network**:\n   ```bash\n   openstack network delete test-network\n   ```\n\n**Option 3: Audit and remediate existing resources**\n1. **Create audit script** to find all resources with disabled port security:\n   ```bash\n   #!/bin/bash\n   echo \"=== Networks with Port Security Disabled ===\"\n   openstack network list -f json | jq -r '.[] | select(.port_security_enabled == false) | .ID + \" \" + .Name'\n   \n   echo \"\"\n   echo \"=== Ports with Port Security Disabled ===\"\n   openstack port list -f json | jq -r '.[] | select(.port_security_enabled == false) | .ID + \" \" + .Name'\n   ```\n2. **For each resource**, determine if port security should be enabled:\n   - **General instance ports**: Enable port security\n   - **NFV/SR-IOV ports**: May legitimately require disabled port security\n   - **External network ports**: Enable port security unless documented exception\n3. **Enable port security** on resources that should have it:\n   ```bash\n   # Bulk enable for networks\n   for net_id in $(openstack network list -f json | jq -r '.[] | select(.port_security_enabled == false) | .ID'); do\n     echo \"Enabling port security on network $net_id\"\n     openstack network set --enable-port-security $net_id\n   done\n   \n   # Bulk enable for ports (with caution - verify first)\n   for port_id in $(openstack port list -f json | jq -r '.[] | select(.port_security_enabled == false) | .ID'); do\n     echo \"WARNING: Verify port $port_id before enabling\"\n     # Uncomment after verification:\n     # openstack port set --enable-port-security $port_id\n   done\n   ```\n4. **Document exceptions** for legitimate use cases:\n   - Create a register of ports/networks that require disabled port security\n   - Include business justification, owner, and review date\n   - Implement compensating controls (dedicated networks, monitoring)\n\n**Option 4: Implement monitoring for port security changes**\n1. **Create monitoring script**:\n   ```bash\n   #!/bin/bash\n   # /usr/local/bin/monitor-port-security.sh\n   DISABLED_NETWORKS=$(openstack network list -f json | jq -r '.[] | select(.port_security_enabled == false) | .ID + \" \" + .Name')\n   DISABLED_PORTS=$(openstack port list -f json | jq -r '.[] | select(.port_security_enabled == false) | .ID')\n   \n   if [ -n \"$DISABLED_NETWORKS\" ] || [ -n \"$DISABLED_PORTS\" ]; then\n     echo \"ALERT: Resources with disabled port security detected\"\n     echo \"Networks: $DISABLED_NETWORKS\"\n     echo \"Ports: $(echo $DISABLED_PORTS | wc -w) ports\"\n     # Send alert to SIEM/monitoring system\n   fi\n   ```\n2. **Schedule with cron**:\n   ```cron\n   */30 * * * * /usr/local/bin/monitor-port-security.sh\n   ```\n3. **Implement audit logging** for port security changes:\n   - Enable Neutron audit logging in keystone\n   - Monitor for `port_security_enabled` attribute changes\n   - Alert on unauthorized modifications",
      "Terraform": "```hcl\n# Terraform: ensure port security is enabled on networks and ports\n\n# GOOD: Network with port security enabled (default)\nresource \"openstack_networking_network_v2\" \"secure_network\" {\n  name           = \"prod-app-network\"\n  admin_state_up = true\n  # port_security_enabled defaults to true - explicitly set for clarity\n  # No need to specify if keeping default\n}\n\n# GOOD: Explicitly enable port security\nresource \"openstack_networking_network_v2\" \"explicit_security\" {\n  name           = \"prod-web-network\"\n  admin_state_up = true\n  # Explicitly enable port security\n  # Note: Check if your OpenStack provider version supports this attribute\n}\n\n# GOOD: Port with port security enabled\nresource \"openstack_networking_port_v2\" \"secure_port\" {\n  name           = \"instance-port-01\"\n  network_id     = openstack_networking_network_v2.secure_network.id\n  admin_state_up = true\n  \n  # Port security enabled by default\n  # Apply security groups\n  security_group_ids = [\n    openstack_networking_secgroup_v2.web_sg.id,\n  ]\n  \n  fixed_ip {\n    subnet_id = openstack_networking_subnet_v2.subnet.id\n  }\n}\n\n# BAD: Port with port security disabled (security risk)\n# resource \"openstack_networking_port_v2\" \"insecure_port\" {\n#   name           = \"nfv-port-01\"\n#   network_id     = openstack_networking_network_v2.network.id\n#   admin_state_up = true\n#   \n#   # DANGEROUS: Disabling port security allows MAC/IP spoofing\n#   port_security_enabled = false\n#   \n#   # Security groups cannot be enforced without port security\n#   # security_group_ids = []  # Must be empty when port_security_enabled = false\n# }\n\n# ACCEPTABLE: Disabled port security for legitimate NFV use case with documentation\nresource \"openstack_networking_port_v2\" \"nfv_port\" {\n  name           = \"nfv-vrouter-port\"\n  network_id     = openstack_networking_network_v2.nfv_network.id\n  admin_state_up = true\n  \n  # Port security disabled for NFV virtual router\n  # JUSTIFICATION: SR-IOV network function requires promiscuous mode\n  # COMPENSATING CONTROLS: \n  #   - Isolated network (no shared tenants)\n  #   - Network-level ACLs via provider firewall\n  #   - Monitoring for anomalous traffic patterns\n  port_security_enabled = false\n  \n  # Cannot use security groups with disabled port security\n  security_group_ids = []\n}\n\n# Create dedicated isolated network for resources requiring disabled port security\nresource \"openstack_networking_network_v2\" \"nfv_network\" {\n  name           = \"nfv-isolated-network\"\n  admin_state_up = true\n  # Isolated network - not shared with other projects\n  shared = false\n}\n\n# Validation: Check port security is enabled\nresource \"null_resource\" \"validate_port_security\" {\n  depends_on = [openstack_networking_port_v2.secure_port]\n  \n  provisioner \"local-exec\" {\n    command = <<-EOF\n      # Verify port security is enabled\n      PORT_SECURITY=$(openstack port show ${openstack_networking_port_v2.secure_port.id} -f json | jq -r '.port_security_enabled')\n      if [ \"$PORT_SECURITY\" != \"true\" ]; then\n        echo \"ERROR: Port security is disabled on ${openstack_networking_port_v2.secure_port.id}\"\n        exit 1\n      fi\n      echo \"âœ“ Port security validation passed\"\n    EOF\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Implement **port security best practices** for network isolation:\n- **Enable port security by default**: Configure Neutron to enable port security on all new networks and ports\n- **Audit existing resources**: Identify and remediate networks/ports with disabled port security\n- **Document exceptions**: Maintain a register of legitimate use cases requiring disabled port security (NFV, SR-IOV)\n- **Use isolated networks for NFV**: Deploy resources requiring disabled port security on dedicated non-shared networks\n- **Implement compensating controls**: For legitimate exceptions, add network-level ACLs, monitoring, and IDS/IPS\n- **Enable anti-spoofing rules**: Verify security groups are applied and enforced on all ports with port security enabled\n- **Monitor for unauthorized changes**: Alert when port_security_enabled is set to false on production resources\n- **Apply least privilege**: Restrict who can modify port security settings using OpenStack RBAC policies\n- **Test security group enforcement**: Verify that instances cannot spoof IP addresses when port security is enabled\n- **Use allowed-address-pairs carefully**: When additional IPs are needed, use allowed-address-pairs instead of disabling port security\n- **Separate control plane and data plane**: NFV workloads requiring disabled port security should use dedicated data plane networks\n- **Implement network segmentation**: Use separate networks for different security zones (DMZ, internal, management)\n- **Enable DHCP snooping**: Verify DHCP snooping is active on networks with port security enabled\n- **Monitor ARP traffic**: Detect ARP spoofing attempts that would be prevented by port security\n- **Document network topology**: Maintain diagrams showing which networks have port security enabled/disabled and why",
      "Url": "https://hub.prowler.com/check/network_port_security_disabled"
    }
  },
  "Categories": [
    "network-isolation"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "This check flags both networks and ports where `port_security_enabled == False`. Port security prevents MAC address spoofing and IP address spoofing by enforcing anti-spoofing rules. Legitimate use cases for disabled port security include: (1) Network Functions Virtualization (NFV) requiring promiscuous mode, (2) SR-IOV (Single Root I/O Virtualization) ports, (3) VLAN trunking ports, or (4) Load balancer VIP ports using VRRP. If your deployment has resources with disabled port security, verify they are documented exceptions with compensating security controls. Port security is enabled by default in OpenStack Neutron unless explicitly disabled."
}
