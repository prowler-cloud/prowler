{
  "Provider": "openstack",
  "CheckID": "network_port_security_disabled",
  "CheckTitle": "Port security is enabled on networks and ports",
  "CheckType": [],
  "ServiceName": "network",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "OpenStackNetwork",
  "ResourceGroup": "network",
  "Description": "**OpenStack networks and ports** are evaluated to verify that **port security is enabled** (port_security_enabled=True). Port security prevents MAC address spoofing and IP address spoofing by enforcing anti-spoofing rules at the virtual switch level. When port security is disabled, instances can forge arbitrary source MAC addresses and IP addresses, bypassing network isolation and enabling man-in-the-middle (MITM) attacks, ARP spoofing, and unauthorized access to other tenants' networks. Port security enforcement includes MAC/IP filtering, DHCP snooping, and security group application. Disabling port security is sometimes required for specific use cases like NFV (Network Functions Virtualization) or SR-IOV (Single Root I/O Virtualization), but creates significant security risks when used on general-purpose instance ports or networks.",
  "Risk": "Networks and ports with disabled port security allow instances to perform MAC and IP spoofing attacks, completely bypassing OpenStack network isolation. Attackers controlling a compromised instance can spoof MAC addresses to intercept network traffic via ARP poisoning, enabling passive eavesdropping and active MITM attacks. IP address spoofing allows attackers to bypass security group rules by forging source IPs that match allowed CIDR blocks, circumventing firewall policies and accessing restricted services. Spoofed IP addresses can be used to attack other tenants in multi-tenant environments, violating cloud isolation boundaries and enabling cross-tenant data exfiltration. Disabled port security prevents security groups from being enforced properly, as anti-spoofing rules cannot validate that traffic originates from assigned IP addresses. ARP spoofing attacks can redirect traffic destined for legitimate instances to attacker-controlled instances, capturing credentials and sensitive data. Compliance frameworks (PCI-DSS, HIPAA, SOC 2) require network isolation controls, and disabled port security violates these requirements.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.openstack.org/neutron/latest/admin/intro-os-networking.html",
    "https://docs.openstack.org/neutron/latest/admin/config-ipam.html",
    "https://docs.openstack.org/security-guide/networking/architecture.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "# List networks with port security disabled\nopenstack network list --long | grep -i \"port_security_enabled.*false\"\n\n# Enable port security on a specific network\nopenstack network set --enable-port-security <network_id>\n\n# Verify port security is enabled\nopenstack network show <network_id> -f json | jq -r '.port_security_enabled'\n\n# List ports with port security disabled\nopenstack port list --long | grep -i \"port_security_enabled.*false\"\n\n# Enable port security on a specific port\nopenstack port set --enable-port-security <port_id>\n\n# For ports that legitimately need port security disabled (NFV, SR-IOV):\n# 1. Document the business justification\n# 2. Apply additional security controls (isolated networks, monitoring)\n# 3. Use network policies to limit blast radius",
      "NativeIaC": "",
      "Other": "1. Navigate to Project > Network > Networks\n2. For each network, click Edit Network\n3. Ensure the Port Security checkbox is checked\n4. Click Save\n5. Navigate to Project > Network > Networks > Ports\n6. For each port, click Edit Port\n7. Ensure the Port Security checkbox is checked\n8. Click Save",
      "Terraform": "```hcl\n# Terraform: ensure port security is enabled on networks and ports\n\n# GOOD: Network with port security enabled (default)\nresource \"openstack_networking_network_v2\" \"secure_network\" {\n  name           = \"prod-app-network\"\n  admin_state_up = true\n  # port_security_enabled defaults to true - explicitly set for clarity\n  # No need to specify if keeping default\n}\n\n# GOOD: Explicitly enable port security\nresource \"openstack_networking_network_v2\" \"explicit_security\" {\n  name           = \"prod-web-network\"\n  admin_state_up = true\n  # Explicitly enable port security\n  # Note: Check if your OpenStack provider version supports this attribute\n}\n\n# GOOD: Port with port security enabled\nresource \"openstack_networking_port_v2\" \"secure_port\" {\n  name           = \"instance-port-01\"\n  network_id     = openstack_networking_network_v2.secure_network.id\n  admin_state_up = true\n  \n  # Port security enabled by default\n  # Apply security groups\n  security_group_ids = [\n    openstack_networking_secgroup_v2.web_sg.id,\n  ]\n  \n  fixed_ip {\n    subnet_id = openstack_networking_subnet_v2.subnet.id\n  }\n}\n\n# BAD: Port with port security disabled (security risk)\n# resource \"openstack_networking_port_v2\" \"insecure_port\" {\n#   name           = \"nfv-port-01\"\n#   network_id     = openstack_networking_network_v2.network.id\n#   admin_state_up = true\n#   \n#   # DANGEROUS: Disabling port security allows MAC/IP spoofing\n#   port_security_enabled = false\n#   \n#   # Security groups cannot be enforced without port security\n#   # security_group_ids = []  # Must be empty when port_security_enabled = false\n# }\n\n# ACCEPTABLE: Disabled port security for legitimate NFV use case with documentation\nresource \"openstack_networking_port_v2\" \"nfv_port\" {\n  name           = \"nfv-vrouter-port\"\n  network_id     = openstack_networking_network_v2.nfv_network.id\n  admin_state_up = true\n  \n  # Port security disabled for NFV virtual router\n  # JUSTIFICATION: SR-IOV network function requires promiscuous mode\n  # COMPENSATING CONTROLS: \n  #   - Isolated network (no shared tenants)\n  #   - Network-level ACLs via provider firewall\n  #   - Monitoring for anomalous traffic patterns\n  port_security_enabled = false\n  \n  # Cannot use security groups with disabled port security\n  security_group_ids = []\n}\n\n# Create dedicated isolated network for resources requiring disabled port security\nresource \"openstack_networking_network_v2\" \"nfv_network\" {\n  name           = \"nfv-isolated-network\"\n  admin_state_up = true\n  # Isolated network - not shared with other projects\n  shared = false\n}\n\n# Validation: Check port security is enabled\nresource \"null_resource\" \"validate_port_security\" {\n  depends_on = [openstack_networking_port_v2.secure_port]\n  \n  provisioner \"local-exec\" {\n    command = <<-EOF\n      # Verify port security is enabled\n      PORT_SECURITY=$(openstack port show ${openstack_networking_port_v2.secure_port.id} -f json | jq -r '.port_security_enabled')\n      if [ \"$PORT_SECURITY\" != \"true\" ]; then\n        echo \"ERROR: Port security is disabled on ${openstack_networking_port_v2.secure_port.id}\"\n        exit 1\n      fi\n      echo \"âœ“ Port security validation passed\"\n    EOF\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Implement **port security best practices** for network isolation:\n- **Enable port security by default**: Configure Neutron to enable port security on all new networks and ports\n- **Audit existing resources**: Identify and remediate networks/ports with disabled port security\n- **Document exceptions**: Maintain a register of legitimate use cases requiring disabled port security (NFV, SR-IOV)\n- **Use isolated networks for NFV**: Deploy resources requiring disabled port security on dedicated non-shared networks\n- **Implement compensating controls**: For legitimate exceptions, add network-level ACLs, monitoring, and IDS/IPS\n- **Enable anti-spoofing rules**: Verify security groups are applied and enforced on all ports with port security enabled\n- **Monitor for unauthorized changes**: Alert when port_security_enabled is set to false on production resources\n- **Apply least privilege**: Restrict who can modify port security settings using OpenStack RBAC policies\n- **Test security group enforcement**: Verify that instances cannot spoof IP addresses when port security is enabled\n- **Use allowed-address-pairs carefully**: When additional IPs are needed, use allowed-address-pairs instead of disabling port security\n- **Separate control plane and data plane**: NFV workloads requiring disabled port security should use dedicated data plane networks\n- **Implement network segmentation**: Use separate networks for different security zones (DMZ, internal, management)\n- **Enable DHCP snooping**: Verify DHCP snooping is active on networks with port security enabled\n- **Monitor ARP traffic**: Detect ARP spoofing attempts that would be prevented by port security\n- **Document network topology**: Maintain diagrams showing which networks have port security enabled/disabled and why",
      "Url": "https://hub.prowler.com/check/network_port_security_disabled"
    }
  },
  "Categories": [
    "trust-boundaries",
    "vulnerabilities"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "This check flags both networks and ports where `port_security_enabled == False`. Port security prevents MAC address spoofing and IP address spoofing by enforcing anti-spoofing rules. Legitimate use cases for disabled port security include: (1) Network Functions Virtualization (NFV) requiring promiscuous mode, (2) SR-IOV (Single Root I/O Virtualization) ports, (3) VLAN trunking ports, or (4) Load balancer VIP ports using VRRP. If your deployment has resources with disabled port security, verify they are documented exceptions with compensating security controls. Port security is enabled by default in OpenStack Neutron unless explicitly disabled."
}
