{
  "Provider": "aws",
  "CheckID": "networkfirewall_policy_rule_group_associated",
  "CheckTitle": "Network Firewall policy has at least one rule group associated",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Network Reachability",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/NIST 800-53 Controls (USA)"
  ],
  "ServiceName": "networkfirewall",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsNetworkFirewallFirewall",
  "ResourceGroup": "network",
  "Description": "Network Firewall policies have one or more **stateful** or **stateless rule groups** associated to define packet inspection and handling.\n\nPolicies with no rule groups are identified.",
  "Risk": "Without rule groups, traffic isn't meaningfully inspected, allowing unauthorized flows across VPC boundaries.\n\nImpacts:\n- Confidentiality: data exfiltration\n- Integrity: unauthorized changes via exposed services\n- Availability: C2, scanning, or DoS traffic passes; enables lateral movement",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/network-firewall/latest/developerguide/rule-groups.html",
    "https://docs.aws.amazon.com/network-firewall/latest/developerguide/firewall-policy-updating.html",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/networkfirewall-controls.html#networkfirewall-3",
    "https://medium.com/slalom-blog/secure-internet-access-egress-filtering-with-aws-network-firewall-ddf52ae121f9",
    "https://docs.aws.amazon.com/de_de/network-firewall/latest/developerguide/nwfw-using-managed-rule-groups-add-to-policy.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\n# CloudFormation: Attach at least one rule group to a Network Firewall policy\nResources:\n  FirewallPolicy:\n    Type: AWS::NetworkFirewall::FirewallPolicy\n    Properties:\n      FirewallPolicyName: <example_resource_name>\n      FirewallPolicy:\n        StatelessDefaultActions:\n          - aws:forward_to_sfe\n        StatelessFragmentDefaultActions:\n          - aws:forward_to_sfe\n        # Critical: Associate at least one rule group with the policy to pass the check\n        StatefulRuleGroupReferences:\n          - ResourceArn: <example_resource_arn>  # Critical line: references an existing rule group ARN\n```",
      "Other": "1. Open the AWS Console and go to VPC > Network Firewall > Firewall policies\n2. Select the target firewall policy\n3. In Stateful rule groups (or Stateless rule groups), choose Add rule groups (or Add managed stateful/stateless rule groups)\n4. Select at least one existing rule group and choose Add to policy\n5. Click Save",
      "Terraform": "```hcl\n# Attach at least one rule group to a Network Firewall policy\nresource \"aws_networkfirewall_firewall_policy\" \"<example_resource_name>\" {\n  name = \"<example_resource_name>\"\n\n  firewall_policy {\n    stateless_default_actions          = [\"aws:forward_to_sfe\"]\n    stateless_fragment_default_actions = [\"aws:forward_to_sfe\"]\n\n    # Critical: Associate at least one rule group with the policy to pass the check\n    stateful_rule_group_reference {\n      resource_arn = \"<example_resource_arn>\"  # Critical line: references an existing rule group ARN\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Associate appropriate **stateful** and **stateless rule groups** with every policy.\n- Enforce a **deny-by-default** posture (least privilege)\n- Use vetted managed rule groups as a baseline, then tailor to workloads\n- Review and test regularly; version rules, monitor logs, and require change control",
      "Url": "https://hub.prowler.com/check/networkfirewall_policy_rule_group_associated"
    }
  },
  "Categories": [
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
