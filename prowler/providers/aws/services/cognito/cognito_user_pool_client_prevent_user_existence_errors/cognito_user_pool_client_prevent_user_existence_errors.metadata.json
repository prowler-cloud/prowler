{
  "Provider": "aws",
  "CheckID": "cognito_user_pool_client_prevent_user_existence_errors",
  "CheckTitle": "Amazon Cognito user pool client has Prevent User Existence Errors enabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "TTPs/Discovery",
    "Effects/Data Exposure"
  ],
  "ServiceName": "cognito",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "Other",
  "ResourceGroup": "IAM",
  "Description": "Amazon Cognito app clients use `PreventUserExistenceErrors` to suppress **user-existence disclosures**, keeping authentication, confirmation, and recovery responses generic rather than indicating whether a username exists.",
  "Risk": "If responses reveal user existence, adversaries can **enumerate accounts**, enabling targeted **credential stuffing**, **brute force**, and **password-reset abuse**. This facilitates **account takeover**, leaks PII, and can degrade availability through automated lockouts.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://repost.aws/knowledge-center/cognito-prevent-user-existence-errors",
    "https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-managing-errors.html",
    "https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html",
    "https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-cognito-userpoolclient.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws cognito-idp update-user-pool-client --user-pool-id <USER_POOL_ID> --client-id <APP_CLIENT_ID> --prevent-user-existence-errors ENABLED",
      "NativeIaC": "```yaml\nResources:\n  <example_resource_name>:\n    Type: AWS::Cognito::UserPoolClient\n    Properties:\n      UserPoolId: <example_resource_id>\n      PreventUserExistenceErrors: ENABLED  # Critical: enables suppression of user existence errors to pass the check\n      ClientName: <example_resource_name>\n```",
      "Other": "1. Open the Amazon Cognito console and go to User pools\n2. Select your user pool, then go to App integration > App clients\n3. Choose the target app client and click Edit\n4. Set Prevent user existence errors to Enabled\n5. Click Save changes",
      "Terraform": "```hcl\nresource \"aws_cognito_user_pool_client\" \"<example_resource_name>\" {\n  name         = \"<example_resource_name>\"\n  user_pool_id = \"<example_resource_id>\"\n\n  prevent_user_existence_errors = \"ENABLED\"  # Critical: prevents revealing if a user exists\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **user-existence suppression** on all app clients (`PreventUserExistenceErrors=ENABLED`). Apply **least disclosure** with generic messages across all auth flows and aliases. Strengthen with **MFA**, **rate limiting**, and **anomalous login detection** for **defense in depth**.",
      "Url": "https://hub.prowler.com/check/cognito_user_pool_client_prevent_user_existence_errors"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
