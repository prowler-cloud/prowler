{
  "Provider": "aws",
  "CheckID": "cognito_user_pool_blocks_potential_malicious_sign_in_attempts",
  "CheckTitle": "Amazon Cognito user pool blocks all potential malicious sign-in attempts",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "TTPs/Initial Access"
  ],
  "ServiceName": "cognito",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "Other",
  "Description": "**Amazon Cognito user pool** with **threat protection** in `ENFORCED` mode and **adaptive authentication** actions set to `BLOCK` for `low`, `medium`, and `high` account-takeover risk levels.\n\nEvaluates the user pool's risk configuration to confirm risky sign-in attempts are blocked across all severities.",
  "Risk": "Permitting risky sign-ins degrades **confidentiality** and **integrity**. Attackers with **stolen or guessed credentials** can achieve **account takeover**, access data, change credentials, and escalate privileges, enabling lateral movement and persistence.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.fusioncyber.co/blogs/cloud/using-amazon-cognito-for-secure-login-to-your-web-app",
    "https://builder.aws.com/content/2kOUCPNB88CswrD3uyXCzTcdxtM/threat-protection-for-custom-authentication-flow-in-amazon-cognito",
    "https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-advanced-security.html",
    "https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/cognito-idp/client/describe_risk_configuration.html",
    "https://support.icompaas.com/support/solutions/articles/62000233676-ensure-that-your-amazon-cognito-user-pool-blocks-potential-malicious-sign-in-attempts",
    "https://builder.aws.com/content/2p7CHBirkTsrRezVJso3eiSi6Al/collecting-context-data-for-amazon-cognito-advanced-security-feature-adaptive-authentication"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\n# CloudFormation: Enforce threat protection and block all risk levels\nResources:\n  UserPool:\n    Type: AWS::Cognito::UserPool\n    Properties:\n      UserPoolAddOns:\n        AdvancedSecurityMode: ENFORCED  # Critical: Enables Full function threat protection (required for PASS)\n\n  RiskConfig:\n    Type: AWS::Cognito::UserPoolRiskConfigurationAttachment\n    Properties:\n      UserPoolId: !Ref UserPool\n      AccountTakeoverRiskConfiguration:\n        Actions:\n          LowAction:\n            EventAction: BLOCK  # Critical: Block low-risk sign-ins\n            Notify: false\n          MediumAction:\n            EventAction: BLOCK  # Critical: Block medium-risk sign-ins\n            Notify: false\n          HighAction:\n            EventAction: BLOCK  # Critical: Block high-risk sign-ins\n            Notify: false\n```",
      "Other": "1. In the AWS Console, go to Cognito > User pools and select <example_resource_name>\n2. Open Threat protection\n3. Set Enforcement mode to Full function and Save (enables Advanced security)\n4. In Account takeover risk configuration, set Low, Medium, and High to Block sign-in\n5. Save changes",
      "Terraform": "```hcl\n# Enforce threat protection and block all risk levels\nresource \"aws_cognito_user_pool\" \"<example_resource_name>\" {\n  user_pool_add_ons {\n    advanced_security_mode = \"ENFORCED\"  # Critical: Enables Full function threat protection (required for PASS)\n  }\n}\n\nresource \"aws_cognito_risk_configuration\" \"<example_resource_name>\" {\n  user_pool_id = aws_cognito_user_pool.<example_resource_name>.id\n\n  account_takeover_risk_configuration {\n    actions {\n      low_action    = \"BLOCK\"   # Critical: Block low-risk sign-ins\n      medium_action = \"BLOCK\"   # Critical: Block medium-risk sign-ins\n      high_action   = \"BLOCK\"   # Critical: Block high-risk sign-ins\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **threat protection** in `ENFORCED` mode and configure **adaptive authentication** to `BLOCK` at all risk levels.\n\nApply **least privilege** and **defense in depth**: require MFA, avoid broad Always-allow IPs, and monitor user event logs to tune responses and exceptions.",
      "Url": "https://hub.prowler.com/check/cognito_user_pool_blocks_potential_malicious_sign_in_attempts"
    }
  },
  "Categories": [
    "threat-detection",
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
