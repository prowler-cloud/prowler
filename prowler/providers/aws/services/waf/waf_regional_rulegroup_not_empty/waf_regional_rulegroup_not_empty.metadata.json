{
  "Provider": "aws",
  "CheckID": "waf_regional_rulegroup_not_empty",
  "CheckTitle": "AWS WAF Classic Regional rule group has at least one rule",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/NIST 800-53 Controls"
  ],
  "ServiceName": "waf",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsWafRegionalRuleGroup",
  "ResourceGroup": "security",
  "Description": "**AWS WAF Classic Regional rule groups** are evaluated to confirm they contain at least one **rule**. Groups with no rule entries are considered empty.",
  "Risk": "An empty rule group contributes no filtering in a web ACL, letting requests bypass inspection within that group. This erodes **defense in depth** and can enable injection, brute-force, or bot traffic to reach applications, threatening **confidentiality**, **integrity**, and **availability**.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/cli/latest/reference/waf-regional/update-rule-group.html",
    "https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-groups.html",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/waf-controls.html#waf-3"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws waf-regional update-rule-group --rule-group-id <rule-group-id> --updates Action=INSERT,ActivatedRule={Priority=1,RuleId=<rule-id>,Action={Type=BLOCK}} --change-token <change-token>",
      "NativeIaC": "```yaml\n# CloudFormation: Ensure WAF Classic Regional Rule Group has at least one rule\nResources:\n  <example_resource_name>:\n    Type: AWS::WAFRegional::RuleGroup\n    Properties:\n      Name: <example_resource_name>\n      MetricName: <example_resource_name>\n      ActivatedRules:\n        - Priority: 1  # Critical: adds a rule so the rule group is not empty\n          RuleId: <example_resource_id>  # Critical: references an existing rule to include in the group\n          Action:\n            Type: BLOCK\n```",
      "Other": "1. In the AWS Console, go to AWS WAF & Shield and switch to AWS WAF Classic\n2. Select the correct Region, then choose Rule groups\n3. Open the target rule group and click Edit rule group\n4. Click Add rule to rule group, select an existing rule, choose an action (e.g., BLOCK), and click Update\n5. Save changes to ensure the rule group contains at least one rule",
      "Terraform": "```hcl\n# Ensure WAF Classic Regional Rule Group has at least one rule\nresource \"aws_wafregional_rule_group\" \"<example_resource_name>\" {\n  name        = \"<example_resource_name>\"\n  metric_name = \"<example_resource_name>\"\n\n  # Critical: adds a rule so the rule group is not empty\n  activated_rule {\n    priority = 1\n    rule_id  = \"<example_resource_id>\"  # existing rule ID\n    action {\n      type = \"BLOCK\"\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply **least privilege**: populate each rule group with vetted rules aligned to your threat model, using `ALLOW`, `BLOCK`, or `COUNT` actions as appropriate. Remove or disable unused groups to avoid false assurance. Validate behavior in staging and monitor metrics to maintain **defense in depth**.",
      "Url": "https://hub.prowler.com/check/waf_regional_rulegroup_not_empty"
    }
  },
  "Categories": [],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
