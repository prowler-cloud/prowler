{
  "Provider": "aws",
  "CheckID": "s3_bucket_shadow_resource_vulnerability",
  "CheckTitle": "S3 bucket is not a known shadow resource owned by another account",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Effects/Data Exposure",
    "Effects/Data Exfiltration",
    "TTPs/Collection"
  ],
  "ServiceName": "s3",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsS3Bucket",
  "ResourceGroup": "storage",
  "Description": "**Amazon S3 buckets** using **predictable service naming** (e.g., `aws-glue-assets-<account>-<region>`, `sagemaker-<region>-<account>`) are identified and their **ownership** checked.\n\nBuckets tied to your account that match these patterns but are owned by another account-across regions-are surfaced as shadow-resource candidates.",
  "Risk": "**Preclaimed buckets** matching your account's patterns let outsiders intercept service artifacts, causing:\n- Loss of **confidentiality** (templates, data exfiltration)\n- Compromised **integrity** (script/config injection  RCE, privilege escalation)\n- Reduced **availability** (creation failures or redirected writes)",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.techtarget.com/searchsecurity/news/366602412/Researchers-unveil-AWS-vulnerabilities-shadow-resource-vector",
    "https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/#section-10"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\n# CloudFormation: pre-claim the predictable S3 bucket name to ensure your account owns it\nResources:\n  <example_resource_name>:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: <FLAGGED_BUCKET_NAME>  # Critical: create the exact bucket name reported by the check so it is owned by this account\n```",
      "Other": "1. In the Prowler finding, copy the exact bucket name flagged (e.g., aws-glue-assets-<ACCOUNT_ID>-<REGION>).\n2. Open the AWS S3 console and click Create bucket.\n3. Paste the exact bucket name and select the region that matches the name.\n4. Click Create bucket.\n5. Repeat for each flagged name/region so all predictable service buckets are owned by your account.",
      "Terraform": "```hcl\n# Terraform: pre-claim the predictable S3 bucket name to ensure your account owns it\nresource \"aws_s3_bucket\" \"<example_resource_name>\" {\n  bucket = \"<FLAGGED_BUCKET_NAME>\"  # Critical: create the exact bucket name reported by the check so it is owned by this account\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply **defense in depth**:\n- **Preprovision and own** required service buckets in all current and planned regions\n- Enforce **least privilege** so services write only to approved bucket names/ARNs\n- Use **non-guessable names** where you control naming\n- Monitor for look-alike buckets and separate duties for bucket creation vs. use",
      "Url": "https://hub.prowler.com/check/s3_bucket_shadow_resource_vulnerability"
    }
  },
  "Categories": [
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "This check is based on the 'Bucket Monopoly' vulnerability disclosed by Aqua Security."
}
