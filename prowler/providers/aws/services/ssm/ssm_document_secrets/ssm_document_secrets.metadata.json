{
  "Provider": "aws",
  "CheckID": "ssm_document_secrets",
  "CheckTitle": "SSM document contains no secrets",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Sensitive Data Identifications/Security",
    "Effects/Data Exposure"
  ],
  "ServiceName": "ssm",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsSsmPatchCompliance",
  "ResourceGroup": "devops",
  "Description": "**AWS Systems Manager documents** are inspected for embedded **secrets** within their content. Patterns resembling passwords, access keys, tokens, or private keys in document steps are flagged when values appear hardcoded rather than referenced securely.",
  "Risk": "Hardcoded secrets in SSM documents weaken CIA:\n- Confidentiality: readers of the document can exfiltrate credentials.\n- Integrity: stolen keys enable privilege escalation and automation tampering.\n- Availability: abused credentials can disrupt systems and impede recovery.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-secretsmanager-secret-generatesecretstring.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ssm update-document --name <example_resource_name> --content file://<SANITIZED_DOCUMENT_FILE>.json",
      "NativeIaC": "```yaml\nResources:\n  <example_resource_name>:\n    Type: AWS::SSM::Document\n    Properties:\n      DocumentType: Command\n      Content:\n        schemaVersion: '2.2'\n        mainSteps:\n          - action: aws:runShellScript\n            inputs:\n              runCommand:\n                # Critical: reference a SecureString parameter instead of hardcoding a secret\n                # This avoids embedding secrets in the document content\n                - \"export PASSWORD='{{ssm-secure:/path/to/secret}}'\"\n```",
      "Other": "1. In the AWS Console, go to Systems Manager > Parameter Store > Create parameter\n2. Set Name to /path/to/secret, Type to SecureString, enter the secret value, and click Create parameter\n3. Go to Systems Manager > Documents, select the document, then Actions > Edit content\n4. Remove any hardcoded secrets and reference the SecureString parameter, e.g.: {{ssm-secure:/path/to/secret}}\n5. Save to create a new version and set it as Default\n6. Re-run the check to confirm it passes",
      "Terraform": "```hcl\nresource \"aws_ssm_document\" \"<example_resource_name>\" {\n  name          = \"<example_resource_name>\"\n  document_type = \"Command\"\n\n  content = jsonencode({\n    schemaVersion = \"2.2\"\n    mainSteps = [{\n      action = \"aws:runShellScript\"\n      name   = \"run\"\n      inputs = {\n        runCommand = [\n          // Critical: use ssm-secure dynamic reference to avoid hardcoded secrets\n          \"export PASSWORD='{{ssm-secure:/path/to/secret}}'\"\n        ]\n      }\n    }]\n  })\n}\n```"
    },
    "Recommendation": {
      "Text": "Avoid embedding secrets. Store them in **Secrets Manager** or **Parameter Store** as `SecureString` (KMS-encrypted) and reference at runtime.\n\nApply **least privilege** to documents and secrets, prefer **short-lived role credentials**, rotate credentials, continuously scan/audit documents, and enforce **separation of duties** for authoring and approval.",
      "Url": "https://hub.prowler.com/check/ssm_document_secrets"
    }
  },
  "Categories": [
    "secrets"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
