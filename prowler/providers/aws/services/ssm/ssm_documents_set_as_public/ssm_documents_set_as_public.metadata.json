{
  "Provider": "aws",
  "CheckID": "ssm_documents_set_as_public",
  "CheckTitle": "SSM document is not public and shared only with trusted AWS accounts",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Effects/Data Exposure"
  ],
  "ServiceName": "ssm",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsSsmPatchCompliance",
  "ResourceGroup": "devops",
  "Description": "**SSM documents** are evaluated for **public sharing** (`all`) and for shares with AWS accounts outside a defined trusted list. Documents that remain private or are shared only with trusted accounts indicate restricted distribution.",
  "Risk": "Public or non-trusted sharing exposes document content, eroding **confidentiality** of scripts, parameters, and embedded secrets. Adversaries can study runbooks to craft targeted attacks and reuse logic, causing credential leakage and downstream **integrity** and **availability** impacts.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-before-you-share.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ssm modify-document-permission --name <DOCUMENT_NAME> --permission-type Share --account-ids-to-remove all",
      "NativeIaC": "",
      "Other": "1. Open AWS Systems Manager > Documents\n2. Select the document > Permissions tab > Edit\n3. Select Private (remove Public/'all')\n4. Remove any non-trusted AWS account IDs\n5. Save",
      "Terraform": "```hcl\nresource \"aws_ssm_document\" \"<example_resource_name>\" {\n  name          = \"<example_resource_name>\"\n  document_type = \"Command\"\n  content       = jsonencode({\n    schemaVersion = \"2.2\"\n    mainSteps     = []\n  })\n  # Critical: no permissions block -> document remains private (not public/shared)\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply **least privilege** to document distribution:\n- Keep documents private; share only with specific trusted account IDs\n- Enable account-level block public sharing for documents\n- Remove secrets from content; use secure parameters\n- Limit who can share or run documents; require reviews and version control",
      "Url": "https://hub.prowler.com/check/ssm_documents_set_as_public"
    }
  },
  "Categories": [
    "identity-access",
    "internet-exposed"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
