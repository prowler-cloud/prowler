{
  "Provider": "aws",
  "CheckID": "ssm_managed_compliant_patching",
  "CheckTitle": "EC2 managed instance is compliant with Systems Manager patching requirements",
  "CheckType": [
    "Software and Configuration Checks/Patch Management",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices"
  ],
  "ServiceName": "ssm",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsSsmPatchCompliance",
  "ResourceGroup": "devops",
  "Description": "**SSM-managed EC2 instances** report **patch compliance** against defined baselines. This evaluates each managed node's compliance status from Patch Manager to determine whether required security updates are applied according to policy.",
  "Risk": "**Unpatched instances** expose known `CVE` vulnerabilities, enabling **remote code execution**, **privilege escalation**, and **lateral movement**.\n\nThis threatens **confidentiality** (data exfiltration), **integrity** (unauthorized changes), and **availability** (ransomware, crypto-mining, outages).",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/systems-manager/latest/userguide/patch-compliance-identify.html",
    "https://support.icompaas.com/support/solutions/articles/62000233554-ensure-ec2-instances-managed-by-systems-manager-are-compliant-with-patching-requirements",
    "https://docs.aws.amazon.com/systems-manager/latest/userguide/compliance-fixing.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ssm send-command --instance-ids <INSTANCE_ID> --document-name AWS-RunPatchBaseline --parameters Operation=Install",
      "NativeIaC": "```yaml\n# Create an SSM Association to install missing patches on the instance\nResources:\n  <example_resource_name>:\n    Type: AWS::SSM::Association\n    Properties:\n      Name: AWS-RunPatchBaseline\n      InstanceId: <example_resource_id>\n      Parameters:\n        Operation:\n          - Install  # Critical: installs missing patches so the instance becomes COMPLIANT\n```",
      "Other": "1. Open AWS Console > Systems Manager > Run Command\n2. Click Run command\n3. Select document: AWS-RunPatchBaseline\n4. In Parameters, set Operation = Install\n5. In Targets, select the non-compliant instance\n6. Click Run; wait for command to complete and verify Compliance shows COMPLIANT",
      "Terraform": "```hcl\n# Run AWS-RunPatchBaseline to install missing patches on the instance\nresource \"aws_ssm_association\" \"<example_resource_name>\" {\n  name        = \"AWS-RunPatchBaseline\"\n  instance_id = \"<example_resource_id>\"\n  parameters = {\n    Operation = [\"Install\"]  # Critical: installs patches to achieve COMPLIANT status\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Adopt **automated patch management** with Systems Manager: enroll EC2 as managed nodes, define strict **patch baselines**, run frequent **compliance scans**, and **install critical updates** promptly.\n\nApply **defense in depth**: least-privileged roles for patching, staged rollouts, maintenance windows, and centralized compliance reporting with alerting.",
      "Url": "https://hub.prowler.com/check/ssm_managed_compliant_patching"
    }
  },
  "Categories": [
    "vulnerabilities"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
