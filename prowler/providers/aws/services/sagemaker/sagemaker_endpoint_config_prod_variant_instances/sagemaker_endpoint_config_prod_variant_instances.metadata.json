{
  "Provider": "aws",
  "CheckID": "sagemaker_endpoint_config_prod_variant_instances",
  "CheckTitle": "SageMaker endpoint configuration has all production variants with at least two initial instances",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Effects/Denial of Service"
  ],
  "ServiceName": "sagemaker",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "Other",
  "ResourceGroup": "ai_ml",
  "Description": "Amazon SageMaker endpoint configurations are evaluated to ensure each production variant uses an **initial instance count** of at least two. Variants with `InitialInstanceCount` less than two in instance-based endpoints are identified, indicating no built-in multi-AZ redundancy.",
  "Risk": "A **single-instance variant** is a **single point of failure**. If the instance or its Availability Zone fails, inference becomes unavailable, leading to **service outages**, **SLA breaches**, and **cascading failures** in dependent systems. This primarily degrades **availability** and reliability.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/securityhub/latest/userguide/sagemaker-controls.html#sagemaker-4",
    "https://docs.aws.amazon.com/config/latest/developerguide/sagemaker-endpoint-config-prod-instance-count.html",
    "https://docs.aws.amazon.com/sagemaker/latest/dg/serverless-endpoints-create.html#serverless-endpoints-create-config"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws sagemaker delete-endpoint-config --endpoint-config-name <endpoint-config-name>",
      "NativeIaC": "```yaml\n# CloudFormation: EndpointConfig with InitialInstanceCount > 1\nResources:\n  <example_resource_name>:\n    Type: AWS::SageMaker::EndpointConfig\n    Properties:\n      ProductionVariants:\n        - VariantName: <example_resource_name>\n          ModelName: <example_resource_name>\n          InstanceType: ml.m5.large\n          InitialInstanceCount: 2  # Critical: set >=2 so all variants start with at least two instances\n```",
      "Other": "1. In the AWS Console, go to SageMaker > Inference > Endpoint configurations\n2. Click Create endpoint configuration and add each Production variant with Initial instance count set to 2\n3. If any endpoints use the old configuration, go to SageMaker > Inference > Endpoints, select the endpoint, choose Update, and select the new endpoint configuration\n4. Return to Endpoint configurations and delete the noncompliant configuration",
      "Terraform": "```hcl\n# SageMaker Endpoint Configuration with InitialInstanceCount > 1\nresource \"aws_sagemaker_endpoint_configuration\" \"<example_resource_name>\" {\n  production_variants {\n    variant_name           = \"<example_resource_name>\"\n    model_name             = \"<example_resource_name>\"\n    instance_type          = \"ml.m5.large\"\n    initial_instance_count = 2 # Critical: set >=2 so the variant passes the check\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply the **resilience** principle:\n- Run each production variant with `InitialInstanceCount >= 2`\n- Spread capacity across AZs with health-based scaling\n- Use rolling/canary updates to avoid downtime\n- Right-size capacity to tolerate node loss\n\n*For bursty workloads, consider serverless or autoscaling for elasticity.*",
      "Url": "https://hub.prowler.com/check/sagemaker_endpoint_config_prod_variant_instances"
    }
  },
  "Categories": [
    "resilience",
    "gen-ai"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
