{
  "Provider": "aws",
  "CheckID": "sagemaker_models_vpc_settings_configured",
  "CheckTitle": "Amazon SageMaker model has VPC settings enabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Network Reachability",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices"
  ],
  "ServiceName": "sagemaker",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "Other",
  "ResourceGroup": "ai_ml",
  "Description": "**SageMaker models** use **VPC settings** (`VpcConfig` with subnets and security groups) so inference containers communicate through a selected VPC rather than the public internet.\n\nThis evaluates whether a model defines VPC subnets for its network path.",
  "Risk": "Without **VPC isolation**, model traffic and data access can traverse public paths, weakening **confidentiality** and **integrity** through interception or misrouting.\n\nMissing security groups and private endpoints reduce **access control**, enabling excessive egress, data exfiltration, or command-and-control from compromised containers.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/sagemaker/latest/dg/studio-notebooks-and-internet-access.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\nResources:\n  SageMakerModel:\n    Type: AWS::SageMaker::Model\n    Properties:\n      ExecutionRoleArn: \"<example_resource_id>\"\n      PrimaryContainer:\n        Image: \"<example_resource_name>\"\n      # Critical: VpcConfig enables VPC networking for the model so the check passes\n      VpcConfig:\n        SecurityGroupIds:\n          - \"<example_resource_id>\"  # Critical: security group in the VPC\n        Subnets:\n          - \"<example_resource_id>\"  # Critical: at least one subnet in the VPC\n```",
      "Other": "1. Open the AWS Console > Amazon SageMaker > Inference > Models\n2. Open the model and note its container image and execution role\n3. Delete the model (models cannot be updated to add VPC settings)\n4. Click Create model\n5. Enter the same Model name, set the Execution role, and the Container image\n6. Under Network, select a VPC, then choose at least one Subnet and one Security group\n7. Create the model\n8. Verify the model shows VPC settings enabled",
      "Terraform": "```hcl\nresource \"aws_sagemaker_model\" \"model\" {\n  name               = \"<example_resource_name>\"\n  execution_role_arn = \"<example_resource_id>\"\n\n  primary_container {\n    image = \"<example_resource_name>\"\n  }\n\n  # Critical: VPC config enables VPC networking for the model so the check passes\n  vpc_config {\n    subnets            = [\"<example_resource_id>\"]       # Critical\n    security_group_ids = [\"<example_resource_id>\"]       # Critical\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **VPC-only networking** for models by defining `VpcConfig` with private subnets and restrictive security groups.\n\nApply **least privilege egress**, use **VPC endpoints** for S3 and SageMaker runtime, avoid public routes, and implement **defense in depth** with segmentation and traffic monitoring.",
      "Url": "https://hub.prowler.com/check/sagemaker_models_vpc_settings_configured"
    }
  },
  "Categories": [
    "trust-boundaries", 
    "gen-ai"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
