{
  "Provider": "aws",
  "CheckID": "sagemaker_training_jobs_volume_and_output_encryption_enabled",
  "CheckTitle": "Amazon SageMaker training job volume has KMS encryption enabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "Effects/Data Exposure"
  ],
  "ServiceName": "sagemaker",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "Other",
  "ResourceGroup": "ai_ml",
  "Description": "**Amazon SageMaker training jobs** use **KMS encryption** for their attached ML storage volumes via `VolumeKmsKeyId`.\n\nThe finding identifies training jobs where the volume encryption key is not configured.",
  "Risk": "Missing **CMEK** leaves training data, checkpoints, and logs on the volume without tenant-controlled encryption. This reduces **confidentiality**, enables data exposure via snapshots or privileged access, and limits control over key policies, rotation, and emergency revocation.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/sagemaker/latest/dg/key-management.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\n# CloudFormation: SageMaker TrainingJob with EBS volume KMS encryption enabled\nResources:\n  <example_resource_name>:\n    Type: AWS::SageMaker::TrainingJob\n    Properties:\n      TrainingJobName: <example_resource_name>\n      RoleArn: <example_role_arn>\n      AlgorithmSpecification:\n        TrainingImage: <example_ecr_image_uri>\n        TrainingInputMode: File\n      OutputDataConfig:\n        S3OutputPath: s3://<example_bucket>\n      ResourceConfig:\n        InstanceType: ml.m5.large\n        InstanceCount: 1\n        VolumeSizeInGB: 10\n        VolumeKmsKeyId: <example_kms_key_arn>  # CRITICAL: Encrypts the training EBS volume with the specified KMS key\n      StoppingCondition:\n        MaxRuntimeInSeconds: 3600\n```",
      "Other": "1. In the AWS console, go to SageMaker > Training > Training jobs\n2. Select the non-encrypted job and click Clone to create a new job\n3. In Resource configuration, set Volume encryption key to your KMS key (Customer managed key)\n4. Complete required fields and click Create training job\n5. Verify the new job shows the KMS key under Volume encryption",
      "Terraform": "```hcl\n# SageMaker Training Job with EBS volume KMS encryption enabled\nresource \"aws_sagemaker_training_job\" \"<example_resource_name>\" {\n  name     = \"<example_resource_name>\"\n  role_arn = \"<example_role_arn>\"\n\n  algorithm_specification {\n    training_image      = \"<example_ecr_image_uri>\"\n    training_input_mode = \"File\"\n  }\n\n  output_data_config {\n    s3_output_path = \"s3://<example_bucket>\"\n  }\n\n  resource_config {\n    instance_type     = \"ml.m5.large\"\n    instance_count    = 1\n    volume_size_in_gb = 10\n    volume_kms_key_id = \"<example_kms_key_arn>\" # CRITICAL: Enables KMS encryption for the training EBS volume\n  }\n\n  stopping_condition {\n    max_runtime_in_seconds = 3600\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Encrypt training volumes with **customer-managed KMS keys** and apply the same to S3 input/output.\n\nUse **least privilege** on key policies, enable **rotation**, restrict grants, and prevent storage of unencrypted artifacts to achieve **defense in depth**.",
      "Url": "https://hub.prowler.com/check/sagemaker_training_jobs_volume_and_output_encryption_enabled"
    }
  },
  "Categories": [
    "encryption",
    "gen-ai"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
