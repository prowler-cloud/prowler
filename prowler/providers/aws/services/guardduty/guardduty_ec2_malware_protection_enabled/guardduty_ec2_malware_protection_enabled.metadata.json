{
  "Provider": "aws",
  "CheckID": "guardduty_ec2_malware_protection_enabled",
  "CheckTitle": "GuardDuty detector has Malware Protection for EC2 enabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Runtime Behavior Analysis",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices"
  ],
  "ServiceName": "guardduty",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsGuardDutyDetector",
  "ResourceGroup": "security",
  "Description": "**GuardDuty detectors** with **Malware Protection for EC2** enabled perform agentless scans of EBS volumes attached to **EC2 instances** and container workloads. Scans can be triggered by suspicious activity or run on-demand to identify malicious files within restored volume snapshots.",
  "Risk": "Absent this coverage, malware on EC2 or containers can remain **undetected**, enabling:\n- Confidentiality loss via data exfiltration/credential theft\n- Integrity compromise through tampering and backdoors\n- Availability impact from ransomware/cryptominers\n\nPersistence increases **lateral movement** across the environment.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.infoq.com/news/2022/08/aws-guardduty-malware-detection/",
    "https://docs.aws.amazon.com/guardduty/latest/ug/malware-protection.html",
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/aws/GuardDuty/enable-malware-protection-for-ec2.html",
    "https://medium.com/@shashank.kulkarni0708/get-juiced-how-i-hacked-owasp-juice-shop-and-let-guardduty-catch-me-537f7064a1d5",
    "https://docs.aws.amazon.com/guardduty/latest/ug/configure-malware-protection-single-account.html",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/guardduty-controls.html#guardduty-8"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws guardduty update-detector --detector-id <detector-id> --features '[{\"Name\":\"EBS_MALWARE_PROTECTION\",\"Status\":\"ENABLED\"}]'",
      "NativeIaC": "```yaml\n# CloudFormation: enable GuardDuty Malware Protection for EC2\nResources:\n  GuardDutyDetector:\n    Type: AWS::GuardDuty::Detector\n    Properties:\n      Enable: true\n      Features:\n        - Name: EBS_MALWARE_PROTECTION  # Critical: selects EC2 Malware Protection feature\n          Status: ENABLED               # Critical: enables the feature\n```",
      "Other": "1. In the AWS console, open GuardDuty\n2. In the left menu, select Protection plans > Malware Protection for EC2\n3. Click Enable, then Save",
      "Terraform": "```hcl\n# Enable GuardDuty Malware Protection for EC2\nresource \"aws_guardduty_detector\" \"<example_resource_name>\" {\n  enable = true\n\n  features {\n    name   = \"EBS_MALWARE_PROTECTION\"  # Critical: selects EC2 Malware Protection feature\n    status = \"ENABLED\"                  # Critical: enables the feature\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **Malware Protection for EC2** across all accounts and Regions under centralized administration. Apply **least privilege** to findings access, define scan scope with tags and minimize exclusions, and retain snapshots based on data sensitivity. Integrate alerts with IR/SIEM and pair with hardening and vulnerability scanning for **defense in depth**.",
      "Url": "https://hub.prowler.com/check/guardduty_ec2_malware_protection_enabled"
    }
  },
  "Categories": [],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
