{
  "Provider": "aws",
  "CheckID": "rds_cluster_multi_az",
  "CheckTitle": "RDS cluster has Multi-AZ enabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Industry and Regulatory Standards/AWS Foundational Security Best Practices"
  ],
  "ServiceName": "rds",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsRdsDbCluster",
  "ResourceGroup": "database",
  "Description": "**RDS DB clusters** are assessed for deployment across **multiple Availability Zones** (*Multi-AZ*), verifying that redundant instances exist to support **automatic failover** instead of a single-AZ configuration.",
  "Risk": "A **single-AZ cluster** is a single point of failure. AZ outages, instance/storage faults, or maintenance can cause extended **downtime**, failed transactions, and worse **RTO/RPO**. Without cross-AZ replicas, recovery may require restores, increasing outage duration and risking service disruption and data consistency impacts.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/securityhub/latest/userguide/rds-controls.html#rds-15",
    "https://docs.amazonaws.cn/en_us/AmazonRDS/latest/UserGuide/Concepts.MultiAZ.html",
    "https://aws.amazon.com/rds/features/multi-az/"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\n# CloudFormation: create an RDS Multi-AZ DB cluster (non-Aurora)\nResources:\n  <example_resource_name>:\n    Type: AWS::RDS::DBCluster\n    Properties:\n      Engine: mysql  # CRITICAL: using mysql/postgres with the properties below creates a Multi-AZ DB cluster\n      DBClusterInstanceClass: db.r6g.large  # CRITICAL: required to make it a Multi-AZ DB cluster (creates 1 writer + 2 readers across AZs)\n      AllocatedStorage: 100  # CRITICAL: required for Multi-AZ DB clusters\n      Iops: 1000             # CRITICAL: required for Multi-AZ DB clusters\n      StorageType: io1       # CRITICAL: required for Multi-AZ DB clusters\n      MasterUsername: <USERNAME>\n      MasterUserPassword: <PASSWORD>\n```",
      "Other": "1. In the AWS console, go to RDS > Databases > Create database\n2. Engine: select MySQL or PostgreSQL\n3. Under Availability and durability, select Multi-AZ DB cluster\n4. Enter DB cluster identifier and master credentials\n5. Choose a DB instance class and create the database\n6. Migrate data to this new Multi-AZ DB cluster and switch your applications to its endpoint",
      "Terraform": "```hcl\n# Terraform: create an RDS Multi-AZ DB cluster (non-Aurora)\nresource \"aws_rds_cluster\" \"<example_resource_name>\" {\n  cluster_identifier         = \"<example_resource_id>\"\n  engine                     = \"mysql\"           # CRITICAL: mysql/postgres with the lines below creates a Multi-AZ DB cluster\n  db_cluster_instance_class  = \"db.r6g.large\"    # CRITICAL: makes this a Multi-AZ DB cluster (1 writer + 2 readers across AZs)\n  storage_type               = \"io1\"             # CRITICAL: required for Multi-AZ DB clusters\n  allocated_storage          = 100                # CRITICAL: required for Multi-AZ DB clusters\n  iops                       = 1000               # CRITICAL: required for Multi-AZ DB clusters\n  master_username            = \"<USERNAME>\"\n  master_password            = \"<PASSWORD>\"\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **Multi-AZ** for production DB clusters to ensure cross-AZ redundancy and **automatic failover**. Choose a model that meets your SLA (one standby or two readable standbys; Aurora spans 3 AZs). Place subnets in distinct AZs, implement connection retries, and regularly test failover to validate **RTO/RPO** and readiness.",
      "Url": "https://hub.prowler.com/check/rds_cluster_multi_az"
    }
  },
  "Categories": [
    "resilience"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
