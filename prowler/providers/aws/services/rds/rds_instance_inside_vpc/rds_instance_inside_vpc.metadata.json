{
  "Provider": "aws",
  "CheckID": "rds_instance_inside_vpc",
  "CheckTitle": "RDS instance is deployed in a VPC",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Network Reachability",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices"
  ],
  "ServiceName": "rds",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsRdsDbInstance",
  "ResourceGroup": "database",
  "Description": "**RDS DB instances** are assessed for **VPC placement** by the presence of a `vpc_id` indicating deployment within a VPC.\n\nInstances without this association are treated as outside VPC networking.",
  "Risk": "Without VPC isolation, databases may expose internet-reachable endpoints and lack granular network controls. This degrades **confidentiality** and **availability** via scanning/brute force and data exfiltration, and threatens **integrity** through unauthorized connections and lateral movement.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/securityhub/latest/userguide/rds-controls.html#rds-18",
    "https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.DBInstance.Modifying.html",
    "https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_VPC.WorkingWithRDSInstanceinaVPC.html#USER_VPC.Subnets"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws rds modify-db-instance --db-instance-identifier <example_resource_id> --db-subnet-group-name <example_resource_name> --apply-immediately",
      "NativeIaC": "```yaml\n# CloudFormation: move RDS instance into a VPC by assigning a DB subnet group\nResources:\n  <example_db_subnet_group>:\n    Type: AWS::RDS::DBSubnetGroup\n    Properties:\n      DBSubnetGroupDescription: \"subnets for rds\"\n      SubnetIds:\n        - <example_resource_id>  # CRITICAL: Subnets in the target VPC\n        - <example_resource_id>  # CRITICAL: At least two AZs recommended\n\n  <example_db_instance>:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      DBSubnetGroupName: !Ref <example_db_subnet_group>  # CRITICAL: Ensures the DB instance is deployed in a VPC\n```",
      "Other": "1. In the AWS Console, go to RDS > Subnet groups and create/select a DB subnet group in the target VPC (with subnets in at least two AZs)\n2. Go to RDS > Databases, select the DB instance, click Modify\n3. Under Connectivity, set DB subnet group to the VPC subnet group from step 1 (select a VPC security group if prompted)\n4. Check Apply immediately and choose Continue > Modify DB instance",
      "Terraform": "```hcl\n# Terraform: ensure RDS instance is in a VPC via DB subnet group\nresource \"aws_db_subnet_group\" \"<example_resource_name>\" {\n  name       = \"<example_resource_name>\"\n  subnet_ids = [\n    \"<example_resource_id>\", # CRITICAL: Subnets in the target VPC\n    \"<example_resource_id>\"\n  ]\n}\n\nresource \"aws_db_instance\" \"<example_resource_name>\" {\n  identifier          = \"<example_resource_id>\"\n  db_subnet_group_name = aws_db_subnet_group.<example_resource_name>.name  # CRITICAL: Places instance in a VPC\n}\n```"
    },
    "Recommendation": {
      "Text": "Deploy all RDS instances in a **VPC**, preferably in **private subnets**. Enforce **least privilege** with security groups, network ACLs, and restrictive routing. Use private connectivity (peering, VPN, Direct Connect), avoid public exposure, and apply **defense in depth** through segmentation and monitoring.",
      "Url": "https://hub.prowler.com/check/rds_instance_inside_vpc"
    }
  },
  "Categories": [
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
