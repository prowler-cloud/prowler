{
  "Provider": "aws",
  "CheckID": "ec2_instance_uses_single_eni",
  "CheckTitle": "EC2 instance has no more than one Elastic Network Interface (ENI) attached",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Network Reachability"
  ],
  "ServiceName": "ec2",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "low",
  "ResourceType": "AwsEc2Instance",
  "ResourceGroup": "compute",
  "Description": "**EC2 instances** are evaluated for attached network adapters. It identifies instances with more than one `ENI`-including `efa`, `interface`, or `trunk` types-and distinguishes those using a single adapter.",
  "Risk": "**Multiple ENIs** create dual-homed hosts across subnets and security groups, enabling unintended routing and policy bypass. Adversaries can pivot between segments, use alternate egress for **data exfiltration**, or exploit asymmetric paths, undermining segmentation and **confidentiality/integrity** while complicating containment.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html#detach_eni",
    "https://docs.aws.amazon.com/config/latest/developerguide/ec2-instance-multiple-eni-check.html",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/ec2-controls.html#ec2-17"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ec2 detach-network-interface --attachment-id <ATTACHMENT_ID>",
      "NativeIaC": "```yaml\n# CloudFormation: ensure the instance has only one ENI\nResources:\n  <example_resource_name>:\n    Type: AWS::EC2::Instance\n    Properties:\n      ImageId: <example_resource_id>\n      InstanceType: t3.micro\n      SubnetId: <example_resource_id>  # FIX: creates a single primary ENI; do not add extra NetworkInterfaces/attachments\n```",
      "Other": "1. Open the AWS EC2 console and go to Network Interfaces\n2. Filter by the affected instance ID\n3. Select each non-primary network interface (Primary cannot be detached)\n4. Choose Actions > Detach\n5. Confirm the detach for each secondary ENI",
      "Terraform": "```hcl\n# Terraform: instance with only the primary ENI\nresource \"aws_instance\" \"<example_resource_name>\" {\n  ami           = \"<example_resource_id>\"\n  instance_type = \"t3.micro\"\n  subnet_id     = \"<example_resource_id>\"  # FIX: only primary ENI; no additional network_interface attachments\n}\n```"
    },
    "Recommendation": {
      "Text": "Prefer a **single ENI per instance**.\n\nIf multi-homing is unavoidable:\n- Place ENIs in least-privilege subnets/SGs\n- Keep `source/destination check` enabled and routes explicit\n- Use gateways/LBs for NAT or ingress, not the host\n- Monitor flow logs and formally approve exceptions\n\nEmbed **defense in depth** and **zero trust**.",
      "Url": "https://hub.prowler.com/check/ec2_instance_uses_single_eni"
    }
  },
  "Categories": [
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
