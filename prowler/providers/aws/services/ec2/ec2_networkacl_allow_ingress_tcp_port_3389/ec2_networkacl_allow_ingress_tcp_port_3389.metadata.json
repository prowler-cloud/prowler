{
  "Provider": "aws",
  "CheckID": "ec2_networkacl_allow_ingress_tcp_port_3389",
  "CheckTitle": "Network ACL does not allow ingress from the Internet to TCP port 3389 (RDP)",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Network Reachability",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/CIS AWS Foundations Benchmark",
    "TTPs/Initial Access"
  ],
  "ServiceName": "ec2",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsEc2NetworkAcl",
  "ResourceGroup": "network",
  "Description": "**VPC network ACLs** with inbound rules allowing **RDP** on `TCP 3389` from `0.0.0.0/0` are identified.\n\nAssessment focuses on subnet-level ACL entries that permit this traffic.",
  "Risk": "Internet-exposed **RDP** enables **password spraying**, brute force, and exploitation of RDP flaws to gain remote control. Allowing it at the subnet layer weakens **defense in depth**-a misconfigured security group or route can expose instances-leading to data exfiltration, privilege escalation, and ransomware, impacting confidentiality and integrity.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://support.icompaas.com/support/solutions/articles/62000223179-ensure-no-network-acls-allow-ingress-from-0-0-0-0-0-to-microsoft-rdp-port-3389-",
    "https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ec2 delete-network-acl-entry --network-acl-id <NETWORK_ACL_ID> --ingress --rule-number <RULE_NUMBER>",
      "NativeIaC": "```yaml\n# CloudFormation: deny inbound RDP (TCP 3389) from the Internet on an existing NACL\nResources:\n  NetworkAclDenyRDP:\n    Type: AWS::EC2::NetworkAclEntry\n    Properties:\n      NetworkAclId: <example_resource_id>\n      RuleNumber: 1                 # Critical: ensure this deny is evaluated before any allow\n      Protocol: 6                   # TCP\n      Egress: false                 # Ingress rule\n      RuleAction: deny              # Critical: block the traffic\n      CidrBlock: 0.0.0.0/0          # Critical: Internet source\n      PortRange:\n        From: 3389                  # Critical: RDP port\n        To: 3389\n```",
      "Other": "1. In the AWS Console, go to VPC > Network ACLs and select the ACL used by the affected subnet(s)\n2. Open the Inbound rules tab\n3. Find any rule allowing TCP port 3389 (RDP) from 0.0.0.0/0 or ::/0\n4. Select that rule and click Delete, then Save\n5. If you must keep broad allows, instead click Edit inbound rules and add a new rule with a lower rule number that Denies TCP 3389 from 0.0.0.0/0, then Save",
      "Terraform": "```hcl\n# Deny inbound RDP (TCP 3389) from the Internet on an existing NACL\nresource \"aws_network_acl_rule\" \"<example_resource_name>\" {\n  network_acl_id = \"<example_resource_id>\"\n  rule_number    = 1                 # Critical: lower than any allow so deny takes precedence\n  egress         = false             # Ingress rule\n  protocol       = \"tcp\"\n  rule_action    = \"deny\"            # Critical: block the traffic\n  cidr_block     = \"0.0.0.0/0\"       # Critical: Internet source\n  from_port      = 3389              # Critical: RDP port\n  to_port        = 3389\n}\n```"
    },
    "Recommendation": {
      "Text": "Enforce **least privilege**: do not allow `TCP 3389` from `0.0.0.0/0` in network ACLs.\n\n- Restrict RDP to specific admin IP ranges\n- Prefer **bastion hosts** or **Session Manager** over direct RDP\n- Use private subnets and layer controls for **defense in depth**",
      "Url": "https://hub.prowler.com/check/ec2_networkacl_allow_ingress_tcp_port_3389"
    }
  },
  "Categories": [
    "internet-exposed"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
