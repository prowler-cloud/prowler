{
  "Provider": "aws",
  "CheckID": "ec2_instance_port_kerberos_exposed_to_internet",
  "CheckTitle": "EC2 instance does not allow ingress from the Internet to TCP ports 88, 464, 749, or 750 (Kerberos)",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Network Reachability",
    "TTPs/Initial Access/Unauthorized Access"
  ],
  "ServiceName": "ec2",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "critical",
  "ResourceType": "AwsEc2Instance",
  "ResourceGroup": "compute",
  "Description": "**EC2 instances** whose security groups allow public **inbound TCP** access to Kerberos ports `88`, `464`, `749`, or `750` (authentication, password change, admin).\n\nRules permitting `0.0.0.0/0` or `::/0` are treated as Internet-exposed.",
  "Risk": "Public Kerberos exposure risks CIA:\n- **Password spraying**/AS-REP roasting against accounts\n- Unauthorized password changes on `464`\n- Realm/user enumeration and DoS of KDC/services\n\nStolen tickets enable **lateral movement** and privilege escalation in Active Directory or the Kerberos realm.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html",
    "https://support.icompaas.com/support/solutions/articles/62000233825-ensure-no-ec2-instances-allow-ingress-from-the-internet-to-tcp-port-88-464-749-or-750-kerberos-"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ec2 revoke-security-group-ingress --group-id <SECURITY_GROUP_ID> --ip-permissions '[{\"IpProtocol\":\"tcp\",\"FromPort\":88,\"ToPort\":88,\"IpRanges\":[{\"CidrIp\":\"0.0.0.0/0\"}],\"Ipv6Ranges\":[{\"CidrIpv6\":\"::/0\"}]},{\"IpProtocol\":\"tcp\",\"FromPort\":464,\"ToPort\":464,\"IpRanges\":[{\"CidrIp\":\"0.0.0.0/0\"}],\"Ipv6Ranges\":[{\"CidrIpv6\":\"::/0\"}]},{\"IpProtocol\":\"tcp\",\"FromPort\":749,\"ToPort\":749,\"IpRanges\":[{\"CidrIp\":\"0.0.0.0/0\"}],\"Ipv6Ranges\":[{\"CidrIpv6\":\"::/0\"}]},{\"IpProtocol\":\"tcp\",\"FromPort\":750,\"ToPort\":750,\"IpRanges\":[{\"CidrIp\":\"0.0.0.0/0\"}],\"Ipv6Ranges\":[{\"CidrIpv6\":\"::/0\"}]}]'",
      "NativeIaC": "```yaml\n# CloudFormation: restrict Kerberos ports from Internet\nResources:\n  <example_resource_name>:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Restrict Kerberos ports\n      VpcId: <example_resource_id>\n      SecurityGroupIngress:\n        - IpProtocol: tcp\n          FromPort: 88\n          ToPort: 88\n          CidrIp: 10.0.0.0/8  # CRITICAL: not 0.0.0.0/0; restrict access to trusted CIDR\n        - IpProtocol: tcp\n          FromPort: 464\n          ToPort: 464\n          CidrIp: 10.0.0.0/8  # CRITICAL: blocks Internet exposure\n        - IpProtocol: tcp\n          FromPort: 749\n          ToPort: 749\n          CidrIp: 10.0.0.0/8  # CRITICAL: blocks Internet exposure\n        - IpProtocol: tcp\n          FromPort: 750\n          ToPort: 750\n          CidrIp: 10.0.0.0/8  # CRITICAL: blocks Internet exposure\n```",
      "Other": "1. In the AWS console, go to EC2 > Security Groups\n2. Select the security group attached to the affected instance\n3. Edit inbound rules\n4. Remove any rule allowing TCP ports 88, 464, 749, or 750 from 0.0.0.0/0 or ::/0\n5. If access is required, re-add these ports only from trusted CIDR(s) (e.g., your internal network)\n6. Save rules",
      "Terraform": "```hcl\n# Terraform: restrict Kerberos ports from Internet\nresource \"aws_security_group\" \"<example_resource_name>\" {\n  name   = \"<example_resource_name>\"\n  vpc_id = \"<example_resource_id>\"\n\n  ingress {\n    from_port   = 88\n    to_port     = 88\n    protocol    = \"tcp\"\n    cidr_blocks = [\"10.0.0.0/8\"]  # CRITICAL: not 0.0.0.0/0; restrict to trusted CIDR\n  }\n\n  ingress {\n    from_port   = 464\n    to_port     = 464\n    protocol    = \"tcp\"\n    cidr_blocks = [\"10.0.0.0/8\"]  # CRITICAL: blocks Internet exposure\n  }\n\n  ingress {\n    from_port   = 749\n    to_port     = 749\n    protocol    = \"tcp\"\n    cidr_blocks = [\"10.0.0.0/8\"]  # CRITICAL: blocks Internet exposure\n  }\n\n  ingress {\n    from_port   = 750\n    to_port     = 750\n    protocol    = \"tcp\"\n    cidr_blocks = [\"10.0.0.0/8\"]  # CRITICAL: blocks Internet exposure\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Restrict Kerberos ports to trusted sources only.\n- Prefer **private connectivity** (VPN, peering) over public exposure\n- Place KDCs/services in private subnets without public IPs\n- Apply **least privilege** with narrowly scoped security group rules and NACLs\n- Add defense-in-depth: host firewalls and monitor authentication activity",
      "Url": "https://hub.prowler.com/check/ec2_instance_port_kerberos_exposed_to_internet"
    }
  },
  "Categories": [
    "internet-exposed"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
