{
  "Provider": "aws",
  "CheckID": "ec2_transitgateway_auto_accept_vpc_attachments",
  "CheckTitle": "Amazon EC2 Transit Gateway does not automatically accept shared VPC attachments",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Network Reachability",
    "TTPs/Lateral Movement"
  ],
  "ServiceName": "ec2",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsEc2TransitGateway",
  "ResourceGroup": "network",
  "Description": "**EC2 Transit Gateways** with `AutoAcceptSharedAttachments=enable` automatically approve cross-account **VPC attachments**.\n\nThe evaluation identifies transit gateways configured to auto-accept shared attachments.",
  "Risk": "Auto-accepting cross-account attachments can link untrusted VPCs to your routing domain, impacting:\n- **Confidentiality**: unintended visibility and data exfiltration\n- **Integrity**: route injection or traffic tampering\n- **Availability**: misrouting/blackholing and lateral movement",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/config/latest/developerguide/ec2-transit-gateway-auto-vpc-attach-disabled.html",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/ec2-controls.html#ec2-23",
    "https://docs.aws.amazon.com/vpc/latest/tgw/tgw-transit-gateways.html#tgw-modifying"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ec2 modify-transit-gateway --transit-gateway-id <example_resource_id> --options AutoAcceptSharedAttachments=disable",
      "NativeIaC": "```yaml\n# CloudFormation: Disable auto-accept for shared attachments on a Transit Gateway\nResources:\n  <example_resource_name>:\n    Type: AWS::EC2::TransitGateway\n    Properties:\n      Options:\n        AutoAcceptSharedAttachments: disable  # Critical: turns off automatic acceptance of shared VPC attachments\n```",
      "Other": "1. In the AWS Console, go to VPC > Transit Gateways\n2. Select the transit gateway and click Actions > Modify transit gateway\n3. Under Cross-account sharing options, uncheck Auto-accept shared attachments\n4. Click Save changes",
      "Terraform": "```hcl\n# Terraform: Disable auto-accept for shared attachments on a Transit Gateway\nresource \"aws_ec2_transit_gateway\" \"<example_resource_name>\" {\n  auto_accept_shared_attachments = \"disable\"  # Critical: prevents automatic acceptance of cross-account VPC attachments\n}\n```"
    },
    "Recommendation": {
      "Text": "Disable `AutoAcceptSharedAttachments` and require **explicit approval** for every attachment.\n\nApply **least privilege** and **separation of duties** for approvers, limit shares to trusted accounts, and use **defense in depth** with segmentation and logging to audit the attachment lifecycle.",
      "Url": "https://hub.prowler.com/check/ec2_transitgateway_auto_accept_vpc_attachments"
    }
  },
  "Categories": [
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
