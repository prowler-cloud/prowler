{
  "Provider": "aws",
  "CheckID": "ec2_launch_template_no_secrets",
  "CheckTitle": "EC2 launch template user data contains no secrets in any version",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Sensitive Data Identifications/Security",
    "Sensitive Data Identifications/Passwords",
    "Effects/Data Exposure",
    "TTPs/Credential Access"
  ],
  "ServiceName": "ec2",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsEc2LaunchTemplate",
  "ResourceGroup": "compute",
  "Description": "**EC2 launch template** user data is analyzed across versions to identify embedded secrets-hard-coded passwords, tokens, API keys, or private keys-within the startup scripts or configuration supplied to instances.",
  "Risk": "Secrets in user data can be read by identities able to view launch templates, eroding confidentiality.\n\nExposed credentials enable unauthorized API actions, data exfiltration, and lateral movement. Past template versions retain leaked values, complicating rotation and recovery.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html",
    "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-launch-templates.html",
    "https://support.icompaas.com/support/solutions/articles/62000233727-ensure-no-secrets-are-hardcoded-in-ec2-launch-templates"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\n# CloudFormation: Launch Template without user data secrets\nResources:\n  <example_resource_name>:\n    Type: AWS::EC2::LaunchTemplate\n    Properties:\n      LaunchTemplateData:\n        UserData: \"\"  # Critical: empty user data ensures no secrets are stored in any new version\n```",
      "Other": "1. In the AWS Console, go to EC2 > Launch Templates\n2. Select the launch template and click Create new version\n3. In Advanced details, clear the User data field so it is blank\n4. Save and set this clean version as the Default version\n5. Back in the Versions tab, select all versions that contain secrets and click Actions > Delete versions\n6. Ensure only versions with blank (or non-secret) user data remain",
      "Terraform": "```hcl\n# Terraform: Launch Template with empty user data\nresource \"aws_launch_template\" \"<example_resource_name>\" {\n  name      = \"<example_resource_name>\"\n  user_data = \"\"  # Critical: empty user data prevents secrets from being stored\n}\n```"
    },
    "Recommendation": {
      "Text": "Keep user data free of secrets. Retrieve sensitive values at runtime from **AWS Secrets Manager** or **SSM Parameter Store** `SecureString` using instance roles.\n\nEnforce **least privilege**, rotate to short-lived credentials, and review template history; if exposure occurred, rotate affected secrets.",
      "Url": "https://hub.prowler.com/check/ec2_launch_template_no_secrets"
    }
  },
  "Categories": [
    "secrets"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
