{
  "Provider": "aws",
  "CheckID": "appsync_graphql_api_no_api_key_authentication",
  "CheckTitle": "AWS AppSync GraphQL API does not use API key authentication",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "TTPs/Initial Access/Unauthorized Access"
  ],
  "ServiceName": "appsync",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsAppSyncGraphQLApi",
  "Description": "**AWS AppSync GraphQL APIs** are examined for the default authorization type. The finding indicates an API configured with `API_KEY` instead of IAM, Cognito, OIDC, or Lambda authorizers.",
  "Risk": "Static **API keys** can be leaked or reused, enabling unauthorized queries and mutations.\n- **Confidentiality**: unrestricted data reads\n- **Integrity**: unauthorized writes and schema misuse\n- **Accountability**: no user identity for auditing, difficult revocation and scoping",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://aws.amazon.com/blogs/mobile/graphql-security-appsync-amplify/",
    "https://docs.aws.amazon.com/appsync/latest/devguide/security-authz.html",
    "https://support.icompaas.com/support/solutions/articles/62000233666-ensure-aws-appsync-graphql-apis-should-not-be-authenticated-with-api-keys",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/appsync-controls.html#appsync-5"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws appsync update-graphql-api --api-id <api-id> --name <api-name> --authentication-type AWS_IAM",
      "NativeIaC": "```yaml\n# CloudFormation: set default auth to non-API key\nResources:\n  <example_resource_name>:\n    Type: AWS::AppSync::GraphQLApi\n    Properties:\n      Name: <example_resource_name>\n      AuthenticationType: AWS_IAM  # Critical: switches default auth away from API_KEY\n```",
      "Other": "1. In the AWS Console, go to AppSync > APIs and select your GraphQL API\n2. Open Settings (Authorization)\n3. Change Default authorization mode to AWS IAM (or Cognito/OIDC/Lambda)\n4. Click Save",
      "Terraform": "```hcl\n# AppSync GraphQL API with non-API key auth\nresource \"aws_appsync_graphql_api\" \"<example_resource_name>\" {\n  name                = \"<example_resource_name>\"\n  authentication_type = \"AWS_IAM\"  # Critical: avoids API_KEY default auth\n}\n```"
    },
    "Recommendation": {
      "Text": "Replace `API_KEY` with stronger modes and apply least privilege:\n- **AWS_IAM** for service-to-service\n- **Cognito User Pools** or **OIDC** for end users\n- **Lambda authorizer** for custom logic\n*If guest access is unavoidable*, limit to read-only fields, enforce throttling, use short key lifetimes, and apply schema-level authorization.",
      "Url": "https://hub.prowler.com/check/appsync_graphql_api_no_api_key_authentication"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
