{
  "Provider": "aws",
  "CheckID": "vpc_endpoint_multi_az_enabled",
  "CheckTitle": "Amazon VPC interface endpoint has subnets in multiple Availability Zones",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices"
  ],
  "ServiceName": "vpc",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsEc2VpcEndpointService",
  "ResourceGroup": "network",
  "Description": "**VPC interface endpoints** are evaluated for whether their endpoint network interfaces are placed in **multiple subnets**, which implies distribution across different **Availability Zones**. Endpoints present in only one subnet are identified.",
  "Risk": "A **single-subnet endpoint** creates a **single-AZ dependency**. An AZ outage or routing issue can cut access to the service, reducing **availability**. Workloads may revert to **public endpoints**, exposing traffic to the Internet and risking **confidentiality** through interception or tampering.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/vpc/latest/privatelink/interface-endpoints.html",
    "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/interface-vpc-endpoints.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ec2 modify-vpc-endpoint --vpc-endpoint-id <example_resource_id> --add-subnet-ids <example_subnet_id_2>",
      "NativeIaC": "```yaml\nResources:\n  <example_resource_name>:\n    Type: AWS::EC2::VPCEndpoint\n    Properties:\n      VpcEndpointType: Interface\n      VpcId: <example_resource_id>\n      ServiceName: com.amazonaws.<region>.<service>\n      SubnetIds:  # CRITICAL: include at least two subnets (preferably in different AZs) to pass the check\n        - <example_subnet_id_1>\n        - <example_subnet_id_2>\n```",
      "Other": "1. Open the AWS VPC console and go to Endpoints\n2. Select the interface endpoint\n3. Click Actions > Manage subnets\n4. Select an additional subnet in a different Availability Zone\n5. Click Modify subnets to save",
      "Terraform": "```hcl\nresource \"aws_vpc_endpoint\" \"<example_resource_name>\" {\n  vpc_id            = \"<example_resource_id>\"\n  service_name      = \"com.amazonaws.<region>.<service>\"\n  vpc_endpoint_type = \"Interface\"\n\n  subnet_ids = [\n    \"<example_subnet_id_1>\",\n    \"<example_subnet_id_2>\"  # CRITICAL: add a second subnet (ideally in a different AZ) to satisfy multi-AZ\n  ]\n}\n```"
    },
    "Recommendation": {
      "Text": "Place interface endpoints in **multiple subnets across distinct AZs** to remove single-AZ reliance. Prefer zone-local routing so clients use the nearest endpoint, and combine with **private DNS** and restrictive **security groups** to limit exposure-supporting **defense in depth** and resilient connectivity.",
      "Url": "https://hub.prowler.com/check/vpc_endpoint_multi_az_enabled"
    }
  },
  "Categories": [
    "resilience"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
