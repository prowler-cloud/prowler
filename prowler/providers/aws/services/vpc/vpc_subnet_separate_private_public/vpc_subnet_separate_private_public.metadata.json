{
  "Provider": "aws",
  "CheckID": "vpc_subnet_separate_private_public",
  "CheckTitle": "VPC has both public and private subnets",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Network Reachability"
  ],
  "ServiceName": "vpc",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsEc2Subnet",
  "ResourceGroup": "network",
  "Description": "**Amazon VPCs** are assessed for network segmentation: at least one **public subnet** (internet-routable) and one **private subnet** (non-internet-routable).\n\nIt flags VPCs with no subnets, only public subnets, or only private subnets.",
  "Risk": "Missing subnet separation erodes **segmentation**.\n- Only public: workloads face Internet exposure, enabling scanning, brute force, and lateral movement, threatening **confidentiality** and **integrity**.\n- Only private: no controlled egress can break patching and dependencies, impacting **availability**.\n- No subnets: misconfiguration leaves services unreachable.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Scenario2.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\n# CloudFormation: add one public and one private subnet to a VPC\nResources:\n  InternetGateway:\n    Type: AWS::EC2::InternetGateway\n\n  VPCGatewayAttachment:\n    Type: AWS::EC2::VPCGatewayAttachment\n    Properties:\n      VpcId: <example_resource_id>\n      InternetGatewayId: !Ref InternetGateway\n\n  PublicSubnet:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: <example_resource_id>\n      CidrBlock: 10.0.1.0/24  # creates a subnet to be made public via route\n\n  PrivateSubnet:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: <example_resource_id>\n      CidrBlock: 10.0.2.0/24  # creates a subnet that remains private (no IGW route)\n\n  PublicRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: <example_resource_id>\n\n  PublicDefaultRoute:\n    Type: AWS::EC2::Route\n    DependsOn: VPCGatewayAttachment\n    Properties:\n      RouteTableId: !Ref PublicRouteTable\n      DestinationCidrBlock: 0.0.0.0/0  # CRITICAL: makes routes to the Internet\n      GatewayId: !Ref InternetGateway    # CRITICAL: via Internet Gateway\n\n  PublicAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PublicSubnet\n      RouteTableId: !Ref PublicRouteTable  # CRITICAL: marks this subnet as public\n\n  PrivateRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: <example_resource_id>\n\n  PrivateAssociation:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      SubnetId: !Ref PrivateSubnet\n      RouteTableId: !Ref PrivateRouteTable  # CRITICAL: no IGW route -> private subnet\n```",
      "Other": "1. In the AWS console, go to VPC > Your VPCs and select the failing VPC\n2. Attach an Internet Gateway if none exists: Internet Gateways > Create > Attach to the VPC\n3. Create two subnets: Subnets > Create subnet\n   - Subnet A (public): CIDR e.g., 10.0.1.0/24\n   - Subnet B (private): CIDR e.g., 10.0.2.0/24\n4. Create a route table for public subnet: Route tables > Create\n   - Add route: 0.0.0.0/0 -> Internet Gateway (IGW)\n   - Associate this route table to Subnet A (public)\n5. Create a route table for private subnet: Route tables > Create\n   - Do not add a route to an Internet Gateway\n   - Associate this route table to Subnet B (private)\n6. Verify the VPC now has at least one subnet with an IGW route (public) and one without (private)",
      "Terraform": "```hcl\n# Terraform: add one public and one private subnet to a VPC\nresource \"aws_internet_gateway\" \"<example_resource_name>\" {\n  vpc_id = \"<example_resource_id>\"\n}\n\nresource \"aws_subnet\" \"public_<example_resource_name>\" {\n  vpc_id     = \"<example_resource_id>\"\n  cidr_block = \"10.0.1.0/24\"\n}\n\nresource \"aws_subnet\" \"private_<example_resource_name>\" {\n  vpc_id     = \"<example_resource_id>\"\n  cidr_block = \"10.0.2.0/24\"\n}\n\nresource \"aws_route_table\" \"public_<example_resource_name>\" {\n  vpc_id = \"<example_resource_id>\"\n  route {                         # CRITICAL: makes subnet public via IGW\n    cidr_block = \"0.0.0.0/0\"      # default route to Internet\n    gateway_id = aws_internet_gateway.<example_resource_name>.id\n  }\n}\n\nresource \"aws_route_table_association\" \"public_assoc_<example_resource_name>\" {\n  subnet_id      = aws_subnet.public_<example_resource_name>.id\n  route_table_id = aws_route_table.public_<example_resource_name>.id  # CRITICAL\n}\n\nresource \"aws_route_table\" \"private_<example_resource_name>\" {\n  vpc_id = \"<example_resource_id>\"  # CRITICAL: no IGW route keeps subnet private\n}\n\nresource \"aws_route_table_association\" \"private_assoc_<example_resource_name>\" {\n  subnet_id      = aws_subnet.private_<example_resource_name>.id\n  route_table_id = aws_route_table.private_<example_resource_name>.id  # CRITICAL\n}\n```"
    },
    "Recommendation": {
      "Text": "Segment each VPC: put internet-facing endpoints in **public subnets** and internal workloads in **private subnets**. Restrict ingress/egress with tight route tables, NACLs, and security groups, minimizing `0.0.0.0/0`. Apply **least privilege** and **defense in depth**. Provide controlled outbound for private subnets via managed egress and use hardened admin access patterns.",
      "Url": "https://hub.prowler.com/check/vpc_subnet_separate_private_public"
    }
  },
  "Categories": [
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
