{
  "Provider": "aws",
  "CheckID": "vpc_endpoint_for_ec2_enabled",
  "CheckTitle": "VPC has an Amazon EC2 VPC endpoint",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Network Reachability"
  ],
  "ServiceName": "vpc",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsEc2VpcEndpointService",
  "ResourceGroup": "network",
  "Description": "**Amazon VPCs** are evaluated for an **interface VPC endpoint** to the **Amazon EC2 API** (`ec2`). Its presence indicates private EC2 API connectivity over **AWS PrivateLink** within the VPC.",
  "Risk": "Without a private EC2 endpoint, EC2 API traffic exits via IGW/NAT. This expands exposure to network path threats (e.g., DNS hijack, MITM) and weakens egress isolation. It also adds an internet egress dependency for API access, reducing availability if NAT/edge paths fail.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/config/latest/developerguide/service-vpc-endpoint-enabled.html",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/ec2-controls.html#ec2-10",
    "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/interface-vpc-endpoints.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ec2 create-vpc-endpoint --vpc-id <VPC_ID> --service-name com.amazonaws.<REGION>.ec2 --vpc-endpoint-type Interface --subnet-ids <SUBNET_ID>",
      "NativeIaC": "```yaml\n# CloudFormation: create an EC2 interface VPC endpoint in the VPC\nResources:\n  VPCEndpoint:\n    Type: AWS::EC2::VPCEndpoint\n    Properties:\n      VpcId: \"<example_resource_id>\"                 # CRITICAL: target VPC for the endpoint\n      ServiceName: !Sub \"com.amazonaws.${AWS::Region}.ec2\"  # CRITICAL: EC2 interface endpoint service\n      VpcEndpointType: Interface                      # CRITICAL: create an interface endpoint\n      SubnetIds:                                      # CRITICAL: subnets to place the endpoint ENIs\n        - \"<example_resource_id>\"\n```",
      "Other": "1. In the AWS console, go to VPC > Endpoints\n2. Click Create endpoint\n3. For Service category, choose AWS services and select Service name com.amazonaws.<region>.ec2\n4. Select your VPC and at least one subnet\n5. Click Create endpoint",
      "Terraform": "```hcl\n# Create an EC2 interface VPC endpoint\nresource \"aws_vpc_endpoint\" \"<example_resource_name>\" {\n  vpc_id            = \"<example_resource_id>\"           # CRITICAL: target VPC\n  service_name      = \"com.amazonaws.<region>.ec2\"      # CRITICAL: EC2 interface endpoint service\n  vpc_endpoint_type = \"Interface\"                       # CRITICAL: interface endpoint\n  subnet_ids        = [\"<example_resource_id>\"]         # CRITICAL: subnet(s) for endpoint ENIs\n}\n```"
    },
    "Recommendation": {
      "Text": "Use an **interface VPC endpoint** for the EC2 service in each VPC that requires EC2 API access.\n- Enable **private DNS** to keep calls on the AWS network\n- Apply restrictive endpoint policies (least privilege)\n- Reduce reliance on public egress and layer controls for **defense in depth**",
      "Url": "https://hub.prowler.com/check/vpc_endpoint_for_ec2_enabled"
    }
  },
  "Categories": [
    "internet-exposed",
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
