{
  "Provider": "aws",
  "CheckID": "athena_workgroup_logging_enabled",
  "CheckTitle": "Amazon Athena workgroup has CloudWatch logging enabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "TTPs/Defense Evasion"
  ],
  "ServiceName": "athena",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsAthenaWorkGroup",
  "ResourceGroup": "analytics",
  "Description": "**Athena workgroups** publish **query metrics** to CloudWatch. This evaluation determines whether each workgroup has query activity logging enabled in CloudWatch.",
  "Risk": "Without CloudWatch query logging, risky or anomalous queries go unobserved, weakening **confidentiality** and **integrity**. Compromised or insider accounts can exfiltrate data and alter datasets without timely detection, hampering forensics and containment.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/athena/latest/ug/security-logging-monitoring.html",
    "https://docs.aws.amazon.com/athena/latest/ug/athena-cloudwatch-metrics-enable.html",
    "https://stackoverflow.com/questions/68896809/how-to-save-queries-executed-by-athena-in-logsgroup-cloudwatch",
    "https://support.icompaas.com/support/solutions/articles/62000233405-ensure-that-logging-is-enabled-for-amazon-athena-workgroups-to-capture-query-activity-",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/athena-controls.html#athena-4"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws athena update-work-group --work-group <WORKGROUP_NAME> --configuration-updates PublishCloudWatchMetricsEnabled=true",
      "NativeIaC": "```yaml\n# CloudFormation to enable CloudWatch logging for an Athena workgroup\nResources:\n  AthenaWorkGroup:\n    Type: AWS::Athena::WorkGroup\n    Properties:\n      Name: <example_resource_name>\n      WorkGroupConfiguration:\n        PublishCloudWatchMetricsEnabled: true  # Critical: Enables CloudWatch logging for the workgroup\n```",
      "Other": "1. Open the AWS Management Console and go to Amazon Athena\n2. In the left pane, click Workgroups and select the target workgroup\n3. Click Edit\n4. Check Publish query metrics to AWS CloudWatch\n5. Click Save",
      "Terraform": "```hcl\n# Enable CloudWatch logging for an Athena workgroup\nresource \"aws_athena_workgroup\" \"example\" {\n  name = \"<example_resource_name>\"\n\n  configuration {\n    publish_cloudwatch_metrics_enabled = true  # Critical: Enables CloudWatch logging\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable and enforce **CloudWatch query logging** for all workgroups (`PublishCloudWatchMetricsEnabled`).\n- Apply least privilege to logs and encrypt at rest\n- Set retention and anomaly alerts\n- Correlate with **CloudTrail** for user attribution\n- Centralize logs to a monitoring account",
      "Url": "https://hub.prowler.com/check/athena_workgroup_logging_enabled"
    }
  },
  "Categories": [
    "logging"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
