{
  "Provider": "aws",
  "CheckID": "iam_policy_no_full_access_to_kms",
  "CheckTitle": "Custom IAM policy does not allow 'kms:*' privileges",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/CIS AWS Foundations Benchmark",
    "Effects/Data Exposure",
    "Effects/Data Destruction",
    "TTPs/Privilege Escalation"
  ],
  "ServiceName": "iam",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsIamPolicy",
  "ResourceGroup": "IAM",
  "Description": "**Customer-managed IAM policies** are examined for statements that grant **AWS KMS** full access using `kms:*`. The focus is on policies allowing service-wide actions rather than narrowly scoped, key-specific permissions.",
  "Risk": "Allowing `kms:*` lets principals decrypt data, change key policies, and disable or delete keys. Impact: **Confidentiality**-unauthorized decryption; **Integrity**-manipulation of cryptographic controls; **Availability**-data unreadable if keys are disabled/deleted. It can also enable privilege escalation.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "http://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html",
    "https://docs.aws.amazon.com/it_it/prescriptive-guidance/latest/encryption-best-practices/kms.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws iam create-policy-version --policy-arn <POLICY_ARN> --policy-document '{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"kms:Encrypt\"],\"Resource\":\"arn:aws:kms:<REGION>:<ACCOUNT_ID>:key/<KEY_ID>\"}]}' --set-as-default",
      "NativeIaC": "```yaml\n# CloudFormation: customer managed policy without kms:* full access\nResources:\n  <example_resource_name>:\n    Type: AWS::IAM::ManagedPolicy\n    Properties:\n      PolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Action:\n              - kms:Encrypt  # FIX: remove 'kms:*'; allow only specific KMS action\n            Resource: arn:aws:kms:<REGION>:<ACCOUNT_ID>:key/<example_resource_id>  # FIX: scope to a specific key\n```",
      "Other": "1. In the AWS Console, open IAM > Policies\n2. Find the custom policy that allows kms:* and choose Edit policy > JSON\n3. Replace any \"Action\": \"kms:*\" (or [\"kms:*\"]) with only required actions (e.g., [\"kms:Encrypt\"]) and, if possible, set \"Resource\" to a specific key ARN\n4. Save changes (a new default policy version is created)\n5. Re-run the check to confirm it passes",
      "Terraform": "```hcl\n# Customer managed policy without kms:* full access\nresource \"aws_iam_policy\" \"<example_resource_name>\" {\n  name   = \"<example_resource_name>\"\n  policy = jsonencode({\n    Version   = \"2012-10-17\"\n    Statement = [{\n      Effect   = \"Allow\"\n      Action   = [\"kms:Encrypt\"]  # FIX: remove 'kms:*'; allow only specific KMS action\n      Resource = \"arn:aws:kms:<REGION>:<ACCOUNT_ID>:key/<example_resource_id>\"  # FIX: scope to a specific key\n    }]\n  })\n}\n```"
    },
    "Recommendation": {
      "Text": "Adopt **least privilege** and **separation of duties**:\n- Replace `kms:*` with only needed actions scoped to specific key ARNs\n- Apply policy conditions (e.g., `kms:ViaService`) and guardrails (permissions boundaries/SCPs)\n- Monitor KMS usage and refine access based on activity",
      "Url": "https://hub.prowler.com/check/iam_policy_no_full_access_to_kms"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
