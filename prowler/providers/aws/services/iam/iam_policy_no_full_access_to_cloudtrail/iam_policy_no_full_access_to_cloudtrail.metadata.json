{
  "Provider": "aws",
  "CheckID": "iam_policy_no_full_access_to_cloudtrail",
  "CheckTitle": "Customer managed IAM policy does not allow cloudtrail:* privileges",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/CIS AWS Foundations Benchmark",
    "TTPs/Defense Evasion"
  ],
  "ServiceName": "iam",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsIamPolicy",
  "ResourceGroup": "IAM",
  "Description": "Custom IAM policies are reviewed for statements that grant **full CloudTrail access** via the `cloudtrail:*` wildcard, indicating unrestricted permission to all CloudTrail actions.",
  "Risk": "Unrestricted CloudTrail control lets principals stop or alter logging, delete or modify trails, and query events.\n\nThis enables log evasion, audit tampering, and reconnaissance, undermining the **integrity**, **availability**, and **confidentiality** of audit evidence and detection.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "http://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html",
    "https://support.icompaas.com/support/solutions/articles/62000233808-ensure-iam-policies-that-allow-full-cloudtrail-privileges-are-not-created"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws iam create-policy-version --policy-arn <example_policy_arn> --policy-document '{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":\"cloudtrail:DescribeTrails\",\"Resource\":\"*\"}]}' --set-as-default",
      "NativeIaC": "```yaml\n# CloudFormation managed policy without CloudTrail wildcard access\nResources:\n  <example_resource_name>:\n    Type: AWS::IAM::ManagedPolicy\n    Properties:\n      PolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Action: cloudtrail:DescribeTrails  # Critical: replaces 'cloudtrail:*' with a specific action to remove full access\n            Resource: \"*\"\n```",
      "Other": "1. In the AWS Console, go to IAM > Policies\n2. Open the custom managed policy that contains Action: \"cloudtrail:*\"\n3. Click Edit JSON\n4. Replace \"cloudtrail:*\" with only the specific CloudTrail actions needed (e.g., \"cloudtrail:DescribeTrails\" or \"cloudtrail:LookupEvents\"), or remove CloudTrail actions entirely\n5. Save changes to create/set the new default policy version\n6. Verify the policy no longer contains \"cloudtrail:*\"",
      "Terraform": "```hcl\n# IAM policy without CloudTrail wildcard access\nresource \"aws_iam_policy\" \"<example_resource_name>\" {\n  name   = \"<example_resource_name>\"\n  policy = jsonencode({\n    Version   = \"2012-10-17\"\n    Statement = [{\n      Effect   = \"Allow\"\n      Action   = \"cloudtrail:DescribeTrails\" # Critical: replaces 'cloudtrail:*' with a specific action, removing full access\n      Resource = \"*\"\n    }]\n  })\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply **least privilege**: avoid `cloudtrail:*` and allow only required actions.\n\nEnforce **separation of duties** for trail management. Use **permissions boundaries** or **SCPs** to block broad CloudTrail access, and validate policies regularly to refine scopes.",
      "Url": "https://hub.prowler.com/check/iam_policy_no_full_access_to_cloudtrail"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
