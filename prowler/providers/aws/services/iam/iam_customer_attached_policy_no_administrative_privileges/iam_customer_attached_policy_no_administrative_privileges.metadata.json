{
  "Provider": "aws",
  "CheckID": "iam_customer_attached_policy_no_administrative_privileges",
  "CheckTitle": "Attached IAM customer-managed policy does not allow '*:*' administrative privileges",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/CIS AWS Foundations Benchmark",
    "TTPs/Privilege Escalation"
  ],
  "ServiceName": "iam",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsIamPolicy",
  "ResourceGroup": "IAM",
  "Description": "Attached **customer-managed IAM policies** are evaluated for statements granting full admin access via `Action: \"*\"`, `Resource: \"*\"`, i.e., `*:*`. Only policies you created and attached to identities are considered.",
  "Risk": "**Unrestricted admin access** lets any attached principal perform any action on any resource, enabling data exfiltration, policy tampering, credential creation, logging disablement, and destructive deletions-compromising **confidentiality, integrity, and availability** across the account.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/aws/IAM/iam-policy-for-administration.html",
    "http://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws iam create-policy-version --policy-arn <EXAMPLE_POLICY_ARN> --policy-document '{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":\"iam:GetUser\",\"Resource\":\"*\"}]}' --set-as-default",
      "NativeIaC": "```yaml\n# CloudFormation: Replace admin '*' access with a specific action\nResources:\n  <example_resource_name>:\n    Type: AWS::IAM::ManagedPolicy\n    Properties:\n      PolicyDocument:\n        Version: \"2012-10-17\"\n        Statement:\n          - Effect: Allow\n            Action: iam:GetUser  # CRITICAL: removes '*:*' by allowing only a specific action\n            Resource: \"*\"        # CRITICAL: no full admin since Action is not '*'\n```",
      "Other": "1. In the AWS Console, go to IAM > Policies and open the customer managed policy from the finding\n2. Select the Policy versions tab and click Create version\n3. Replace the JSON with:\n   {\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":\"iam:GetUser\",\"Resource\":\"*\"}]}\n4. Check Set as default version and click Create version\n5. Confirm the policy no longer contains an Allow with Action \"*\" (or \"*:*\") over Resource \"*\"",
      "Terraform": "```hcl\n# Terraform: Managed policy without '*:*' admin privileges\nresource \"aws_iam_policy\" \"<example_resource_name>\" {\n  name   = \"<example_resource_name>\"\n  policy = jsonencode({\n    Version   = \"2012-10-17\"\n    Statement = [{\n      Effect   = \"Allow\"\n      Action   = \"iam:GetUser\"  # CRITICAL: not \"*\" or \"*:*\"; removes admin privileges\n      Resource = \"*\"             # CRITICAL: paired with specific action to avoid full admin\n    }]\n  })\n}\n```"
    },
    "Recommendation": {
      "Text": "Enforce **least privilege**: replace wildcards with specific actions, scope `Resource` to needed ARNs, and add restrictive `Condition`s. Prefer role-based access and separation of duties. Use **permissions boundaries** and organization guardrails, and regularly review policies with policy validation and Access Analyzer.",
      "Url": "https://hub.prowler.com/check/iam_customer_attached_policy_no_administrative_privileges"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "CAF Security Epic: IAM"
}
