{
  "Provider": "aws",
  "CheckID": "iam_inline_policy_no_full_access_to_cloudtrail",
  "CheckTitle": "Inline IAM policy does not allow 'cloudtrail:*' privileges",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/CIS AWS Foundations Benchmark",
    "TTPs/Defense Evasion"
  ],
  "ServiceName": "iam",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsIamPolicy",
  "ResourceGroup": "IAM",
  "Description": "**IAM inline policies** are evaluated for statements that grant **full CloudTrail permissions** (`cloudtrail:*`) to all resources.\n\nThe finding flags identity policies that provide unrestricted control over CloudTrail operations.",
  "Risk": "Full CloudTrail access allows stopping trails, modifying configurations, or deleting audit data, compromising log **integrity** and **availability**. It also exposes event data, impacting **confidentiality**. Adversaries could hide activity, evade detection, and obstruct investigations.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "http://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html",
    "https://support.icompaas.com/support/solutions/articles/62000233808-ensure-iam-policies-that-allow-full-cloudtrail-privileges-are-not-created"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\n# CloudFormation: restrict CloudTrail permissions in inline policy\nResources:\n  <example_resource_name>InlinePolicy:\n    Type: AWS::IAM::Policy\n    Properties:\n      PolicyName: <example_resource_name>-policy\n      PolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Action:\n              - cloudtrail:DescribeTrails  # Critical: use specific action(s) instead of 'cloudtrail:*' to avoid full service access\n            Resource: \"*\"\n      Roles:\n        - <example_resource_name>\n```",
      "Other": "1. Open the IAM console and go to Users, Roles, or Groups\n2. Select the entity with the failing inline policy\n3. In Permissions, expand Inline policies and open the policy\n4. Click Edit policy and switch to the JSON editor\n5. Replace any \"Action\": \"cloudtrail:*\" with only required CloudTrail actions (e.g., \"cloudtrail:DescribeTrails\"), or remove that statement if not needed\n6. Save changes",
      "Terraform": "```hcl\nresource \"aws_iam_role_policy\" \"<example_resource_name>\" {\n  name = \"<example_resource_name>-policy\"\n  role = \"<example_resource_name>\"\n\n  policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [{\n      Effect   = \"Allow\"\n      Action   = [\"cloudtrail:DescribeTrails\"] # Critical: replace 'cloudtrail:*' with specific action(s) to remove full service access\n      Resource = \"*\"\n    }]\n  })\n}\n```"
    },
    "Recommendation": {
      "Text": "Enforce **least privilege** and **separation of duties**: avoid `cloudtrail:*`; grant only specific actions needed (prefer read-only where possible). Add guardrails or boundaries to block destructive actions. Use managed, centrally governed policies and periodically right-size permissions based on usage.",
      "Url": "https://hub.prowler.com/check/iam_inline_policy_no_full_access_to_cloudtrail"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
