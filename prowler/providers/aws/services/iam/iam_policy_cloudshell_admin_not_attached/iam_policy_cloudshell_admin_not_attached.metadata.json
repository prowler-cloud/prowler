{
  "Provider": "aws",
  "CheckID": "iam_policy_cloudshell_admin_not_attached",
  "CheckTitle": "No IAM users, groups, or roles have the AWSCloudShellFullAccess policy attached",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices"
  ],
  "ServiceName": "iam",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsIamPolicy",
  "ResourceGroup": "IAM",
  "Description": "**IAM identities** with the AWS managed policy `AWSCloudShellFullAccess` attached are identified across users, groups, and roles.\n\nThis indicates principals are granted `cloudshell:*` on `*`, enabling full CloudShell features, including environment startup and file transfer.",
  "Risk": "Granting `cloudshell:*` enables an interactive shell with Internet egress and file upload/download, degrading **confidentiality** and **integrity**.\n\nCompromised principals can exfiltrate data, stage tooling with sudo, persist artifacts in CloudShell, and operate from AWS IP space to bypass endpoint controls.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/securityhub/latest/userguide/iam-controls.html#iam-27",
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/aws/IAM/unapproved-iam-policy-in-use.html",
    "https://docs.aws.amazon.com/config/latest/developerguide/iam-policy-blacklisted-check.html",
    "https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-attach-detach.html",
    "https://icompaas.freshdesk.com/support/solutions/articles/62000233099-1-22-restrict-access-to-awscloudshellfullaccess-manual-"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\n# CloudFormation: ensure AWSCloudShellFullAccess is NOT attached to the IAM user\nResources:\n  <example_resource_name>:\n    Type: AWS::IAM::User\n    Properties:\n      ManagedPolicyArns: []  # Critical: empty list ensures AWSCloudShellFullAccess is not attached\n```",
      "Other": "1. In the AWS console, go to IAM > Policies\n2. Search for AWSCloudShellFullAccess and open it\n3. Select the Entities attached tab\n4. Select all Users, Groups, and Roles listed\n5. Click Detach and confirm",
      "Terraform": "```hcl\n# Terraform: ensure AWSCloudShellFullAccess is NOT attached\nresource \"aws_iam_user_policy_attachment\" \"<example_resource_name>\" {\n  count      = 0  # Critical: prevents creation, ensuring the policy is detached/not attached\n  user       = \"<example_resource_name>\"\n  policy_arn = \"arn:aws:iam::aws:policy/AWSCloudShellFullAccess\"  # Denied policy\n}\n```"
    },
    "Recommendation": {
      "Text": "Detach `AWSCloudShellFullAccess` from identities.\n\nApply **least privilege**: permit CloudShell only when necessary via narrowly scoped permissions, restricted roles, short-lived sessions, and approvals. Prefer controlled alternatives (local CLI, bastion, or Session Manager). Enforce **separation of duties** and monitor usage.",
      "Url": "https://hub.prowler.com/check/iam_policy_cloudshell_admin_not_attached"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
