{
  "Provider": "aws",
  "CheckID": "iam_user_with_temporary_credentials",
  "CheckTitle": "IAM user does not use long-lived credentials to access services other than IAM or STS",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices/Runtime Behavior Analysis",
    "Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "TTPs/Credential Access"
  ],
  "ServiceName": "iam",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsIamUser",
  "ResourceGroup": "IAM",
  "Description": "IAM users are assessed for activity using **long-lived access keys**. Use of static credentials to access services other than IAM or STS indicates reliance on permanent keys instead of **temporary role-based credentials**.",
  "Risk": "Persistent access keys enable attacker **persistence** and replay. Stolen keys allow off-network API calls for data exfiltration, privilege changes, and destructive actions, impacting **confidentiality**, **integrity**, and **availability**. Without expiry, the blast radius grows and containment is harder.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html",
    "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws iam put-user-policy --user-name <example_resource_name> --policy-name deny-non-iam-sts-with-long-term-creds --policy-document '{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Deny\",\"NotAction\":[\"iam:*\",\"sts:*\"],\"Resource\":\"*\",\"Condition\":{\"Null\":{\"aws:TokenIssueTime\":\"true\"}}}]}'",
      "NativeIaC": "```yaml\n# Attach a policy to block long-term creds from accessing non-IAM/STS services\nResources:\n  DenyLongTermNonIamSts:\n    Type: AWS::IAM::Policy\n    Properties:\n      PolicyName: DenyNonIamStsWithLongTermCreds\n      PolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Deny\n            NotAction:\n              - iam:*\n              - sts:*\n            Resource: \"*\"\n            Condition:\n              Null:\n                aws:TokenIssueTime: \"true\"  # Critical: denies when no session token (i.e., long-lived creds)\n      Users:\n        - <example_resource_name>  # Critical: attach to the affected IAM user\n```",
      "Other": "1. In AWS Console, go to IAM > Users and select <example_resource_name>\n2. Open the Security credentials tab\n3. Under Access keys, deactivate and delete all active access keys\n4. Save changes\n5. Re-test: the user no longer has long-lived credentials to access non-IAM/STS services",
      "Terraform": "```hcl\n# Attach an inline policy to block long-term creds from non-IAM/STS services\nresource \"aws_iam_user_policy\" \"deny_non_iam_sts_longterm\" {\n  name = \"DenyNonIamStsWithLongTermCreds\"\n  user = \"<example_resource_name>\"  # Critical: target the affected IAM user\n\n  policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [{\n      Effect    = \"Deny\"\n      NotAction = [\"iam:*\", \"sts:*\"]\n      Resource  = \"*\"\n      Condition = {\n        Null = { \"aws:TokenIssueTime\" = \"true\" } # Critical: denies when no session token (long-lived creds)\n      }\n    }]\n  })\n}\n```"
    },
    "Recommendation": {
      "Text": "Adopt **temporary credentials** via IAM roles and federation for humans and workloads. Remove or restrict long-term keys; *if unavoidable*, apply **least privilege**, require **MFA**, rotate aggressively, and monitor usage. Prefer short session durations and session conditions to limit blast radius.",
      "Url": "https://hub.prowler.com/check/iam_user_with_temporary_credentials"
    }
  },
  "Categories": [
    "identity-access",
    "secrets"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
