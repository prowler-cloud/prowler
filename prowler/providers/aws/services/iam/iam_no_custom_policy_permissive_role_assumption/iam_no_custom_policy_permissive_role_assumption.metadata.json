{
  "Provider": "aws",
  "CheckID": "iam_no_custom_policy_permissive_role_assumption",
  "CheckTitle": "Custom IAM policy does not allow STS role assumption on wildcard resources",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "TTPs/Privilege Escalation",
    "TTPs/Lateral Movement"
  ],
  "ServiceName": "iam",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsIamPolicy",
  "ResourceGroup": "IAM",
  "Description": "**Custom IAM policies** with `Allow` statements that grant `sts:AssumeRole` (or `sts:*`/`*`) to a wildcard `Resource`.",
  "Risk": "Broad `AssumeRole` rights let principals obtain **temporary credentials** for many roles, enabling **privilege escalation**, **lateral movement**, and **cross-account access** where trusts allow. This jeopardizes **confidentiality** and **integrity** of data and the control plane.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html",
    "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_permissions-to-switch.html#roles-usingrole-createpolicy"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws iam create-policy-version --policy-arn <example_policy_arn> --policy-document '{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":\"sts:AssumeRole\",\"Resource\":\"arn:aws:iam::<example_account_id>:role/<example_resource_name>\"}]}' --set-as-default",
      "NativeIaC": "```yaml\n# CloudFormation: Replace wildcard resource with a specific role ARN\nResources:\n  <example_resource_name>:\n    Type: AWS::IAM::ManagedPolicy\n    Properties:\n      PolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Action: sts:AssumeRole\n            Resource: arn:aws:iam::<example_account_id>:role/<example_resource_name>  # CRITICAL: restrict to a specific role ARN to remove wildcard\n```",
      "Other": "1. Open the AWS Console and go to IAM > Policies\n2. Select the custom policy that FAILED and click Edit policy (JSON)\n3. Find any statement with Effect: Allow and Action including sts:AssumeRole (or sts:* or *) where Resource is \"*\"\n4. Change Resource to the specific role ARN(s), e.g.: arn:aws:iam::<example_account_id>:role/<example_resource_name>\n5. Save changes to create the new default version",
      "Terraform": "```hcl\n# Terraform: Replace wildcard resource with a specific role ARN\nresource \"aws_iam_policy\" \"<example_resource_name>\" {\n  name   = \"<example_resource_name>\"\n  policy = jsonencode({\n    Version   = \"2012-10-17\"\n    Statement = [{\n      Effect   = \"Allow\"\n      Action   = \"sts:AssumeRole\"\n      Resource = \"arn:aws:iam::<example_account_id>:role/<example_resource_name>\" // CRITICAL: restrict to a specific role ARN to remove wildcard\n    }]\n  })\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply **least privilege** to `sts:AssumeRole`:\n- Scope `Resource` to exact role ARNs\n- Require **MFA** and, for third parties, `ExternalId`\n- Enforce **permissions boundaries** and **SCPs** to block wildcards\n- Regularly remove unused role-assumption rights and **separate duties**",
      "Url": "https://hub.prowler.com/check/iam_no_custom_policy_permissive_role_assumption"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "CAF Security Epic: IAM"
}
