{
  "Provider": "aws",
  "CheckID": "iam_policy_allows_privilege_escalation",
  "CheckTitle": "Customer managed IAM policy does not allow actions that can lead to privilege escalation",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/CIS AWS Foundations Benchmark",
    "TTPs/Privilege Escalation"
  ],
  "ServiceName": "iam",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsIamPolicy",
  "ResourceGroup": "IAM",
  "Description": "**Customer-managed IAM policies** are evaluated for **permissions that enable privilege escalation**, including creating or updating policies, altering role trust, attaching higher-privilege policies, or using `iam:PassRole` to obtain broader access.",
  "Risk": "**Privilege-escalation permissions** let principals assume higher-privilege roles or attach admin policies, impacting:\n- **Confidentiality** via unauthorized data access/exfiltration\n- **Integrity** by modifying policies, configs, or logs\n- **Availability** through resource deletion or disabling controls",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege",
    "https://bishopfox.com/blog/privilege-escalation-in-aws",
    "https://github.com/RhinoSecurityLabs/Security-Research/blob/master/tools/aws-pentest-tools/aws_escalate.py",
    "https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/",
    "https://labs.reversec.com/posts/2025/08/another-ecs-privilege-escalation-path"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws iam create-policy-version --policy-arn <example_resource_id> --set-as-default --policy-document '{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Deny\",\"Action\":\"*\",\"Resource\":\"*\"}]}'",
      "NativeIaC": "```yaml\nResources:\n  <example_resource_name>:\n    Type: AWS::IAM::ManagedPolicy\n    Properties:\n      PolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Deny  # Critical: Denies all actions so the policy cannot allow privilege escalation\n            Action: \"*\"\n            Resource: \"*\"\n```",
      "Other": "1. In the AWS Console, go to IAM > Policies\n2. Open the customer managed policy showing FAIL\n3. Click Edit policy > JSON\n4. Remove any Allow statements that enable privilege-escalation actions (for example broad wildcards like \"iam:*\" or actions such as creating/updating/attaching policies, PassRole, or AssumeRole on wildcards)\n5. Save changes so the policy no longer allows those actions\n6. Re-run the check to confirm it passes",
      "Terraform": "```hcl\nresource \"aws_iam_policy\" \"<example_resource_name>\" {\n  name   = \"<example_resource_name>\"\n  # Critical: Deny all actions so the policy cannot allow privilege escalation\n  policy = jsonencode({\n    Version   = \"2012-10-17\",\n    Statement = [{\n      Effect   = \"Deny\",\n      Action   = \"*\",\n      Resource = \"*\"\n    }]\n  })\n}\n```"
    },
    "Recommendation": {
      "Text": "Apply **least privilege** to customer policies:\n- Avoid wildcards in `Action` and `Resource`\n- Remove or tightly scope `iam:PassRole`, policy attach/update, and trust-policy changes\n- Use conditions like `iam:PassedToService` and tags to constrain use\n- Enforce **permissions boundaries** and **SCPs**\n- Separate duties with change review",
      "Url": "https://hub.prowler.com/check/iam_policy_allows_privilege_escalation"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "CAF Security Epic: IAM"
}
