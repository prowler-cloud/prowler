{
  "Provider": "aws",
  "CheckID": "opensearch_service_domains_fault_tolerant_data_nodes",
  "CheckTitle": "OpenSearch domain has at least 3 data nodes and Zone Awareness enabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Effects/Denial of Service"
  ],
  "ServiceName": "opensearch",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsOpenSearchServiceDomain",
  "ResourceGroup": "database",
  "Description": "**Amazon OpenSearch domains** are assessed for fault tolerance: **>= 3 data nodes** (`instance_count >= 3`) and **Zone Awareness** (`zone_awareness_enabled = true`) to distribute data across Availability Zones.",
  "Risk": "**Insufficient data nodes** or disabled **Zone Awareness** reduces availability and durability. A node or AZ failure can trigger shard unavailability, write failures, or cluster outage, increasing risk of data inconsistency during rebalancing and blocking reads/writes until recovery.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/opensearch-service/latest/developerguide/managedomains-multiaz.html",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/es-controls.html#es-6"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws opensearch update-domain-config --domain-name <example_resource_name> --cluster-config InstanceCount=3,ZoneAwarenessEnabled=true",
      "NativeIaC": "```yaml\n# CloudFormation: Ensure at least 3 data nodes and enable Zone Awareness\nResources:\n  <example_resource_name>:\n    Type: AWS::OpenSearchService::Domain\n    Properties:\n      DomainName: <example_resource_name>\n      ClusterConfig:\n        InstanceType: m5.large.search\n        InstanceCount: 3            # Critical: sets at least 3 data nodes for fault tolerance\n        ZoneAwarenessEnabled: true  # Critical: enables cross-AZ (Zone Awareness)\n```",
      "Other": "1. Open the AWS Console and go to Amazon OpenSearch Service\n2. Select your domain and click Edit domain\n3. Under Cluster configuration:\n   - Set Number of data nodes to 3 (or more)\n   - Enable Zone awareness\n4. Click Submit to apply the changes",
      "Terraform": "```hcl\n# Terraform: Ensure at least 3 data nodes and enable Zone Awareness\nresource \"aws_opensearch_domain\" \"<example_resource_name>\" {\n  domain_name = \"<example_resource_name>\"\n\n  cluster_config {\n    instance_type          = \"m5.large.search\"\n    instance_count         = 3     # Critical: sets at least 3 data nodes for fault tolerance\n    zone_awareness_enabled = true  # Critical: enables cross-AZ (Zone Awareness)\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Configure OpenSearch with **>= 3 data nodes** and enable **Zone Awareness** to spread nodes across AZs.\n\n- Prefer Multi-AZ with Standby for resilient failover\n- Use node counts in multiples of three and set index replicas (`>= 1`)\n- Practice capacity planning and failure testing as **defense in depth**",
      "Url": "https://hub.prowler.com/check/opensearch_service_domains_fault_tolerant_data_nodes"
    }
  },
  "Categories": [
    "resilience"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
