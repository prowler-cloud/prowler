{
  "Provider": "aws",
  "CheckID": "opensearch_service_domains_fault_tolerant_master_nodes",
  "CheckTitle": "OpenSearch domain has at least 3 dedicated master nodes",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Effects/Denial of Service"
  ],
  "ServiceName": "opensearch",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsOpenSearchServiceDomain",
  "ResourceGroup": "database",
  "Description": "**Amazon OpenSearch domains** have **dedicated master nodes** enabled with a master node count of at least `3` to support stable cluster coordination and elections",
  "Risk": "With fewer than `3` or disabled **dedicated master nodes**, the cluster can lose **quorum**, blocking leader election.\n\nEffects include stalled cluster state updates, failed reads/writes, shard allocation issues, and possible split-brain, reducing **availability** and **integrity**.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/securityhub/latest/userguide/opensearch-controls.html#opensearch-11",
    "https://docs.aws.amazon.com/opensearch-service/latest/developerguide/managedomains-dedicatedmasternodes.html#dedicatedmasternodes-number"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws opensearch update-domain-config --domain-name <name> --cluster-config \"DedicatedMasterEnabled=true,DedicatedMasterType=<instance_type>,DedicatedMasterCount=3\"",
      "NativeIaC": "```yaml\n# CloudFormation: set at least 3 dedicated master nodes\nResources:\n  <example_resource_name>:\n    Type: AWS::OpenSearchService::Domain\n    Properties:\n      ClusterConfig:\n        DedicatedMasterEnabled: true  # Critical: enable dedicated master nodes\n        DedicatedMasterCount: 3       # Critical: ensure minimum of 3 masters\n        DedicatedMasterType: \"<instance_type>\"  # Critical: required when enabling masters\n```",
      "Other": "1. Sign in to the AWS Console and open Amazon OpenSearch Service\n2. Select your domain and choose Edit\n3. In Cluster configuration:\n   - Enable Dedicated master nodes\n   - Set Dedicated master node count to 3\n   - Select a Dedicated master instance type\n4. Choose Save changes",
      "Terraform": "```hcl\n# Terraform: set at least 3 dedicated master nodes\nresource \"aws_opensearch_domain\" \"<example_resource_name>\" {\n  domain_name = \"<example_resource_name>\"\n\n  cluster_config {\n    dedicated_master_enabled = true  # Critical: enable dedicated masters\n    dedicated_master_count   = 3     # Critical: ensure minimum of 3 masters\n    dedicated_master_type    = \"<instance_type>\"  # Critical: required when enabling masters\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **dedicated master nodes** and set the count to at least `3` (use an odd number) to maintain **quorum**. Use *Multi-AZ with standby* to distribute masters across zones. Right-size master instances and monitor cluster health to uphold high availability and resilience.",
      "Url": "https://hub.prowler.com/check/opensearch_service_domains_fault_tolerant_master_nodes"
    }
  },
  "Categories": [
    "resilience"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
