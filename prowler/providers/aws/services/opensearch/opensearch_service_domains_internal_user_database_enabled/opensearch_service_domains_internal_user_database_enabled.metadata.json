{
  "Provider": "aws",
  "CheckID": "opensearch_service_domains_internal_user_database_enabled",
  "CheckTitle": "Amazon OpenSearch Service domain has internal user database disabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices"
  ],
  "ServiceName": "opensearch",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "medium",
  "ResourceType": "AwsOpenSearchServiceDomain",
  "ResourceGroup": "database",
  "Description": "**Amazon OpenSearch Service domains** are evaluated for the **internal user database** setting (`InternalUserDatabaseEnabled`). The finding identifies domains that rely on built-in HTTP basic users instead of external identity providers.",
  "Risk": "An enabled internal user database creates **credential sprawl** and weak **account lifecycle**. Missing centralized MFA, rotation, and revocation raises unauthorized access risk, impacting **confidentiality** and **integrity**.\n\nBasic auth on exposed endpoints eases brute force and reduces **auditability**.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/fgac.html",
    "https://docs.aws.amazon.com/opensearch-service/latest/developerguide/fgac.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws opensearch update-domain-config --domain-name <example_resource_name> --advanced-security-options '{\"InternalUserDatabaseEnabled\":false}'",
      "NativeIaC": "```yaml\n# CloudFormation: disable internal user database for the domain\nResources:\n  <example_resource_name>:\n    Type: AWS::OpenSearchService::Domain\n    Properties:\n      AdvancedSecurityOptions:\n        InternalUserDatabaseEnabled: false  # Critical: disables internal user DB to pass the check\n```",
      "Other": "1. In AWS console, go to Amazon OpenSearch Service > Domains\n2. Select the domain and choose Edit security configuration\n3. Under Fine-grained access control, turn off Internal user database\n4. Click Save changes",
      "Terraform": "```hcl\n# Terraform: disable internal user database for the domain\nresource \"aws_opensearch_domain\" \"<example_resource_name>\" {\n  domain_name = \"<example_resource_name>\"\n\n  advanced_security_options {\n    internal_user_database_enabled = false  # Critical: disables internal user DB to pass the check\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Prefer **federated authentication** (IAM, SAML, or Amazon Cognito) and disable the **internal user database**. Enforce **least privilege** roles, require **MFA**, centralize credential rotation and offboarding, and log access. Use **VPC access** and restrictive policies; avoid HTTP basic auth to minimize exposure.",
      "Url": "https://hub.prowler.com/check/opensearch_service_domains_internal_user_database_enabled"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
