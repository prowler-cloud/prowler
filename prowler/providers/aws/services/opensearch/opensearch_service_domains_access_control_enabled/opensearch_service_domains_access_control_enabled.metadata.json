{
  "Provider": "aws",
  "CheckID": "opensearch_service_domains_access_control_enabled",
  "CheckTitle": "Amazon OpenSearch Service domain has fine-grained access control enabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices"
  ],
  "ServiceName": "opensearch",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsOpenSearchServiceDomain",
  "ResourceGroup": "database",
  "Description": "**Amazon OpenSearch Service domains** are evaluated for **fine-grained access control** being enabled in `advanced-security-options`, ensuring role-based authorization at index, document, and field levels for API and Dashboards access.",
  "Risk": "Without **fine-grained access control**, identities may gain overly broad permissions, enabling unauthorized reads or writes across indices and Dashboards. This undermines **confidentiality** and **integrity**, facilitates lateral movement, and increases the blast radius of a compromised account.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://repost.aws/questions/QUvejSG0WDRByFVMcDchn_5w/how-do-resource-based-access-policies-interact-with-fgac-master-users-in-amazon-opensearch-service",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/opensearch-controls.html#opensearch-7",
    "https://docs.aws.amazon.com/opensearch-service/latest/developerguide/fgac.html#fgac-enabling",
    "https://ealtili.medium.com/how-to-use-fine-grained-access-control-in-amazon-opensearch-service-4dc86bffd40d"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws opensearch update-domain-config --domain-name <DOMAIN_NAME> --advanced-security-options '{\"Enabled\":true,\"MasterUserOptions\":{\"MasterUserARN\":\"<MASTER_USER_ARN>\"}}'",
      "NativeIaC": "```yaml\n# CloudFormation: Enable fine-grained access control (FGAC) on an OpenSearch domain\nResources:\n  <example_resource_name>:\n    Type: AWS::OpenSearchService::Domain\n    Properties:\n      DomainName: <example_resource_name>\n      AdvancedSecurityOptions:\n        Enabled: true  # Critical: Turns on FGAC\n        MasterUserOptions:\n          MasterUserARN: <MASTER_USER_ARN>  # Critical: Required to enable FGAC using an IAM principal\n```",
      "Other": "1. In the AWS Console, go to Amazon OpenSearch Service\n2. Select your domain and choose Edit security configuration\n3. Enable Fine-grained access control\n4. Set the master user (choose IAM ARN and enter <MASTER_USER_ARN> or create an internal master user)\n5. Save changes and wait for the update to complete",
      "Terraform": "```hcl\n# Enable fine-grained access control (FGAC) on an OpenSearch domain\nresource \"aws_opensearch_domain\" \"<example_resource_name>\" {\n  domain_name = \"<example_resource_name>\"\n\n  advanced_security_options {\n    enabled = true  # Critical: Turns on FGAC\n    master_user_options {\n      master_user_arn = \"<MASTER_USER_ARN>\"  # Critical: Required to enable FGAC using an IAM principal\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable **fine-grained access control** in `advanced-security-options`. Define granular, role-based permissions (index/document/field) and map them to federated identities. Apply **least privilege**, deny-by-default, and **separation of duties**. Limit public access and regularly review role mappings.",
      "Url": "https://hub.prowler.com/check/opensearch_service_domains_access_control_enabled"
    }
  },
  "Categories": [
    "identity-access"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
