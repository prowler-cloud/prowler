{
  "Provider": "aws",
  "CheckID": "cloudformation_stack_outputs_find_secrets",
  "CheckTitle": "CloudFormation stack outputs do not contain secrets",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Sensitive Data Identifications/Passwords",
    "Sensitive Data Identifications/Security",
    "Effects/Data Exposure"
  ],
  "ServiceName": "cloudformation",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "critical",
  "ResourceType": "AwsCloudFormationStack",
  "ResourceGroup": "devops",
  "Description": "**CloudFormation stack Outputs** are analyzed for hardcoded secrets-passwords, API keys, tokens-using pattern-based detection across output values. A finding indicates potential secret strings present within `Outputs` of the template or stack.",
  "Risk": "**Secrets in Outputs** are readable to anyone with stack metadata access, enabling credential theft, unauthorized API calls, and lateral movement. Exposure via consoles, exports, or CI logs undermines confidentiality and can lead to privilege escalation and data exfiltration.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/secretsmanager/latest/userguide/best-practices.html",
    "https://support.icompaas.com/support/solutions/articles/62000127093-ensure-no-secrets-are-found-in-cloudformation-outputs",
    "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/outputs-section-structure.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws cloudformation update-stack --stack-name <STACK_NAME> --template-body file://<TEMPLATE_WITHOUT_SENSITIVE_OUTPUTS>.yaml",
      "NativeIaC": "```yaml\nAWSTemplateFormatVersion: '2010-09-09'\nOutputs:\n  # Critical: remove outputs that expose secrets (passwords/tokens/keys)\n  # Keeping only non-sensitive values in Outputs remediates the finding\n  SafeInfo:\n    Value: \"non-sensitive\"\n```",
      "Other": "1. In the AWS Console, go to CloudFormation > Stacks and select the stack\n2. Click Update > Replace current template\n3. Upload or paste the template with any secret-bearing Outputs removed (do not output passwords/tokens/keys)\n4. Click Next through the wizard and choose Submit to apply the change set\n5. Verify the stack Outputs tab no longer shows sensitive values",
      "Terraform": "```hcl\n# Critical: the embedded CloudFormation template removes secret outputs\nresource \"aws_cloudformation_stack\" \"<example_resource_name>\" {\n  name          = \"<example_resource_name>\"\n  template_body = <<-YAML\n    AWSTemplateFormatVersion: '2010-09-09'\n    # Critical: delete Outputs that expose secrets; keep only non-sensitive values\n    Outputs:\n      SafeInfo:\n        Value: \"non-sensitive\"  # Avoids exposing secrets in stack outputs\n  YAML\n}\n```"
    },
    "Recommendation": {
      "Text": "Remove secrets from `Outputs`. Store credentials in **Secrets Manager** or **Parameter Store** and reference them via dynamic references; set `NoEcho` for sensitive parameters. Apply **least privilege** to view stack metadata, avoid exporting sensitive values, and add automated IaC secret scanning for **defense in depth**.",
      "Url": "https://hub.prowler.com/check/cloudformation_stack_outputs_find_secrets"
    }
  },
  "Categories": [
    "secrets"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": "Infrastructure Protection"
}
