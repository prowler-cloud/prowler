{
  "Provider": "aws",
  "CheckID": "codebuild_project_no_secrets_in_variables",
  "CheckTitle": "CodeBuild project has no sensitive credentials in plaintext environment variables",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "TTPs/Credential Access",
    "Effects/Data Exposure",
    "Sensitive Data Identifications/Security"
  ],
  "ServiceName": "codebuild",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "critical",
  "ResourceType": "AwsCodeBuildProject",
  "ResourceGroup": "devops",
  "Description": "**AWS CodeBuild projects** are inspected for **plaintext environment variables** (`PLAINTEXT`) that resemble **secrets** (keys, tokens, passwords).\n\nSuch values indicate sensitive data is stored directly in environment variables instead of being sourced securely.",
  "Risk": "Plaintext secrets in environment variables reduce confidentiality: values can be viewed in consoles/CLI and may leak into build logs or public outputs. Compromised credentials enable unauthorized AWS actions, artifact tampering, and lateral movement, causing data exfiltration and CI/CD supply-chain compromise.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/codebuild/latest/userguide/build-spec-ref.html",
    "https://www.learnaws.org/2022/11/18/aws-codebuild-secrets-manager/",
    "https://www.learnaws.org/2023/08/23/codebuild-env-vars/",
    "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-codebuild-project-environmentvariable.html",
    "https://docs.aws.amazon.com/codebuild/latest/userguide/change-project.html",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/codebuild-controls.html#codebuild-2",
    "https://pasmichal.medium.com/how-to-handle-secrets-in-aws-codebuild-6e1b96013712",
    "https://medium.com/@odofing/aws-codepipeline-how-to-securely-store-environment-variables-in-ssm-paramater-store-and-aws-9a96d7083b3c"
  ],
  "Remediation": {
    "Code": {
      "CLI": "",
      "NativeIaC": "```yaml\nResources:\n  <example_resource_name>:\n    Type: AWS::CodeBuild::Project\n    Properties:\n      Name: <example_resource_name>\n      ServiceRole: <example_resource_arn>\n      Source:\n        Type: NO_SOURCE\n      Artifacts:\n        Type: NO_ARTIFACTS\n      Environment:\n        Type: LINUX_CONTAINER\n        ComputeType: BUILD_GENERAL1_SMALL\n        Image: aws/codebuild/standard:5.0\n        EnvironmentVariables:\n          - Name: <SENSITIVE_VAR_NAME>\n            Type: SECRETS_MANAGER  # CRITICAL: store secret in Secrets Manager to avoid PLAINTEXT\n            Value: <example_secret_name>  # Secret name or ARN (optionally include json-key)\n```",
      "Other": "1. In AWS Console, go to CodeBuild > Build projects and open your project\n2. Click Edit in the Environment section\n3. Under Environment variables, for each sensitive variable with Type = Plaintext, change Type to Secrets Manager (or Parameter store)\n4. Select the secret (or parameter) that holds the value, then Save\n5. If the secret/parameter does not exist, create it in Secrets Manager or Systems Manager Parameter Store first, then repeat steps 3-4",
      "Terraform": "```hcl\nresource \"aws_codebuild_project\" \"<example_resource_name>\" {\n  name         = \"<example_resource_name>\"\n  service_role = \"<example_resource_arn>\"\n\n  source {\n    type = \"NO_SOURCE\"\n  }\n\n  artifacts {\n    type = \"NO_ARTIFACTS\"\n  }\n\n  environment {\n    compute_type = \"BUILD_GENERAL1_SMALL\"\n    image        = \"aws/codebuild/standard:5.0\"\n    type         = \"LINUX_CONTAINER\"\n\n    environment_variable {\n      name  = \"<SENSITIVE_VAR_NAME>\"\n      type  = \"SECRETS_MANAGER\"  # CRITICAL: use Secrets Manager so value isn't plaintext\n      value = \"<example_secret_name>\"\n    }\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Store secrets outside the build and reference them via **AWS Secrets Manager** or **AWS Systems Manager Parameter Store** instead of `PLAINTEXT` variables.\n- Enforce **least privilege** on the build role\n- Rotate secrets; prefer short-lived credentials\n- Avoid logging or exporting secret values and never embed them in artifacts",
      "Url": "https://hub.prowler.com/check/codebuild_project_no_secrets_in_variables"
    }
  },
  "Categories": [
    "secrets",
    "ci-cd"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
