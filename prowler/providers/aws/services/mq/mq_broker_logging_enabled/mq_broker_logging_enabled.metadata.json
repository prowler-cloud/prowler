{
  "Provider": "aws",
  "CheckID": "mq_broker_logging_enabled",
  "CheckTitle": "MQ broker has general logging enabled and, for ActiveMQ, audit logging enabled",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/NIST 800-53 Controls",
    "Software and Configuration Checks/Industry and Regulatory Standards/AWS Foundational Security Best Practices"
  ],
  "ServiceName": "mq",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "low",
  "ResourceType": "AwsAmazonMQBroker",
  "ResourceGroup": "messaging",
  "Description": "**Amazon MQ brokers** have logging to **CloudWatch Logs** enabled per engine type: **ActiveMQ** requires both `general` and `audit` logs; **RabbitMQ** requires `general` logs.",
  "Risk": "Missing broker logs creates blind spots in authentication events, administrative changes, and broker failures. Adversaries can act without detection, enabling unauthorized access and message tampering (confidentiality/integrity) and hindering incident response and root-cause analysis (availability).",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/mq-controls.html#mq-2",
    "https://www.trendmicro.com/trendaivisiononecloudriskmanagement/knowledge-base/aws/MQ/log-exports.html",
    "https://docs.aws.amazon.com/cli/latest/reference/mq/create-broker.html",
    "https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/security-logging-monitoring.html"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws mq update-broker --broker-id <example_resource_id> --logs Audit=true,General=true",
      "NativeIaC": "```yaml\n# CloudFormation: Enable Amazon MQ logging\nResources:\n  <example_resource_name>:\n    Type: AWS::AmazonMQ::Broker\n    Properties:\n      BrokerName: <example_resource_name>\n      EngineType: ACTIVEMQ\n      HostInstanceType: mq.t3.micro\n      DeploymentMode: SINGLE_INSTANCE\n      PubliclyAccessible: true\n      Users:\n        - Username: <example_user>\n          Password: <example_password>\n      Logs:\n        General: true  # Critical: enables general logs to CloudWatch\n        Audit: true    # Critical: enables audit logs (required for ActiveMQ)\n```",
      "Other": "1. In the AWS Console, go to Amazon MQ > Brokers\n2. Select <example_resource_name> and choose Edit\n3. In Log settings:\n   - For ActiveMQ: enable General logs and Audit logs\n   - For RabbitMQ: enable General logs only\n4. Save changes and reboot if prompted",
      "Terraform": "```hcl\n# Terraform: Enable Amazon MQ logging\nresource \"aws_mq_broker\" \"<example_resource_name>\" {\n  broker_name         = \"<example_resource_name>\"\n  engine_type         = \"ActiveMQ\"\n  host_instance_type  = \"mq.t3.micro\"\n  deployment_mode     = \"SINGLE_INSTANCE\"\n  publicly_accessible = true\n\n  user {\n    username = \"<example_user>\"\n    password = \"<example_password>\"\n  }\n\n  logs {\n    general = true  # Critical: enables general logs\n    audit   = true  # Critical: enables audit logs (ActiveMQ)\n  }\n}\n```"
    },
    "Recommendation": {
      "Text": "Enable centralized **CloudWatch Logs** for brokers. For **ActiveMQ**, turn on both `general` and `audit` logs; for **RabbitMQ**, enable `general` logs.\n\nApply **least privilege** to log access, set retention, and create alerts for anomalous events to strengthen **defense in depth**.",
      "Url": "https://hub.prowler.com/check/mq_broker_logging_enabled"
    }
  },
  "Categories": [
    "logging"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
