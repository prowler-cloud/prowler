{
  "Provider": "aws",
  "CheckID": "ecs_task_definitions_host_namespace_not_shared",
  "CheckTitle": "ECS task definition does not share the host's process namespace with its containers",
  "CheckType": [
    "Software and Configuration Checks/AWS Security Best Practices",
    "Software and Configuration Checks/Industry and Regulatory Standards/CIS Host Hardening Benchmarks",
    "TTPs/Privilege Escalation",
    "TTPs/Discovery"
  ],
  "ServiceName": "ecs",
  "SubServiceName": "",
  "ResourceIdTemplate": "",
  "Severity": "high",
  "ResourceType": "AwsEcsTaskDefinition",
  "Description": "**ECS task definitions** where `pidMode` is `host` are configured to share the host's **process namespace** with containers, rather than using isolated task or private namespaces.",
  "Risk": "**Host PID sharing** lets containers view and interact with host processes, eroding isolation.\n- Confidentiality: process enumeration and metadata leakage\n- Integrity/Availability: signal or `ptrace` tampering, killing services\n\nEnables lateral movement and privilege escalation from a compromised container.",
  "RelatedUrl": "",
  "AdditionalURLs": [
    "https://asecure.cloud/a/cfgrule_ecs-task-definition-pid-mode-check/",
    "https://docs.aws.amazon.com/securityhub/latest/userguide/ecs-controls.html#ecs-3",
    "https://docs.aws.amazon.com/config/latest/developerguide/ecs-task-definition-pid-mode-check.html",
    "https://medium.com/@esshariprasad/aws-ecs-task-definition-template-a86f2cf73923",
    "https://sdk.amazonaws.com/java/api/latest/software/amazon/awssdk/services/ecs/model/TaskDefinition.html",
    "https://docs.aws.amazon.com/AmazonECS/latest/userguide/task_definition_parameters.html#container_definition_pid_mode",
    "https://docs.datadoghq.com/security/default_rules/def-000-zbk/",
    "https://support.icompaas.com/support/solutions/articles/62000233420-ensure-ecs-task-definitions-should-not-share-the-host-s-process-namespace"
  ],
  "Remediation": {
    "Code": {
      "CLI": "aws ecs register-task-definition --family <example_resource_name> --pid-mode task --container-definitions '[{\"name\":\"<container-name>\",\"image\":\"<image>\"}]'",
      "NativeIaC": "```yaml\n# CloudFormation: ECS Task Definition without host PID namespace\nResources:\n  <example_resource_name>:\n    Type: AWS::ECS::TaskDefinition\n    Properties:\n      Family: <example_resource_name>\n      ContainerDefinitions:\n        - Name: <container-name>\n          Image: <image>\n      PidMode: task  # Critical: ensures containers use task PID namespace, not host\n```",
      "Other": "1. In the AWS Console, go to Amazon ECS > Task Definitions\n2. Select the task definition and click Create new revision\n3. Set Process namespace sharing (PID mode) to Task (not Host)\n4. Save the new revision\n5. (If the previous Host PID revision remains active) Select that revision and click Deregister",
      "Terraform": "```hcl\n# ECS Task Definition without host PID namespace\nresource \"aws_ecs_task_definition\" \"example\" {\n  family                = \"<example_resource_name>\"\n  container_definitions = jsonencode([{ name = \"<container-name>\", image = \"<image>\" }])\n  pid_mode              = \"task\"  # Critical: prevents sharing the host's process namespace\n}\n```"
    },
    "Recommendation": {
      "Text": "Prefer **isolated PID namespaces**: set `pidMode=task` or use the default per-container namespace. Avoid `host` PID sharing except for tightly controlled diagnostics.\n\nApply **least privilege**: non-root users, minimal capabilities, read-only filesystems; and **defense in depth** with network and runtime controls.",
      "Url": "https://hub.prowler.com/check/ecs_task_definitions_host_namespace_not_shared"
    }
  },
  "Categories": [
    "container-security",
    "trust-boundaries"
  ],
  "DependsOn": [],
  "RelatedTo": [],
  "Notes": ""
}
